<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
    
    <entry>
      <title><![CDATA[SQL Server XML]]></title>
      <url>www.datagriff.com/2018/05/SQLServerXML/</url>
      <content type="html"><![CDATA[<p>The following post aims to give an good introduction and exercise around XML in SQL server. </p>
<h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><ol>
<li><a href="#what-is-xml">What is XML? What is its structure? What is well-formed XML?</a></li>
<li><a href="#xquery">Demonstrate some XQuery</a></li>
<li><a href="#generate-some-test-data-for-dogs-arriving-in-kennels-in-relational-format">Generate some test data for dogs entering kennels in a table</a></li>
<li><a href="#show-xml-for-option-functionality">Show XML FOR functionality</a></li>
<li><a href="#create-xml-schema-using-a-relational-table-structure">Create XML schema from Relational Table</a></li>
<li><a href="#prove-create-xml-schema-works">Shows XML Schema Validation Works</a></li>
<li><a href="#import-data-from-xml-files-into-sql-table">Import XML into SQL Table using MERGE</a></li>
<li><a href="#create-csv-from-row-data">Create CSV from Row Data</a></li>
</ol>
<h2 id="0-0-Create-Database-and-Schema"><a href="#0-0-Create-Database-and-Schema" class="headerlink" title="0.0 Create Database and Schema"></a>0.0 Create Database and Schema</h2><p>Execute the below on your sql server to create the required database. </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> [<span class="keyword">Master</span>]</span><br><span class="line"><span class="keyword">GO</span></span><br><span class="line"><span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> SYS.databases <span class="keyword">WHERE</span> <span class="keyword">name</span> = <span class="string">'XMLDemo'</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> [XMLDemo];</span><br><span class="line"><span class="keyword">END</span> </span><br><span class="line"><span class="keyword">GO</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">USE</span> [XMLDemo]</span><br><span class="line"><span class="keyword">GO</span></span><br><span class="line"><span class="keyword">DECLARE</span> @<span class="keyword">sql</span> <span class="keyword">NVARCHAR</span>(<span class="number">255</span>) = <span class="string">''</span>;</span><br><span class="line">IF SCHEMA_ID('tools') IS NULL</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">SET</span> @<span class="keyword">Sql</span> = <span class="string">'CREATE SCHEMA [import];'</span>;</span><br><span class="line">EXEC sp_executesql @sql;</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>
<h2 id="What-is-XML"><a href="#What-is-XML" class="headerlink" title="What is XML?"></a>What is XML?</h2><p>XML stands for Extensible Markup Language. It’s intent is a universal messaging langugage to describe data across<br>multiple environments. It is hierarchical in nature with nodes represented as attributes or elements nested<br>within one another.  </p>
<p>Below you can see some self describing XML which you can execute against your demo database. </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> XMLDemo;</span><br><span class="line">GO</span><br><span class="line"><span class="keyword">DECLARE</span> @x <span class="keyword">XML</span>;</span><br><span class="line"><span class="keyword">SET</span> @x = <span class="string">'&lt;?xml version = "1.0"?&gt; </span><br><span class="line">			&lt;!-- This is a comment node--&gt;</span><br><span class="line">			&lt;RootElementNode attribute = "Root element attribute text"&gt;</span><br><span class="line">				&lt;ElementNode&gt;Text node&lt;/ElementNode&gt;</span><br><span class="line">				&lt;ElementNode&gt;Text node 2</span><br><span class="line">				&lt;NestedNode&gt;Nested Text Node&lt;/NestedNode&gt;</span><br><span class="line">				&lt;/ElementNode&gt;</span><br><span class="line">			&lt;/RootElementNode&gt;'</span></span><br><span class="line"><span class="keyword">SELECT</span> @x;</span><br><span class="line">GO</span><br></pre></td></tr></table></figure>
<p>For XML to be well-formed it must have…</p>
<ol>
<li>One of more elements</li>
<li>Only one root element</li>
<li>Elements properly nested within one another and dont overlap </li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> XMLDemo;</span><br><span class="line">GO </span><br><span class="line"><span class="keyword">DECLARE</span> @<span class="keyword">xml</span> <span class="keyword">XML</span> =</span><br><span class="line">N<span class="string">'&lt;Hospital name = "University Hospital of Wales"&gt;</span><br><span class="line">		&lt;Patient sex="M" name="Bill Withers" age="40"&gt;</span><br><span class="line">			&lt;Diagnosis&gt;Diabetes&lt;/Diagnosis&gt;</span><br><span class="line">			&lt;AdmissionDate&gt;01-10-2014&lt;/AdmissionDate&gt;</span><br><span class="line">		&lt;/Patient&gt;</span><br><span class="line">		&lt;Patient sex="F" name="April O&amp;apos;Neil" age="32"&gt;</span><br><span class="line">			&lt;Diagnosis&gt;Broken Hip&lt;/Diagnosis&gt;</span><br><span class="line">			&lt;AdmissionDate&gt;15-12-2014&lt;/AdmissionDate&gt;</span><br><span class="line">		&lt;/Patient&gt;</span><br><span class="line">		&lt;Patient sex="M" name="Bruce Wayne" age="38"&gt;</span><br><span class="line">			&lt;Diagnosis&gt;Cholera&lt;/Diagnosis&gt;</span><br><span class="line">			&lt;AdmissionDate&gt;10-01-2015&lt;/AdmissionDate&gt;</span><br><span class="line">		&lt;/Patient&gt;</span><br><span class="line">	&lt;/Hospital&gt;'</span>;</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="keyword">xml</span>;</span><br><span class="line">GO</span><br></pre></td></tr></table></figure>
<p>Non-Well Formed XML must still follow these rules but it doesnt have to have one root node<br>Below is an XML fragment. </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> XMLDemo;</span><br><span class="line">GO </span><br><span class="line"><span class="keyword">DECLARE</span> @<span class="keyword">xml</span> <span class="keyword">XML</span> =</span><br><span class="line">		N<span class="string">'&lt;Patient sex="M" name="Bill Withers" age="40"&gt;</span><br><span class="line">			&lt;Diagnosis&gt;Diabetes&lt;/Diagnosis&gt;</span><br><span class="line">			&lt;AdmissionDate&gt;01-10-2014&lt;/AdmissionDate&gt;</span><br><span class="line">		&lt;/Patient&gt;</span><br><span class="line">		&lt;Patient sex="F" name="April O&amp;apos;Neil" age="32"&gt;</span><br><span class="line">			&lt;Diagnosis&gt;Broken Hip&lt;/Diagnosis&gt;</span><br><span class="line">			&lt;AdmissionDate&gt;15-12-2014&lt;/AdmissionDate&gt;</span><br><span class="line">		&lt;/Patient&gt;</span><br><span class="line">		&lt;Patient sex="M" name="Bruce Wayne" age="38"&gt;</span><br><span class="line">			&lt;Diagnosis&gt;Cholera&lt;/Diagnosis&gt;</span><br><span class="line">			&lt;AdmissionDate&gt;10-01-2015&lt;/AdmissionDate&gt;</span><br><span class="line">		&lt;/Patient&gt;'</span>;</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="keyword">xml</span>;</span><br><span class="line">GO</span><br></pre></td></tr></table></figure>
<h2 id="XQuery"><a href="#XQuery" class="headerlink" title="XQuery"></a>XQuery</h2><p>You can query XML directly using XQuery, there are four main functions:</p>
<ol>
<li><strong>Query()</strong> Obtain sections of XML you require</li>
<li><strong>Value()</strong> Obtain single values from XML</li>
<li><strong>Exist()</strong> Determine whether value/element exists (1) or not (0)</li>
<li><strong>Nodes()</strong> Shred XML data into relational format</li>
</ol>
<p>Execute all of the code below on the XMLDemo database and take a look at the outputs. </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> XMLDemo;</span><br><span class="line">GO</span><br><span class="line">PRINT '2.1 <span class="keyword">Create</span> an <span class="keyword">XML</span> <span class="keyword">variable</span> <span class="keyword">to</span> <span class="keyword">Query</span><span class="string">';</span><br><span class="line">DECLARE @xml XML =</span><br><span class="line">N'</span>&lt;Kennel <span class="keyword">name</span> = <span class="string">"Coedely"</span>&gt;</span><br><span class="line">		&lt;Dog sex=<span class="string">"M"</span> <span class="keyword">name</span>=<span class="string">"Harvey"</span> neutered=<span class="string">"true"</span>&gt;</span><br><span class="line">			&lt;Breed&gt;German Shepherd&lt;/Breed&gt;</span><br><span class="line">			&lt;KennelArrivalDate&gt;<span class="number">01</span><span class="number">-10</span><span class="number">-2014</span>&lt;/KennelArrivalDate&gt;</span><br><span class="line">		&lt;/Dog&gt;</span><br><span class="line">		&lt;Dog sex=<span class="string">"F"</span> <span class="keyword">name</span>=<span class="string">"Lucy"</span> neutered=<span class="string">"true"</span>&gt;</span><br><span class="line">			&lt;Breed&gt;Labrador&lt;/Breed&gt;</span><br><span class="line">			&lt;KennelArrivalDate&gt;<span class="number">15</span><span class="number">-12</span><span class="number">-2014</span>&lt;/KennelArrivalDate&gt;</span><br><span class="line">		&lt;/Dog&gt;</span><br><span class="line">		&lt;Dog sex=<span class="string">"M"</span> <span class="keyword">name</span>=<span class="string">"Fudge"</span> neutered=<span class="string">"false"</span>&gt;</span><br><span class="line">			&lt;Breed&gt;American Bulldog&lt;/Breed&gt;</span><br><span class="line">			&lt;KennelArrivalDate&gt;<span class="number">10</span><span class="number">-01</span><span class="number">-2015</span>&lt;/KennelArrivalDate&gt;</span><br><span class="line">		&lt;/Dog&gt;</span><br><span class="line">	&lt;/Kennel&gt;<span class="string">';</span><br><span class="line"></span><br><span class="line">SELECT @xml AS XMLtoQuery;</span><br><span class="line"></span><br><span class="line">PRINT '</span><span class="number">2.1</span><span class="number">.1</span> <span class="keyword">Query</span>(): <span class="keyword">Get</span> dogs<span class="string">';</span><br><span class="line">SELECT [QueryDogs] =  @xml.query(N'</span>/Kennel/Dog<span class="string">');</span><br><span class="line">PRINT '</span><span class="number">2.1</span><span class="number">.2</span> <span class="keyword">Query</span>(): <span class="keyword">Get</span> dog breeds <span class="string">';</span><br><span class="line">SELECT [QueryDogBreeds] =  @xml.query(N'</span>/Kennel/Dog/Breed<span class="string">');</span><br><span class="line">PRINT '</span><span class="number">2.1</span><span class="number">.3</span> <span class="keyword">Query</span>(): <span class="keyword">Get</span> dog named Harvey<span class="string">';</span><br><span class="line">SELECT [QueryDogNamedHarvey] =  @xml.query(N'</span>/Kennel/Dog[@<span class="keyword">name</span>=<span class="string">"Harvey"</span>]<span class="string">');</span><br><span class="line">PRINT '</span><span class="number">2.2</span> <span class="keyword">Value</span>(): <span class="keyword">Get</span> Breed <span class="keyword">where</span> dog named fudge<span class="string">';</span><br><span class="line">SELECT [ValueFudgeBreed] =  @xml.value(N'</span>(/Kennel/Dog[@<span class="keyword">name</span>=<span class="string">"Fudge"</span>]/Breed)[<span class="number">1</span>]<span class="string">', N'</span><span class="keyword">nvarchar</span>(<span class="number">100</span>)<span class="string">');</span><br><span class="line">PRINT '</span><span class="number">2.3</span> Exist():  <span class="keyword">Using</span> Exist <span class="keyword">Function</span> <span class="keyword">in</span> <span class="keyword">CASE</span><span class="string">';</span><br><span class="line">SELECT [ExistLucy] =  CASE @xml.exist</span><br><span class="line">(</span><br><span class="line">N'</span>/Kennel/Dog[@<span class="keyword">name</span>=<span class="string">"Lucy"</span>]<span class="string">'</span><br><span class="line">)</span><br><span class="line">WHEN 1 THEN N'</span>The kennel has a dog named Lucy<span class="string">'</span><br><span class="line">WHEN 0 THEN N'</span>The kennel does <span class="keyword">not</span> have a dog named Lucy<span class="string">'</span><br><span class="line">END;</span><br><span class="line">PRINT '</span><span class="number">2.4</span> Nodes(); Shred XML Data into Relational Format';</span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">col.value(N<span class="string">'./@sex[1]'</span>,N<span class="string">'nvarchar(100)'</span>) <span class="keyword">AS</span> Sex</span><br><span class="line">,col.value(N<span class="string">'./@name[1]'</span>,N<span class="string">'nvarchar(100)'</span>) <span class="keyword">AS</span> <span class="keyword">Name</span></span><br><span class="line">,col.value(N<span class="string">'./@neutered[1]'</span>,N<span class="string">'nvarchar(100)'</span>) <span class="keyword">AS</span> Neutered</span><br><span class="line">,col.value(N<span class="string">'./Breed[1]'</span>,N<span class="string">'nvarchar(100)'</span>) <span class="keyword">AS</span> Breed</span><br><span class="line"><span class="keyword">FROM</span> @xml.nodes(N<span class="string">'//Kennel/*'</span>) Tab(<span class="keyword">Col</span>);</span><br><span class="line"></span><br><span class="line">GO</span><br></pre></td></tr></table></figure>
<h2 id="Generate-some-test-data-for-Dogs-arriving-in-Kennels-in-relational-format"><a href="#Generate-some-test-data-for-Dogs-arriving-in-Kennels-in-relational-format" class="headerlink" title="Generate some test data for Dogs arriving in Kennels in relational format"></a>Generate some test data for Dogs arriving in Kennels in relational format</h2><p>Run the code below on your database so that we can use the table and data in later parts… </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> XMLDemo;</span><br><span class="line">GO</span><br><span class="line">PRINT '3.1  <span class="keyword">Drop</span> Dog Kennel Arrival <span class="keyword">table</span> <span class="keyword">if</span> already <span class="keyword">exists</span><span class="string">';</span><br><span class="line">IF OBJECT_ID('</span>import.DogKennelArrival<span class="string">') IS NOT NULL</span><br><span class="line">	DROP TABLE import.DogKennelArrival;</span><br><span class="line">GO </span><br><span class="line"></span><br><span class="line">PRINT '</span><span class="number">3.2</span>  <span class="keyword">Create</span> Dog Kennel Arrival <span class="keyword">table</span><span class="string">';</span><br><span class="line">CREATE TABLE import.DogKennelArrival</span><br><span class="line">(</span><br><span class="line">[id] INT IDENTITY CONSTRAINT PK_import_DogKennelArrival PRIMARY KEY CLUSTERED </span><br><span class="line">,[FirstInserted] DATETIME2 NOT NULL CONSTRAINT DF_import_DogKennelArrival_FirstInserted DEFAULT SYSUTCDATETIME()</span><br><span class="line">,[LastUpdated] DATETIME2 NOT NULL CONSTRAINT DF_import_DogKennelArrival_LastUpdated DEFAULT SYSUTCDATETIME()</span><br><span class="line">,[DogName] VARCHAR(25) NOT NULL CONSTRAINT UNQ_DogKennelArrival_DogName UNIQUE</span><br><span class="line">,[DogSex] VARCHAR(8) NOT NULL</span><br><span class="line">,[DogNeutered] BIT NOT NULL</span><br><span class="line">,[DogBreed] VARCHAR(50) NOT NULL</span><br><span class="line">,[KennelArrivalDate] DATE NOT NULL</span><br><span class="line">);</span><br><span class="line">GO </span><br><span class="line"></span><br><span class="line">PRINT '</span><span class="number">3.3</span>  <span class="keyword">Insert</span> dogs <span class="keyword">into</span> kennel arrival <span class="keyword">table</span><span class="string">';</span><br><span class="line">INSERT INTO import.DogKennelArrival</span><br><span class="line">(</span><br><span class="line">[DogName],[DogSex] ,[DogNeutered],[DogBreed] ,[KennelArrivalDate] </span><br><span class="line">)</span><br><span class="line">VALUES ('</span>Harvey<span class="string">','</span>M<span class="string">',1,'</span>German Shepherd<span class="string">','</span><span class="number">01</span>-<span class="keyword">Oct</span><span class="number">-2014</span><span class="string">')</span><br><span class="line">, ('</span>Lucy<span class="string">','</span>F<span class="string">',1,'</span>Labrador<span class="string">','</span><span class="number">15</span>-<span class="built_in">Dec</span><span class="number">-2014</span><span class="string">')</span><br><span class="line">, ('</span>Fudge<span class="string">','</span>M<span class="string">',0,'</span>American Bulldog<span class="string">','</span><span class="number">10</span>-Jan<span class="number">-2015</span><span class="string">');</span><br><span class="line"></span><br><span class="line">GO</span></span><br></pre></td></tr></table></figure>
<h2 id="Show-XML-FOR-Option-Functionality"><a href="#Show-XML-FOR-Option-Functionality" class="headerlink" title="Show XML FOR Option Functionality"></a>Show XML FOR Option Functionality</h2><p><strong>4.1 XML RAW</strong><br>The default for XML RAW is to create a single outer node with the name of row and generate the XML in an attribute-centric format (4.1.1).<br>You can add the keyword Elements to XML RAW to generate the XML in an element-centric format (4.1.2).</p>
<p>Execute the below on the XMLDemo database to see examples of XML RAW. </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> XMLDemo;</span><br><span class="line">GO </span><br><span class="line">PRINT '4.1 XML Raw';</span><br><span class="line">PRINT '4.1.1 XML Raw Default (attributes)';</span><br><span class="line"><span class="keyword">DECLARE</span> @<span class="keyword">xml</span> <span class="keyword">XML</span>;</span><br><span class="line"><span class="keyword">SET</span> @<span class="keyword">xml</span> = (<span class="keyword">SELECT</span> </span><br><span class="line">[DogName],[DogSex] ,[DogNeutered],[DogBreed] ,[KennelArrivalDate] </span><br><span class="line"><span class="keyword">FROM</span> import.DogKennelArrival</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">XML</span> <span class="keyword">RAW</span>);</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="keyword">xml</span> <span class="keyword">AS</span> <span class="string">'XMLRawDefault'</span>;</span><br><span class="line">GO</span><br><span class="line"></span><br><span class="line">PRINT '4.1.2 XML Raw ElementsXML';</span><br><span class="line"><span class="keyword">DECLARE</span> @<span class="keyword">xml</span> <span class="keyword">XML</span>;</span><br><span class="line"><span class="keyword">SET</span> @<span class="keyword">xml</span> = (<span class="keyword">SELECT</span> </span><br><span class="line">[DogName],[DogSex] ,[DogNeutered],[DogBreed] ,[KennelArrivalDate] </span><br><span class="line"><span class="keyword">FROM</span> import.DogKennelArrival</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">XML</span> <span class="keyword">RAW</span>, ELEMENTS);</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="keyword">xml</span> <span class="keyword">AS</span> <span class="string">'XMLRawElements'</span>;</span><br><span class="line">GO</span><br></pre></td></tr></table></figure>
<p><strong>4.2 XML AUTO</strong><br>The default for XML AUTO is to create a single outer node that is the name of the table or alias used and the XML is in an attribute-centric format (4.2.1).<br>You can add the keyword Elements to XML AUTO to generate the XML in an element-centric format (4.2.2).<br>You can add aliases to the table name and columns so that these aliases represent the nodes in the XML.<br>The order of the columns is important in order to get appropriate hierarchical XML.<br>We will be looking at the XML auto capability to generate XML schema later…</p>
<p>Execute the below on the XMLDemo database to see examples of XML AUTO. </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> XMLDemo;</span><br><span class="line">GO </span><br><span class="line">PRINT '4.2 XML AUTO';</span><br><span class="line">PRINT '4.2.1 XML Auto Default (attributes)';</span><br><span class="line"><span class="keyword">DECLARE</span> @<span class="keyword">xml</span> <span class="keyword">XML</span>;</span><br><span class="line"><span class="keyword">SET</span> @<span class="keyword">xml</span> = (<span class="keyword">SELECT</span> </span><br><span class="line">[DogName],[DogSex] ,[DogNeutered],[DogBreed] ,[KennelArrivalDate] </span><br><span class="line"><span class="keyword">FROM</span> import.DogKennelArrival</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">XML</span> <span class="keyword">AUTO</span>);</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="keyword">xml</span> <span class="keyword">AS</span> <span class="string">'XMLAutoDefault'</span>;</span><br><span class="line">GO</span><br><span class="line"></span><br><span class="line">PRINT '4.2.2 XML Auto Elements'; </span><br><span class="line"><span class="keyword">DECLARE</span> @<span class="keyword">xml</span> <span class="keyword">XML</span>;</span><br><span class="line"><span class="keyword">SET</span> @<span class="keyword">xml</span> = (<span class="keyword">SELECT</span> </span><br><span class="line">[DogName],[DogSex] ,[DogNeutered],[DogBreed] ,[KennelArrivalDate] </span><br><span class="line"><span class="keyword">FROM</span> import.DogKennelArrival</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">XML</span> <span class="keyword">AUTO</span>, ELEMENTS);</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="keyword">xml</span> <span class="keyword">AS</span> <span class="string">'XMLAutoElements'</span>;</span><br><span class="line">GO</span><br><span class="line"></span><br><span class="line">PRINT '4.2.3 XML Auto with Alias'; </span><br><span class="line"><span class="keyword">DECLARE</span> @<span class="keyword">xml</span> <span class="keyword">XML</span>;</span><br><span class="line"><span class="keyword">SET</span> @<span class="keyword">xml</span> = (<span class="keyword">SELECT</span> </span><br><span class="line">Dog.[DogName],Dog.[DogSex] ,Dog.[DogNeutered],Dog.[DogBreed] ,Dog.[KennelArrivalDate] </span><br><span class="line"><span class="keyword">FROM</span> import.DogKennelArrival Dog</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">XML</span> <span class="keyword">AUTO</span>, ELEMENTS);</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="keyword">xml</span> <span class="keyword">AS</span> <span class="string">'XMLAutoElementsAliases'</span>;</span><br><span class="line">GO</span><br></pre></td></tr></table></figure>
<p><strong>4.3 XML PATH</strong><br>This is the most customisable of the FOR clauses<br>The default is returning the XML in an element-centric format with the default “row” outer node (4.3.1).<br>You can provide the name of the outer node for each row and the root node (4.3.2).<br>You can force columns to become attributes using @ or cause customised nesting using “/“ in the alias name (4.3.3).</p>
<p>Execute the below on the XMLDemo database to see examples of XML PATH. </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> XMLDemo;</span><br><span class="line">GO </span><br><span class="line">PRINT '4.3 XML Path';</span><br><span class="line">PRINT '4.3.1 XML Path Default (elements)';</span><br><span class="line"><span class="keyword">DECLARE</span> @<span class="keyword">xml</span> <span class="keyword">XML</span>;</span><br><span class="line"><span class="keyword">SET</span> @<span class="keyword">xml</span> = (<span class="keyword">SELECT</span> </span><br><span class="line">[DogName],[DogSex] ,[DogNeutered],[DogBreed] ,[KennelArrivalDate] </span><br><span class="line"><span class="keyword">FROM</span> import.DogKennelArrival</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">XML</span> <span class="keyword">PATH</span>);</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="keyword">xml</span> <span class="keyword">AS</span> <span class="string">'XMLPathDefault'</span>;</span><br><span class="line">GO</span><br><span class="line"></span><br><span class="line">PRINT '4.3.2 XML Path with Outer Node and Root Param (well-formed XML)';</span><br><span class="line"><span class="keyword">DECLARE</span> @<span class="keyword">xml</span> <span class="keyword">XML</span>;</span><br><span class="line"><span class="keyword">SET</span> @<span class="keyword">xml</span> = (<span class="keyword">SELECT</span> </span><br><span class="line">[DogName],[DogSex] ,[DogNeutered],[DogBreed] ,[KennelArrivalDate] </span><br><span class="line"><span class="keyword">FROM</span> import.DogKennelArrival</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">XML</span> <span class="keyword">PATH</span>(<span class="string">'Dog'</span>), root(<span class="string">'Kennel'</span>));</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="keyword">xml</span> <span class="keyword">AS</span> <span class="string">'XMLPathParameters'</span>;</span><br><span class="line">GO</span><br><span class="line"></span><br><span class="line">PRINT '4.3.3 XML Path with Attributes and Path Specified';</span><br><span class="line"><span class="keyword">DECLARE</span> @<span class="keyword">xml</span> <span class="keyword">XML</span>;</span><br><span class="line"><span class="keyword">SET</span> @<span class="keyword">xml</span> = (<span class="keyword">SELECT</span> </span><br><span class="line">[DogName] <span class="keyword">AS</span> <span class="string">'@name'</span>,[DogSex] ,[DogNeutered],[DogBreed] </span><br><span class="line">,[KennelArrivalDate] <span class="keyword">AS</span> <span class="string">'ArrivalDetails/Date'</span></span><br><span class="line"><span class="keyword">FROM</span> import.DogKennelArrival</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">XML</span> <span class="keyword">PATH</span>(<span class="string">'Dog'</span>), root(<span class="string">'Kennel'</span>));</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="keyword">xml</span> <span class="keyword">AS</span> <span class="string">'XMLPathParametersAndAliases'</span>;</span><br><span class="line">GO</span><br></pre></td></tr></table></figure>
<h2 id="Create-XML-Schema-using-a-Relational-Table-Structure"><a href="#Create-XML-Schema-using-a-Relational-Table-Structure" class="headerlink" title="Create XML Schema using a Relational Table Structure"></a>Create XML Schema using a Relational Table Structure</h2><p>You can create an XML schema from a relational table (created in part 3) by capturing the schema and then capturing it when creating a schema collection.</p>
<p>Execute the below on the XMLDemo database to create an XML schema from the DogKennelArrival relational table. </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> XMLDemo;</span><br><span class="line">GO </span><br><span class="line">PRINT '5.1 <span class="keyword">Declare</span> <span class="keyword">schema</span> <span class="keyword">variable</span><span class="string">';</span><br><span class="line">DECLARE @myschema NVARCHAR(MAX);</span><br><span class="line">SET @myschema = N''</span><br><span class="line">PRINT '</span><span class="number">5.2</span> <span class="keyword">Set</span> <span class="keyword">Schema</span> <span class="keyword">Variable</span> <span class="keyword">using</span> <span class="keyword">XML</span> <span class="keyword">AUTO</span>, ELEMENTS <span class="keyword">and</span> <span class="keyword">XMLSCHEMA</span> <span class="keyword">option</span><span class="string">';</span><br><span class="line">SET @myschema = (SELECT </span><br><span class="line">Dog.[DogName],Dog.[DogSex] ,Dog.[DogNeutered],Dog.[DogBreed] ,Dog.[KennelArrivalDate] </span><br><span class="line">FROM import.DogKennelArrival Dog</span><br><span class="line">WHERE 1=0</span><br><span class="line">FOR XML AUTO, ELEMENTS, XMLSCHEMA('</span>DogNameSpace<span class="string">'));</span><br><span class="line">PRINT '</span><span class="number">5.3</span> <span class="keyword">Select</span> the schemas <span class="keyword">as</span> an <span class="keyword">output</span> <span class="keyword">to</span> look <span class="keyword">at</span><span class="string">';</span><br><span class="line">SELECT CAST(@myschema AS XML) AS '</span>XMLSchemaCreated<span class="string">';</span><br><span class="line">PRINT '</span><span class="number">5.4</span> <span class="keyword">Create</span> <span class="keyword">Schema</span> Collection<span class="string">'</span><br><span class="line">CREATE XML SCHEMA COLLECTION import.XMLDogKennelArrival AS @myschema;</span><br><span class="line">GO</span></span><br></pre></td></tr></table></figure>
<h2 id="Prove-Create-XML-Schema-Works"><a href="#Prove-Create-XML-Schema-Works" class="headerlink" title="Prove Create XML Schema Works"></a>Prove Create XML Schema Works</h2><p>The first part of the code below code creates a table using the XML schema created in part 5.<br>It then inserts some XML data into the table column which fits the schema, and succeeds.<br>It then inserts some XML data into the table column which doesn’t fit the schema, and fails.<br>In the second part of the code it attempts to declare an XML variable with the XML schema created in part 5.<br>It then sets the variable to some XML that fits the schema, and succeeds.<br>It then sets the variable to some XML that doesn’t the schema, and fails. </p>
<p>Execute the below on the XMLDemo database to see the validation of the XML schema in action. </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> XMLDemo;</span><br><span class="line">GO </span><br><span class="line"><span class="keyword">USE</span> XMLDemo;</span><br><span class="line">GO</span><br><span class="line">PRINT '6.1  <span class="keyword">Drop</span> Dog Kennel Arrival <span class="keyword">XML</span> <span class="keyword">table</span> <span class="keyword">if</span> already <span class="keyword">exists</span><span class="string">';</span><br><span class="line">IF OBJECT_ID('</span>import.DogKennelArrivalXML<span class="string">') IS NOT NULL</span><br><span class="line">	DROP TABLE import.DogKennelArrivalXML;</span><br><span class="line">GO </span><br><span class="line"></span><br><span class="line">PRINT '</span><span class="number">6.2</span>  <span class="keyword">Create</span> Dog Kennel Arrival <span class="keyword">XML</span> <span class="keyword">table</span> <span class="keyword">with</span> <span class="keyword">schema</span> specified <span class="keyword">on</span> <span class="keyword">XML</span> <span class="keyword">Column</span><span class="string">';</span><br><span class="line">CREATE TABLE import.DogKennelArrivalXML</span><br><span class="line">(</span><br><span class="line">[id] INT IDENTITY PRIMARY KEY CLUSTERED</span><br><span class="line">,[FirstInserted] DATETIME NOT NULL DEFAULT GETDATE()</span><br><span class="line">,[LastUpdated] DATETIME NOT NULL DEFAULT GETDATE()</span><br><span class="line">,[XML] XML (import.XMLDogKennelArrival) --here is where we specify the XML schema</span><br><span class="line">);</span><br><span class="line">GO</span><br><span class="line"></span><br><span class="line">PRINT '</span><span class="number">6.3</span> <span class="keyword">Insert</span> Valid <span class="keyword">XML</span> Succesfully<span class="string">';</span><br><span class="line">INSERT INTO import.DogKennelArrivalXML</span><br><span class="line">(</span><br><span class="line">[XML]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">SELECT '</span>&lt;Dog xmlns=<span class="string">"DogNameSpace"</span>&gt;</span><br><span class="line">  &lt;DogName&gt;Harvey&lt;/DogName&gt;</span><br><span class="line">  &lt;DogSex&gt;M&lt;/DogSex&gt;</span><br><span class="line">  &lt;DogNeutered&gt;<span class="number">1</span>&lt;/DogNeutered&gt;</span><br><span class="line">  &lt;DogBreed&gt;German Shepherd&lt;/DogBreed&gt;</span><br><span class="line">  &lt;KennelArrivalDate&gt;<span class="number">2014</span><span class="number">-10</span><span class="number">-01</span>&lt;/KennelArrivalDate&gt;</span><br><span class="line">&lt;/Dog&gt;</span><br><span class="line">&lt;Dog xmlns=<span class="string">"DogNameSpace"</span>&gt;</span><br><span class="line">  &lt;DogName&gt;Lucy&lt;/DogName&gt;</span><br><span class="line">  &lt;DogSex&gt;F&lt;/DogSex&gt;</span><br><span class="line">  &lt;DogNeutered&gt;<span class="number">1</span>&lt;/DogNeutered&gt;</span><br><span class="line">  &lt;DogBreed&gt;Labrador&lt;/DogBreed&gt;</span><br><span class="line">  &lt;KennelArrivalDate&gt;<span class="number">2014</span><span class="number">-12</span><span class="number">-15</span>&lt;/KennelArrivalDate&gt;</span><br><span class="line">&lt;/Dog&gt;</span><br><span class="line">&lt;Dog xmlns=<span class="string">"DogNameSpace"</span>&gt;</span><br><span class="line">  &lt;DogName&gt;Fudge&lt;/DogName&gt;</span><br><span class="line">  &lt;DogSex&gt;M&lt;/DogSex&gt;</span><br><span class="line">  &lt;DogNeutered&gt;<span class="number">1</span>&lt;/DogNeutered&gt;</span><br><span class="line">  &lt;DogBreed&gt;American Bulldog&lt;/DogBreed&gt;</span><br><span class="line">  &lt;KennelArrivalDate&gt;<span class="number">2015</span><span class="number">-01</span><span class="number">-10</span>&lt;/KennelArrivalDate&gt;</span><br><span class="line">&lt;/Dog&gt;<span class="string">';</span><br><span class="line">GO</span><br><span class="line"></span><br><span class="line">PRINT '</span><span class="number">6.3</span> <span class="keyword">Insert</span> Invalid <span class="keyword">XML</span> <span class="keyword">and</span> it fails<span class="string">';</span><br><span class="line">PRINT '</span>It <span class="keyword">is</span> invalid because it has an extra node <span class="keyword">of</span> DogColour <span class="keyword">not</span> defined <span class="keyword">in</span> the <span class="keyword">schema</span><span class="string">';</span><br><span class="line">INSERT INTO import.DogKennelArrivalXML</span><br><span class="line">(</span><br><span class="line">[XML]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">SELECT '</span>&lt;Dog xmlns=<span class="string">"DogNameSpace"</span>&gt;</span><br><span class="line">  &lt;DogName&gt;Harvey&lt;/DogName&gt;</span><br><span class="line">  &lt;DogSex&gt;M&lt;/DogSex&gt;</span><br><span class="line">  &lt;DogColour&gt;Brown&lt;/DogColour&gt;</span><br><span class="line">  &lt;DogNeutered&gt;<span class="number">1</span>&lt;/DogNeutered&gt;</span><br><span class="line">  &lt;DogBreed&gt;German Shepherd&lt;/DogBreed&gt;</span><br><span class="line">  &lt;KennelArrivalDate&gt;<span class="number">2014</span><span class="number">-10</span><span class="number">-01</span>&lt;/KennelArrivalDate&gt;</span><br><span class="line">&lt;/Dog&gt;<span class="string">';</span><br><span class="line">GO</span></span><br></pre></td></tr></table></figure>
<p>You can see the same behaviour if you declare an XML variable with the schema specified. </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">PRINT '6.4 <span class="keyword">Declare</span> <span class="keyword">Variable</span> <span class="keyword">with</span> <span class="keyword">Schema</span> <span class="keyword">Validation</span> <span class="keyword">for</span> Valid <span class="keyword">Data</span> <span class="keyword">and</span> it Works Fine<span class="string">';</span><br><span class="line">DECLARE @xml XML (import.XMLDogKennelArrival) = </span><br><span class="line">N'</span>&lt;Dog xmlns=<span class="string">"DogNameSpace"</span>&gt;</span><br><span class="line">  &lt;DogName&gt;Harvey&lt;/DogName&gt;</span><br><span class="line">  &lt;DogSex&gt;M&lt;/DogSex&gt;</span><br><span class="line">  &lt;DogNeutered&gt;<span class="number">1</span>&lt;/DogNeutered&gt;</span><br><span class="line">  &lt;DogBreed&gt;German Shepherd&lt;/DogBreed&gt;</span><br><span class="line">  &lt;KennelArrivalDate&gt;<span class="number">2014</span><span class="number">-10</span><span class="number">-01</span>&lt;/KennelArrivalDate&gt;</span><br><span class="line">&lt;/Dog&gt;</span><br><span class="line">&lt;Dog xmlns=<span class="string">"DogNameSpace"</span>&gt;</span><br><span class="line">  &lt;DogName&gt;Lucy&lt;/DogName&gt;</span><br><span class="line">  &lt;DogSex&gt;F&lt;/DogSex&gt;</span><br><span class="line">  &lt;DogNeutered&gt;<span class="number">1</span>&lt;/DogNeutered&gt;</span><br><span class="line">  &lt;DogBreed&gt;Labrador&lt;/DogBreed&gt;</span><br><span class="line">  &lt;KennelArrivalDate&gt;<span class="number">2014</span><span class="number">-12</span><span class="number">-15</span>&lt;/KennelArrivalDate&gt;</span><br><span class="line">&lt;/Dog&gt;</span><br><span class="line">&lt;Dog xmlns=<span class="string">"DogNameSpace"</span>&gt;</span><br><span class="line">  &lt;DogName&gt;Fudge&lt;/DogName&gt;</span><br><span class="line">  &lt;DogSex&gt;M&lt;/DogSex&gt;</span><br><span class="line">  &lt;DogNeutered&gt;<span class="number">1</span>&lt;/DogNeutered&gt;</span><br><span class="line">  &lt;DogBreed&gt;American Bulldog&lt;/DogBreed&gt;</span><br><span class="line">  &lt;KennelArrivalDate&gt;<span class="number">2015</span><span class="number">-01</span><span class="number">-10</span>&lt;/KennelArrivalDate&gt;</span><br><span class="line">&lt;/Dog&gt;<span class="string">'</span><br><span class="line">SELECT @xml;</span><br><span class="line">GO</span><br><span class="line"></span><br><span class="line">PRINT '</span><span class="number">6.5</span> <span class="keyword">Declare</span> <span class="keyword">Variable</span> <span class="keyword">with</span> <span class="keyword">Schema</span> <span class="keyword">Validation</span> <span class="keyword">for</span> invalid <span class="keyword">data</span> <span class="keyword">and</span> it fails<span class="string">';</span><br><span class="line">PRINT '</span>It <span class="keyword">is</span> invalid because it has an extra node <span class="keyword">of</span> DogColour <span class="keyword">not</span> defined <span class="keyword">in</span> the <span class="keyword">schema</span><span class="string">';</span><br><span class="line">DECLARE @xml XML (import.XMLDogKennelArrival) = </span><br><span class="line">N'</span>&lt;Dog xmlns=<span class="string">"DogNameSpace"</span>&gt;</span><br><span class="line">  &lt;DogName&gt;Harvey&lt;/DogName&gt;</span><br><span class="line">  &lt;DogSex&gt;M&lt;/DogSex&gt;</span><br><span class="line">  &lt;DogColour&gt;Brown&lt;/DogColour&gt;</span><br><span class="line">  &lt;DogNeutered&gt;<span class="number">1</span>&lt;/DogNeutered&gt;</span><br><span class="line">  &lt;DogBreed&gt;German Shepherd&lt;/DogBreed&gt;</span><br><span class="line">  &lt;KennelArrivalDate&gt;<span class="number">2014</span><span class="number">-10</span><span class="number">-01</span>&lt;/KennelArrivalDate&gt;</span><br><span class="line">&lt;/Dog&gt;<span class="string">';</span><br><span class="line">SELECT @xml;</span><br><span class="line">GO</span></span><br></pre></td></tr></table></figure>
<h2 id="Import-Data-from-XML-Files-into-SQL-Table"><a href="#Import-Data-from-XML-Files-into-SQL-Table" class="headerlink" title="Import Data from XML Files into SQL Table"></a>Import Data from XML Files into SQL Table</h2><p>The following code shows examples of inserts, updates and deletes from XML files (see the <a href="https://github.com/griff182uk/XMLSQL/tree/master/XMLImportFiles" target="_blank" rel="external">XMLImportFiles</a> folder in repo) into SQL server.<br><strong>IMPORTANT NOTE:</strong> For this section to work you must have the XMLImportFiles folder locally and the filepath needs to be correct for the XMLImportFiles in the OPENROWSET bit! See notes on each script where the filepath is. </p>
<p>First we’ll clear down our table, as it is this one we’re going to insert into, by executing the below. </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> XMLDemo;</span><br><span class="line">GO </span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> import.DogKennelArrival;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> import.DogKennelArrival;</span><br><span class="line">GO</span><br></pre></td></tr></table></figure>
<p>Below demonstrates first insert of XML data from the file system using CTE generated from nodes() and a simple MERGE.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">PRINT '7.1 <span class="keyword">INSERT</span> <span class="keyword">XML</span> <span class="keyword">DATA</span><span class="string">'; </span><br><span class="line"></span><br><span class="line">PRINT '</span><span class="number">7.1</span><span class="number">.1</span> <span class="keyword">Set</span> <span class="built_in">Date</span> <span class="keyword">Format</span> <span class="keyword">and</span> <span class="keyword">Declare</span> <span class="keyword">XML</span> <span class="keyword">Variable</span><span class="string">';</span><br><span class="line">SET DATEFORMAT DMY;</span><br><span class="line">DECLARE @xml XML;</span><br><span class="line"></span><br><span class="line">PRINT '</span><span class="number">7.1</span><span class="number">.2</span> <span class="keyword">Use</span> OPENROWSET <span class="keyword">to</span> <span class="keyword">read</span> <span class="keyword">XML</span> <span class="keyword">file</span> <span class="keyword">from</span> filesystem<span class="string">';</span><br><span class="line">SELECT @xml = BulkColumn</span><br><span class="line">FROM OPENROWSET(BULK '</span>\XMLImportFiles\XML_Dog_INSERT.xml<span class="string">' --change path to your environment</span><br><span class="line">, SINGLE_BLOB) TempXML;</span><br><span class="line"></span><br><span class="line">--SELECT @xml; --Look at XML variable here for debugging if required</span><br><span class="line"></span><br><span class="line">PRINT '</span><span class="number">7.1</span><span class="number">.3</span> Generate CTE <span class="keyword">of</span> <span class="keyword">XML</span> <span class="keyword">Data</span> <span class="keyword">in</span> <span class="keyword">Relational</span> <span class="keyword">Format</span> <span class="keyword">Using</span> Nodes <span class="keyword">Function</span><span class="string">';</span><br><span class="line">;WITH CTE AS</span><br><span class="line">(</span><br><span class="line">SELECT </span><br><span class="line">col.value(N'</span>./Sex[<span class="number">1</span>]<span class="string">',N'</span><span class="keyword">nvarchar</span>(<span class="number">100</span>)<span class="string">') AS Sex</span><br><span class="line">,col.value(N'</span>./<span class="keyword">Name</span>[<span class="number">1</span>]<span class="string">',N'</span><span class="keyword">nvarchar</span>(<span class="number">100</span>)<span class="string">') AS Name</span><br><span class="line">,col.value(N'</span>./Neutered[<span class="number">1</span>]<span class="string">',N'</span><span class="keyword">nvarchar</span>(<span class="number">100</span>)<span class="string">') AS Neutered</span><br><span class="line">,col.value(N'</span>./Breed[<span class="number">1</span>]<span class="string">',N'</span><span class="keyword">nvarchar</span>(<span class="number">100</span>)<span class="string">') AS Breed</span><br><span class="line">,col.value(N'</span>./KennelArrivalDate[<span class="number">1</span>]<span class="string">',N'</span><span class="keyword">nvarchar</span>(<span class="number">100</span>)<span class="string">') AS KennelArrivalDate</span><br><span class="line">FROM @xml.nodes(N'</span>//Kennel<span class="comment">/*') Tab(Col)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">--SELECT * FROM CTE --Look at CTE output here for debugging if required</span><br><span class="line"></span><br><span class="line">PRINT '7.1.4 MERGE XML data from CTE into relational table';</span><br><span class="line">MERGE INTO import.DogKennelArrival AS Tgt</span><br><span class="line">USING CTE AS Src ON</span><br><span class="line">src.Name = tgt.DogName</span><br><span class="line">WHEN NOT MATCHED THEN INSERT</span><br><span class="line">(DogName, DogSex, DogNeutered, DogBreed, KennelArrivalDate)</span><br><span class="line">VALUES (Name, Sex, Neutered, Breed, KennelArrivalDate)</span><br><span class="line">WHEN MATCHED AND  </span><br><span class="line">(</span><br><span class="line"> tgt.DogSex &lt;&gt; src.Sex </span><br><span class="line">OR tgt.DogNeutered &lt;&gt;  src.Neutered </span><br><span class="line">OR  tgt.DogBreed &lt;&gt; src.Breed </span><br><span class="line">OR  tgt.KennelArrivalDate &lt;&gt; src.KennelArrivalDate </span><br><span class="line">) THEN UPDATE </span><br><span class="line">SET  tgt.DogSex = src.Sex </span><br><span class="line">, tgt.DogNeutered =  src.Neutered </span><br><span class="line">,  tgt.DogBreed = src.Breed </span><br><span class="line">,  tgt.KennelArrivalDate = src.KennelArrivalDate ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PRINT '7.1.5 Show data successfully MERGED (INSERT) into SQL table';</span><br><span class="line">SELECT * FROM import.DogKennelArrival;</span><br><span class="line"></span><br><span class="line">GO</span></span><br></pre></td></tr></table></figure>
<p>Execute the below to demonstrate the update of XML data from file system using CTE generated from nodes() and simple MERGE.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> XMLDemo;</span><br><span class="line">GO </span><br><span class="line"></span><br><span class="line">PRINT '7.2 <span class="keyword">UPDATE</span> <span class="keyword">XML</span> <span class="keyword">DATA</span><span class="string">'; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PRINT '</span><span class="number">7.2</span><span class="number">.1</span> <span class="keyword">Set</span> <span class="built_in">Date</span> <span class="keyword">Format</span> <span class="keyword">and</span> <span class="keyword">Declare</span> <span class="keyword">XML</span> <span class="keyword">Variable</span><span class="string">';</span><br><span class="line">SET DATEFORMAT DMY;</span><br><span class="line">DECLARE @xml XML;</span><br><span class="line"></span><br><span class="line">PRINT '</span><span class="number">7.2</span><span class="number">.2</span> <span class="keyword">Use</span> OPENROWSET <span class="keyword">to</span> <span class="keyword">read</span> <span class="keyword">XML</span> <span class="keyword">file</span> <span class="keyword">from</span> filesystem<span class="string">';</span><br><span class="line">SELECT @xml = BulkColumn</span><br><span class="line">FROM OPENROWSET(BULK '</span>\XMLImportFiles\XML_Dog_UPDATE.xml<span class="string">'--change path to your environment</span><br><span class="line">, SINGLE_BLOB) TempXML;</span><br><span class="line"></span><br><span class="line">--SELECT @xml; --Look at XML variable here for debugging if required</span><br><span class="line"></span><br><span class="line">PRINT '</span><span class="number">7.2</span><span class="number">.3</span> Generate CTE <span class="keyword">of</span> <span class="keyword">XML</span> <span class="keyword">Data</span> <span class="keyword">in</span> <span class="keyword">Relational</span> <span class="keyword">Format</span> <span class="keyword">Using</span> Nodes <span class="keyword">Function</span><span class="string">';</span><br><span class="line">;WITH CTE AS</span><br><span class="line">(</span><br><span class="line">SELECT </span><br><span class="line">col.value(N'</span>./Sex[<span class="number">1</span>]<span class="string">',N'</span><span class="keyword">nvarchar</span>(<span class="number">100</span>)<span class="string">') AS Sex</span><br><span class="line">,col.value(N'</span>./<span class="keyword">Name</span>[<span class="number">1</span>]<span class="string">',N'</span><span class="keyword">nvarchar</span>(<span class="number">100</span>)<span class="string">') AS Name</span><br><span class="line">,col.value(N'</span>./Neutered[<span class="number">1</span>]<span class="string">',N'</span><span class="keyword">nvarchar</span>(<span class="number">100</span>)<span class="string">') AS Neutered</span><br><span class="line">,col.value(N'</span>./Breed[<span class="number">1</span>]<span class="string">',N'</span><span class="keyword">nvarchar</span>(<span class="number">100</span>)<span class="string">') AS Breed</span><br><span class="line">,col.value(N'</span>./KennelArrivalDate[<span class="number">1</span>]<span class="string">',N'</span><span class="keyword">nvarchar</span>(<span class="number">100</span>)<span class="string">') AS KennelArrivalDate</span><br><span class="line">FROM @xml.nodes(N'</span>//Kennel<span class="comment">/*') Tab(Col)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">--SELECT * FROM CTE --Look at CTE output here for debugging if required</span><br><span class="line"></span><br><span class="line">PRINT '7.2.4 MERGE XML data from CTE into relational table';</span><br><span class="line">MERGE INTO import.DogKennelArrival AS Tgt</span><br><span class="line">USING CTE AS Src ON</span><br><span class="line">src.Name = tgt.DogName</span><br><span class="line">WHEN NOT MATCHED THEN INSERT</span><br><span class="line">(DogName, DogSex, DogNeutered, DogBreed, KennelArrivalDate)</span><br><span class="line">VALUES (Name, Sex, Neutered, Breed, KennelArrivalDate)</span><br><span class="line">WHEN MATCHED AND  </span><br><span class="line">(</span><br><span class="line"> tgt.DogSex &lt;&gt; src.Sex </span><br><span class="line">OR tgt.DogNeutered &lt;&gt;  src.Neutered </span><br><span class="line">OR  tgt.DogBreed &lt;&gt; src.Breed </span><br><span class="line">OR  tgt.KennelArrivalDate &lt;&gt; src.KennelArrivalDate </span><br><span class="line">) THEN UPDATE </span><br><span class="line">SET  tgt.DogSex = src.Sex </span><br><span class="line">, tgt.DogNeutered =  src.Neutered </span><br><span class="line">,  tgt.DogBreed = src.Breed </span><br><span class="line">,  tgt.KennelArrivalDate = src.KennelArrivalDate ;</span><br><span class="line"></span><br><span class="line">PRINT '7.2.6 Can see that UPDATES have taken place';</span><br><span class="line">PRINT 'Fudge is now neutered and Lucy is in fact a Golden Retriever!';</span><br><span class="line">SELECT * FROM import.DogKennelArrival;</span><br><span class="line"></span><br><span class="line">GO</span></span><br></pre></td></tr></table></figure>
<p>Execute the below to demonstrate delete of XML data from file system using CTE generated from nodes() and simple MERGE.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> XMLDemo;</span><br><span class="line">GO </span><br><span class="line">PRINT '7.3 <span class="keyword">DELETE</span> <span class="keyword">XML</span> <span class="keyword">DATA</span> - (<span class="keyword">MERGE</span> <span class="keyword">STATEMENT</span> HAS EXTRA <span class="keyword">DELETE</span> CRITERIA)<span class="string">';</span><br><span class="line"></span><br><span class="line">PRINT '</span><span class="number">7.3</span><span class="number">.1</span> <span class="keyword">Set</span> <span class="built_in">Date</span> <span class="keyword">Format</span> <span class="keyword">and</span> <span class="keyword">Declare</span> <span class="keyword">XML</span> <span class="keyword">Variable</span><span class="string">';</span><br><span class="line">SET DATEFORMAT DMY;</span><br><span class="line">DECLARE @xml XML;</span><br><span class="line"></span><br><span class="line">PRINT '</span><span class="number">7.3</span><span class="number">.2</span> <span class="keyword">Use</span> OPENROWSET <span class="keyword">to</span> <span class="keyword">read</span> <span class="keyword">XML</span> <span class="keyword">file</span> <span class="keyword">from</span> filesystem<span class="string">';</span><br><span class="line">SELECT @xml = BulkColumn</span><br><span class="line">FROM OPENROWSET(BULK '</span>\XMLImportFiles\XML_Dog_DELETE.xml<span class="string">'--change path to your environment</span><br><span class="line">, SINGLE_BLOB) TempXML;</span><br><span class="line"></span><br><span class="line">--SELECT @xml; --Look at XML variable here for debugging if required</span><br><span class="line"></span><br><span class="line">PRINT '</span><span class="number">7.3</span><span class="number">.3</span> Generate CTE <span class="keyword">of</span> <span class="keyword">XML</span> <span class="keyword">Data</span> <span class="keyword">in</span> <span class="keyword">Relational</span> <span class="keyword">Format</span> <span class="keyword">Using</span> Nodes <span class="keyword">Function</span><span class="string">';</span><br><span class="line">PRINT '</span>Note: added <span class="keyword">delete</span> <span class="keyword">column</span><span class="string">';</span><br><span class="line">;WITH CTE AS</span><br><span class="line">(</span><br><span class="line">SELECT </span><br><span class="line">col.value(N'</span>./Sex[<span class="number">1</span>]<span class="string">',N'</span><span class="keyword">nvarchar</span>(<span class="number">100</span>)<span class="string">') AS Sex</span><br><span class="line">,col.value(N'</span>./<span class="keyword">Name</span>[<span class="number">1</span>]<span class="string">',N'</span><span class="keyword">nvarchar</span>(<span class="number">100</span>)<span class="string">') AS Name</span><br><span class="line">,col.value(N'</span>./Neutered[<span class="number">1</span>]<span class="string">',N'</span><span class="keyword">nvarchar</span>(<span class="number">100</span>)<span class="string">') AS Neutered</span><br><span class="line">,col.value(N'</span>./Breed[<span class="number">1</span>]<span class="string">',N'</span><span class="keyword">nvarchar</span>(<span class="number">100</span>)<span class="string">') AS Breed</span><br><span class="line">,col.value(N'</span>./KennelArrivalDate[<span class="number">1</span>]<span class="string">',N'</span><span class="keyword">nvarchar</span>(<span class="number">100</span>)<span class="string">') AS KennelArrivalDate</span><br><span class="line">,col.value(N'</span>./<span class="keyword">Delete</span>[<span class="number">1</span>]<span class="string">',N'</span><span class="keyword">nvarchar</span>(<span class="number">100</span>)<span class="string">') AS [Delete]</span><br><span class="line">FROM @xml.nodes(N'</span>//Kennel<span class="comment">/*') Tab(Col)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">--SELECT * FROM CTE --Look at CTE output here for debugging if required</span><br><span class="line"></span><br><span class="line">PRINT '7.3.4 MERGE XML data from CTE into relational table';</span><br><span class="line">MERGE INTO import.DogKennelArrival AS Tgt</span><br><span class="line">USING CTE AS Src ON</span><br><span class="line">src.Name = tgt.DogName</span><br><span class="line">WHEN NOT MATCHED THEN INSERT</span><br><span class="line">(DogName, DogSex, DogNeutered, DogBreed, KennelArrivalDate)</span><br><span class="line">VALUES (Name, Sex, Neutered, Breed, KennelArrivalDate)</span><br><span class="line">WHEN MATCHED AND  </span><br><span class="line">(</span><br><span class="line"> tgt.DogSex &lt;&gt; src.Sex </span><br><span class="line">OR tgt.DogNeutered &lt;&gt;  src.Neutered </span><br><span class="line">OR  tgt.DogBreed &lt;&gt; src.Breed </span><br><span class="line">OR  tgt.KennelArrivalDate &lt;&gt; src.KennelArrivalDate </span><br><span class="line">) THEN UPDATE </span><br><span class="line">SET  tgt.DogSex = src.Sex </span><br><span class="line">, tgt.DogNeutered =  src.Neutered </span><br><span class="line">,  tgt.DogBreed = src.Breed </span><br><span class="line">,  tgt.KennelArrivalDate = src.KennelArrivalDate </span><br><span class="line">WHEN MATCHED AND [Delete] = 'true'</span><br><span class="line">THEN DELETE;</span><br><span class="line"></span><br><span class="line">PRINT '7.3.5 Harvey has been deleted from the Kennel (I''ve taken him home!)';</span><br><span class="line">SELECT * FROM import.DogKennelArrival;</span><br><span class="line"></span><br><span class="line">GO</span></span><br></pre></td></tr></table></figure>
<p>Execute the below to demonstrate insert of sparse XML data from file system using CTE generated from nodes() and simple MERGE.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> XMLDemo;</span><br><span class="line">GO </span><br><span class="line">PRINT '7.4 <span class="keyword">INSERT</span> <span class="keyword">SPARSE</span> <span class="keyword">XML</span><span class="string">';</span><br><span class="line"></span><br><span class="line">PRINT '</span><span class="number">7.4</span><span class="number">.1</span> <span class="keyword">Set</span> <span class="built_in">Date</span> <span class="keyword">Format</span> <span class="keyword">and</span> <span class="keyword">Declare</span> <span class="keyword">XML</span> <span class="keyword">Variable</span><span class="string">';</span><br><span class="line">SET DATEFORMAT DMY;</span><br><span class="line">DECLARE @xml XML;</span><br><span class="line"></span><br><span class="line">PRINT '</span><span class="number">7.4</span><span class="number">.2</span> <span class="keyword">Use</span> OPENROWSET <span class="keyword">to</span> <span class="keyword">read</span> <span class="keyword">XML</span> <span class="keyword">file</span> <span class="keyword">from</span> filesystem<span class="string">'; </span><br><span class="line">SELECT @xml = BulkColumn</span><br><span class="line">FROM OPENROWSET(BULK '</span>\XMLImportFiles\XML_Dog_SPARSE.xml<span class="string">', SINGLE_BLOB) TempXML;</span><br><span class="line"></span><br><span class="line">--SELECT @xml; --Look at XML variable here for debugging if required</span><br><span class="line"></span><br><span class="line">PRINT '</span><span class="number">7.4</span><span class="number">.3</span> Generate CTE <span class="keyword">of</span> <span class="keyword">XML</span> <span class="keyword">Data</span> <span class="keyword">in</span> <span class="keyword">Relational</span> <span class="keyword">Format</span> <span class="keyword">Using</span> Nodes <span class="keyword">Function</span><span class="string">';</span><br><span class="line">PRINT '</span>Note: added <span class="keyword">delete</span> <span class="keyword">column</span><span class="string">';</span><br><span class="line">;WITH CTE AS</span><br><span class="line">(</span><br><span class="line">SELECT </span><br><span class="line">COALESCE(col.value(N'</span>./Sex[<span class="number">1</span>]<span class="string">',N'</span><span class="keyword">nvarchar</span>(<span class="number">100</span>)<span class="string">'),'') AS Sex</span><br><span class="line">,COALESCE(col.value(N'</span>./<span class="keyword">Name</span>[<span class="number">1</span>]<span class="string">',N'</span><span class="keyword">nvarchar</span>(<span class="number">100</span>)<span class="string">'),'') AS Name</span><br><span class="line">,COALESCE(col.value(N'</span>./Neutered[<span class="number">1</span>]<span class="string">',N'</span><span class="keyword">nvarchar</span>(<span class="number">100</span>)<span class="string">'),'') AS Neutered</span><br><span class="line">,COALESCE(col.value(N'</span>./Breed[<span class="number">1</span>]<span class="string">',N'</span><span class="keyword">nvarchar</span>(<span class="number">100</span>)<span class="string">'),'') AS Breed</span><br><span class="line">,COALESCE(col.value(N'</span>./KennelArrivalDate[<span class="number">1</span>]<span class="string">',N'</span><span class="keyword">nvarchar</span>(<span class="number">100</span>)<span class="string">'),'') AS KennelArrivalDate</span><br><span class="line">,col.value(N'</span>./<span class="keyword">Delete</span>[<span class="number">1</span>]<span class="string">',N'</span><span class="keyword">nvarchar</span>(<span class="number">100</span>)<span class="string">') AS [Delete]</span><br><span class="line">FROM @xml.nodes(N'</span>//Kennel<span class="comment">/*') Tab(Col)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">--SELECT * FROM CTE --Look at CTE output here for debugging if required</span><br><span class="line"></span><br><span class="line">PRINT '7.4.4 MERGE XML data from CTE into relational table';</span><br><span class="line">MERGE INTO import.DogKennelArrival AS Tgt</span><br><span class="line">USING CTE AS Src ON</span><br><span class="line">src.Name = tgt.DogName</span><br><span class="line">WHEN NOT MATCHED THEN INSERT</span><br><span class="line">(DogName, DogSex, DogNeutered, DogBreed, KennelArrivalDate)</span><br><span class="line">VALUES (Name, Sex, Neutered, Breed, KennelArrivalDate)</span><br><span class="line">WHEN MATCHED AND  </span><br><span class="line">(</span><br><span class="line"> tgt.DogSex &lt;&gt; src.Sex </span><br><span class="line">OR tgt.DogNeutered &lt;&gt;  src.Neutered </span><br><span class="line">OR  tgt.DogBreed &lt;&gt; src.Breed </span><br><span class="line">OR  tgt.KennelArrivalDate &lt;&gt; src.KennelArrivalDate </span><br><span class="line">) THEN UPDATE </span><br><span class="line">SET  tgt.DogSex = src.Sex </span><br><span class="line">, tgt.DogNeutered =  src.Neutered </span><br><span class="line">,  tgt.DogBreed = src.Breed </span><br><span class="line">,  tgt.KennelArrivalDate = src.KennelArrivalDate </span><br><span class="line">WHEN MATCHED AND [Delete] = 'true'</span><br><span class="line">THEN DELETE;</span><br><span class="line"></span><br><span class="line">SELECT * FROM import.DogKennelArrival;</span><br><span class="line"></span><br><span class="line">GO</span></span><br></pre></td></tr></table></figure>
<p>Execute the below to demonstrate the addition of a column to the XML data from file system using CTE generated from nodes() and simple MERGE.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> XMLDemo;</span><br><span class="line">GO </span><br><span class="line"></span><br><span class="line">PRINT '7.5 Add Extra Field';</span><br><span class="line"></span><br><span class="line">PRINT '7.5.1 Add Extra Column';</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> import.DogKennelArrival</span><br><span class="line"><span class="keyword">ADD</span> DogColour <span class="built_in">VARCHAR</span>(<span class="number">25</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>;</span><br><span class="line">GO</span><br><span class="line"></span><br><span class="line">PRINT '7.5.2 <span class="keyword">Set</span> <span class="built_in">Date</span> <span class="keyword">Format</span> <span class="keyword">and</span> <span class="keyword">Declare</span> <span class="keyword">XML</span> <span class="keyword">Variable</span><span class="string">';</span><br><span class="line">SET DATEFORMAT DMY;</span><br><span class="line">DECLARE @xml XML;</span><br><span class="line"></span><br><span class="line">PRINT '</span><span class="number">7.5</span><span class="number">.3</span> <span class="keyword">Use</span> OPENROWSET <span class="keyword">to</span> <span class="keyword">read</span> <span class="keyword">XML</span> <span class="keyword">file</span> <span class="keyword">from</span> filesystem<span class="string">'; </span><br><span class="line">SELECT @xml = BulkColumn</span><br><span class="line">FROM OPENROWSET(BULK '</span>\XMLImportFiles\XML_Dog_ADDITEM.xml<span class="string">', SINGLE_BLOB) TempXML;</span><br><span class="line"></span><br><span class="line">--SELECT @xml; --Look at XML variable here for debugging if required</span><br><span class="line"></span><br><span class="line">PRINT '</span><span class="number">7.5</span><span class="number">.4</span> Generate CTE <span class="keyword">of</span> <span class="keyword">XML</span> <span class="keyword">Data</span> <span class="keyword">in</span> <span class="keyword">Relational</span> <span class="keyword">Format</span> <span class="keyword">Using</span> Nodes <span class="keyword">Function</span><span class="string">';</span><br><span class="line">--Note: added delete column'</span>;</span><br><span class="line">;WITH CTE AS</span><br><span class="line">(</span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line"><span class="keyword">COALESCE</span>(col.value(N<span class="string">'./Sex[1]'</span>,N<span class="string">'nvarchar(100)'</span>),<span class="string">''</span>) <span class="keyword">AS</span> Sex</span><br><span class="line">,<span class="keyword">COALESCE</span>(col.value(N<span class="string">'./Name[1]'</span>,N<span class="string">'nvarchar(100)'</span>),<span class="string">''</span>) <span class="keyword">AS</span> <span class="keyword">Name</span></span><br><span class="line">,<span class="keyword">COALESCE</span>(col.value(N<span class="string">'./Neutered[1]'</span>,N<span class="string">'nvarchar(100)'</span>),<span class="string">''</span>) <span class="keyword">AS</span> Neutered</span><br><span class="line">,<span class="keyword">COALESCE</span>(col.value(N<span class="string">'./Breed[1]'</span>,N<span class="string">'nvarchar(100)'</span>),<span class="string">''</span>) <span class="keyword">AS</span> Breed</span><br><span class="line">,<span class="keyword">coalesce</span>(col.value(N<span class="string">'./KennelArrivalDate[1]'</span>,N<span class="string">'nvarchar(100)'</span>),<span class="string">''</span>) <span class="keyword">AS</span> KennelArrivalDate</span><br><span class="line">,<span class="keyword">COALESCE</span>(col.value(N<span class="string">'./Colour[1]'</span>,N<span class="string">'nvarchar(100)'</span>),<span class="string">''</span>) <span class="keyword">AS</span> Colour</span><br><span class="line">,col.value(N<span class="string">'./Delete[1]'</span>,N<span class="string">'nvarchar(100)'</span>) <span class="keyword">AS</span> [<span class="keyword">Delete</span>]</span><br><span class="line"><span class="keyword">FROM</span> @xml.nodes(N<span class="string">'//Kennel/*'</span>) Tab(<span class="keyword">Col</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">--SELECT * FROM CTE --Look at CTE output here for debugging if required</span></span><br><span class="line"></span><br><span class="line">PRINT <span class="string">'7.5.6 MERGE XML data from CTE into relational table'</span>;</span><br><span class="line"><span class="keyword">MERGE</span> <span class="keyword">INTO</span> import.DogKennelArrival <span class="keyword">AS</span> Tgt</span><br><span class="line"><span class="keyword">USING</span> CTE <span class="keyword">AS</span> Src <span class="keyword">ON</span></span><br><span class="line">src.Name = tgt.DogName</span><br><span class="line"><span class="keyword">WHEN</span> <span class="keyword">NOT</span> <span class="keyword">MATCHED</span> <span class="keyword">THEN</span> <span class="keyword">INSERT</span></span><br><span class="line">(DogName, DogSex, DogNeutered, DogBreed, KennelArrivalDate, DogColour)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="keyword">Name</span>, Sex, Neutered, Breed, KennelArrivalDate, Colour)</span><br><span class="line"><span class="keyword">WHEN</span> <span class="keyword">MATCHED</span> <span class="keyword">AND</span>  </span><br><span class="line">(</span><br><span class="line"> tgt.DogSex &lt;&gt; src.Sex </span><br><span class="line"><span class="keyword">OR</span> tgt.DogNeutered &lt;&gt;  src.Neutered </span><br><span class="line"><span class="keyword">OR</span>  tgt.DogBreed &lt;&gt; src.Breed </span><br><span class="line"><span class="keyword">OR</span>  tgt.KennelArrivalDate &lt;&gt; src.KennelArrivalDate </span><br><span class="line"><span class="keyword">OR</span>  tgt.DogColour &lt;&gt; src.Colour </span><br><span class="line">) <span class="keyword">THEN</span> <span class="keyword">UPDATE</span> </span><br><span class="line"><span class="keyword">SET</span>  tgt.DogSex = src.Sex </span><br><span class="line">, tgt.DogNeutered =  src.Neutered </span><br><span class="line">,  tgt.DogBreed = src.Breed </span><br><span class="line">,  tgt.KennelArrivalDate = src.KennelArrivalDate </span><br><span class="line">, tgt.DogColour = src.Colour </span><br><span class="line"><span class="keyword">WHEN</span> <span class="keyword">MATCHED</span> <span class="keyword">AND</span> [<span class="keyword">Delete</span>] = <span class="string">'true'</span></span><br><span class="line"><span class="keyword">THEN</span> <span class="keyword">DELETE</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> import.DogKennelArrival;</span><br><span class="line"></span><br><span class="line">GO</span><br></pre></td></tr></table></figure>
<h2 id="Create-CSV-from-Row-Data"><a href="#Create-CSV-from-Row-Data" class="headerlink" title="Create CSV from Row Data"></a>Create CSV from Row Data</h2><p>This is really useful for multiple instances per event, e.g. diagnosis or procedures per an admission).</p>
<p>Execute the code below to see the row based data transform into a comma delimited list on a single row…</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> XMLDemo;</span><br><span class="line">GO </span><br><span class="line">PRINT '8.1 <span class="keyword">Create</span> small demo <span class="keyword">table</span> <span class="keyword">of</span> <span class="keyword">values</span><span class="string">';</span><br><span class="line">DECLARE @Table1 TABLE(AdmissionID INT, Diagnosis VARCHAR(100));</span><br><span class="line">INSERT INTO @Table1 VALUES (1,'</span>Heart <span class="keyword">Failure</span><span class="string">'),(1,'</span>Brain Pain<span class="string">')</span><br><span class="line">,(1,'</span>Leg damage<span class="string">'),(1,'</span>Knee twist<span class="string">'),(1,'</span>Eye bulge<span class="string">')</span><br><span class="line">,(2,'</span>Cholera<span class="string">'),(3,'</span>Tuberculosis<span class="string">'),(2,'</span>Lurgy<span class="string">'),(3,'</span>Spots<span class="string">');</span><br><span class="line">SELECT * FROM @Table1;</span><br><span class="line"></span><br><span class="line">PRINT '</span><span class="number">8.2</span> Us <span class="keyword">XML</span> <span class="keyword">path</span> <span class="keyword">and</span> <span class="keyword">Stuff</span> <span class="keyword">to</span> <span class="keyword">convert</span> <span class="keyword">into</span> comma <span class="keyword">delimited</span> <span class="keyword">string</span><span class="string">';</span><br><span class="line">SELECT  AdmissionID</span><br><span class="line">       ,STUFF((SELECT '</span>, <span class="string">' + CAST(Diagnosis AS VARCHAR(10)) [text()]</span><br><span class="line">         FROM @Table1 </span><br><span class="line">         WHERE AdmissionID = t.AdmissionID</span><br><span class="line">FOR XML PATH('')),1,1,'')</span><br><span class="line">FROM @Table1 t</span><br><span class="line">GROUP BY AdmissionID;</span></span><br></pre></td></tr></table></figure>
<p>To demonstrate the speed of this, execute the following code, which first generates a million rows of data then performs the same logic as above!</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">PRINT '8.3.1 <span class="keyword">Create</span> tally <span class="keyword">table</span> <span class="keyword">to</span> <span class="keyword">CROSS</span> <span class="keyword">JOIN</span> <span class="keyword">in</span> part <span class="number">2</span><span class="string">';</span><br><span class="line">DECLARE @rows INT = 1000000;</span><br><span class="line"></span><br><span class="line">IF OBJECT_ID('</span>tempdb..#tally<span class="string">') IS NOT NULL</span><br><span class="line">	DROP TABLE #tally;</span><br><span class="line"></span><br><span class="line">WITH cte as </span><br><span class="line">(</span><br><span class="line">	SELECT 1 as n</span><br><span class="line">	UNION ALL</span><br><span class="line">	SELECT n +1</span><br><span class="line">	FROM cte</span><br><span class="line">	WHERE n &lt; @rows</span><br><span class="line">)</span><br><span class="line">SELECT *</span><br><span class="line">	INTO #tally </span><br><span class="line">FROM cte </span><br><span class="line">OPTION (MAXRECURSION 0);  </span><br><span class="line">GO </span><br><span class="line"></span><br><span class="line">PRINT '</span><span class="number">8.3</span><span class="number">.2</span> See <span class="keyword">Rows</span> <span class="keyword">get</span> turned <span class="keyword">to</span> CSV Very Quickly!<span class="string">';</span><br><span class="line">;WITH CTE AS</span><br><span class="line">(</span><br><span class="line">SELECT n AS AdmissionID, Diagnosis FROM #tally</span><br><span class="line">CROSS JOIN  (SELECT '</span>Cough<span class="string">' AS Diagnosis UNION SELECT '</span>Sneeze<span class="string">' UNION SELECT '</span>Hiccups<span class="string">') AS b</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">SELECT  AdmissionID</span><br><span class="line">       ,STUFF((SELECT '</span>, <span class="string">' + CAST(Diagnosis AS VARCHAR(10)) [text()]</span><br><span class="line">         FROM Cte </span><br><span class="line">         WHERE AdmissionID = t.AdmissionID</span><br><span class="line">FOR XML PATH('')),1,1,'')</span><br><span class="line">FROM CTE t</span><br><span class="line">GROUP BY t.AdmissionID;</span><br><span class="line">GO</span></span><br></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[BIML a Stage ETL]]></title>
      <url>www.datagriff.com/2017/04/BIML-a-Stage-ETL/</url>
      <content type="html"><![CDATA[<h2 id="Title-of-Post"><a href="#Title-of-Post" class="headerlink" title="Title of Post"></a>Title of Post</h2><p>This post is going to show you how to create a basic stage import process using BIML with SSIS. BIML stands for Business Intelligence Markup language and was invented by Scott Currie for faster, repeatable, and a more design driven approach to SSIS development.<br>Combining the XML that is used to build SSIS packages with metadata retrieved using C# methods from the database level, BIML is an extremely powerful tool to generate multiple standard SSIS packages very quickly. It’s pretty darn awesome.</p>
<p>In order to use BIML you’re going to need visual studio with business intelligence tools installed, BIDS helper and also BIML script from Varigence.<br>All the code for this demo can be found in my github repository here.</p>
<p><strong>What we’re going to do:</strong></p>
<ul>
<li>Quick BIML - so you know it’s real</li>
<li>Design a Stage Import Process</li>
<li>Create the BIML Script</li>
<li>Modular Common BIML Scripts</li>
<li>Further Resources</li>
</ul>
<h3 id="Quick-BIML"><a href="#Quick-BIML" class="headerlink" title="Quick BIML"></a>Quick BIML</h3><p>To ensure you don’t lose interest, lets see</p>
<h3 id="Design-Stage-Import-Process"><a href="#Design-Stage-Import-Process" class="headerlink" title="Design Stage Import Process"></a>Design Stage Import Process</h3>
<h3 id="Create-the-BIML-Script"><a href="#Create-the-BIML-Script" class="headerlink" title="Create the BIML Script"></a>Create the BIML Script</h3>
<h3 id="Modular-Common-BIML-Script"><a href="#Modular-Common-BIML-Script" class="headerlink" title="Modular Common BIML Script"></a>Modular Common BIML Script</h3><h3 id="Further-resources"><a href="#Further-resources" class="headerlink" title="Further resources"></a>Further resources</h3><p>There also are a host of other resources (e.g. Catherine Wilhelmsons blog), more detailed walkthroughs (including the BIMLScript website) elsewhere on the web.<br>The complete BIML documentation for al the XML elements and attributes can be found here.</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Passing the 70462 Exam and Lessons Learned]]></title>
      <url>www.datagriff.com/2016/12/Passing-the-70462-Exam-and-Lessons-Learned/</url>
      <content type="html"><![CDATA[<p>Okay so I just about managed to pass my SQL Admin 70-462 exam and get my SQL 2012 MCSA (yay!), but I definitely didn’t make life easy for myself. I had planned to record videos of all the exercises in the <a href="https://www.amazon.co.uk/Training-Kit-Exam-70-462-Administering/dp/0735666075/ref=sr_1_1?ie=UTF8&amp;qid=1481978989&amp;sr=8-1&amp;keywords=70-462+training+kit_" target="_blank" rel="external">Training Kit Book</a>, along with <a href="http://www.datagriff.com/tags/Exam-70462/">blogging details about every chapter</a>, obviously combined with learning a load of new concepts, all in just over 30 days…</p>
<h1 id="Lessons-Learned-about-Preparing-for-the-Exam"><a href="#Lessons-Learned-about-Preparing-for-the-Exam" class="headerlink" title="Lessons Learned about Preparing for the Exam"></a>Lessons Learned about Preparing for the Exam</h1><ul>
<li>Don’t just take the exam questions that come with the training kit to give you confidence. I smashed this exam 4 days before the exam quite a few times thinking I was good to go. Then I remembered I had a <a href="https://www.cbtnuggets.com/" target="_blank" rel="external">cbtNuggets</a> subscription which also had practice exams. 3 Days before the exam and I had 40%! I quickly started cramming all the things I wasn’t up to speed on and luckily I got away with it. You can get other practice exams from <a href="http://www.measureup.com/" target="_blank" rel="external">measureup</a> too.</li>
<li>Give yourself time to setup the test environment if you’re going to perform the exercises! This took me a good 2 weeks to setup before I even started the main exercises or revision. Luckily I found someone else’s blog to help, I blogged about the whole affair in my <a href="http://www.datagriff.com/2016/10/SQL-2012-Admin-Exam-01-Prepare-Environment/">first blog for this exam</a>.</li>
<li>Online <a href="https://www.youtube.com/watch?v=7c2FUqUySDE" target="_blank" rel="external">summary videos</a> are a great way to get some tips in the last week before your exam.</li>
<li>I think carrying out exercises to cement the ideas in your mind are essential, but videoing them when you have limited time may not be the best idea! If you’re interested in my rushed endeavours you can see my playlist of the exercises <a href="https://www.youtube.com/playlist?list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1" target="_blank" rel="external">here</a>.</li>
</ul>
<h1 id="Lessons-Learned-about-Blogging"><a href="#Lessons-Learned-about-Blogging" class="headerlink" title="Lessons Learned about Blogging"></a>Lessons Learned about Blogging</h1><ul>
<li>Don’t replace personal revision notes with blogging, use blogging to talk about something you’re passionate about. I’d planned on producing really good blogs on each chapter of SQL 2012 Administration for others to follow, and to also act as a good summary revision material for myself. I duly failed as I rushed to meet my exam deadline and ended up just producing rough notes with links to the videos.</li>
<li>For a much better example of what I should have done (i.e. just a summary of my experience and lessons learned) check out this post from <a href="https://www.cathrinewilhelmsen.net/2015/05/26/preparing-for-and-taking-exam-70-462-administering-microsoft-sql-server-2012-databases/" target="_blank" rel="external">Catherine Wilhelmson</a> which is what I read in my run up to the exam and gave some great tips.</li>
</ul>
<p>Anyway I look forward to the new year, getting stuck into some exciting tech and blogging with passion and verbosity!</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[SQL 2012 Admin Exam 12 SQL Agent Backup and Restore]]></title>
      <url>www.datagriff.com/2016/11/SQL-2012-Admin-Exam-12-SQL-Agent-Backup-and-Restore/</url>
      <content type="html"><![CDATA[<h3 id="Video-Exercises"><a href="#Video-Exercises" class="headerlink" title="Video Exercises"></a>Video Exercises</h3><ul>
<li><a href="https://www.youtube.com/watch?v=etyataFYx08&amp;t=3s&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1&amp;index=61" target="_blank" rel="external">SQL 2012 Configure SQL Agent</a></li>
<li><a href="https://www.youtube.com/watch?v=HjnnRYN3uI4&amp;t=36s&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1&amp;index=62" target="_blank" rel="external">SQL 2012 Create Agent Job</a></li>
<li><a href="https://www.youtube.com/watch?v=QL6_GvZkokY&amp;t=3s&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1&amp;index=63" target="_blank" rel="external">SQL 2012 Create Operator</a></li>
<li><a href="https://www.youtube.com/watch?v=z2MtAQ4gx3k&amp;t=2s&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1&amp;index=64" target="_blank" rel="external">SQL 2012 Create Alert</a></li>
<li><a href="https://www.youtube.com/watch?v=EWyvEjr1wQo&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1&amp;index=65" target="_blank" rel="external">SQL 2012 Create Backup Device</a></li>
<li><a href="https://www.youtube.com/watch?v=Urtcxw_tqG4&amp;t=3s&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1&amp;index=66" target="_blank" rel="external">SQL 2012 Perform Backups</a></li>
<li><a href="https://www.youtube.com/watch?v=G9RgSGSCr4s&amp;t=3s&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1&amp;index=67" target="_blank" rel="external">SQL 2012 Restore a Database</a></li>
</ul>
<h3 id="Key-Terms"><a href="#Key-Terms" class="headerlink" title="Key Terms"></a>Key Terms</h3><ul>
<li><strong>SQL Server Agent</strong> - Automates execution of jobs.</li>
<li><strong>SQL Server Agent Service account</strong> - Requires logon as a service right, membership of windows 2000 compatible access security group at domain level, should not be member of local Administrators, must be member of SQL sysadmin server role.</li>
<li><strong>SQLAgentUserRole</strong> - Least privileges, local jobs and scheduled jobs they own. No to multi-server.</li>
<li><strong>SQLAgentReaderRole</strong> - Includes above and view properties and histories of all jobs and schedules. Yes to multi-server.</li>
<li><strong>SQLAgentOperatorRole</strong> - As above and can start, stop, delete history of any local job. Also enable and disable schedules.</li>
<li><strong>SQL Agent Error Log</strong> - Warnings and errors about sql agent. Found under sql agent.</li>
<li><strong>Alerts</strong> - When certain condition met (performance, WMI events) can trigger an alert.</li>
<li><strong>Job Activity Monitor</strong> - To monitor job activity!  </li>
<li><p><strong>Operators</strong> - Who receive notifications. Email, pager notifications, net send.</p>
</li>
<li><p><strong>Full Database Backup</strong> - Everything backed up and all transactions during full backup.</p>
</li>
<li><strong>Differential Backups</strong> - Backups what changed since last FULL, even if differentials in between. Always since last full.</li>
<li><strong>Transaction Log Backups</strong> - Backs up changes since last transaction log backup and truncates transaction log.</li>
<li><strong>File and FileGroup Backups</strong> - Backs up individual files and filegroups, must back up transaction log.</li>
<li><strong>Copy-Only Backup</strong> - Functionally same as full or transaction log backups but do not mess up backup sequence.</li>
<li><strong>Backup Compression</strong> - Saves disk space but increases CPU.</li>
<li><strong>Recovery Point Objective (RPO)</strong> - Allowable data loss in event of failure.</li>
<li><strong>Simple Recovery Mode</strong> - No transaction, no point in time, just last full backup.</li>
<li><strong>Full Recovery Mode</strong> - Transaction logs and allows for point in time.</li>
<li><strong>Bulk-Logged Recovery Mode</strong> - Special for bulk operations, minimises transaction log, no point in time recovery.</li>
<li><strong>Database Checkpoint</strong> - writes modifies pages held in memory to disk and records in transaction log.</li>
<li><p><strong>Media Set</strong> - single file, multiple files, tape, multiple tapes, up to 32 backup devices.</p>
</li>
<li><p><strong>RESTORE WITH RECOVERY</strong> - Restores database back to normal state.</p>
</li>
<li><strong>RESTORE WITH NORECOVERY</strong> - Restores database but not accessible.</li>
<li><strong>RESTORE WITH STANDBY</strong> - Restores database in read-only mode for admins.</li>
<li><strong>File Restore</strong> - Restore a database file.</li>
<li><strong>Page Restore</strong> - restore small number of pages damaged where rest of database is not. Full or bulk-logged, offline or online, read/write filegroups only, only database pages (not transaction log).</li>
<li><strong>Automatic Page Repair</strong> - AlwaysOn Availability Groups and database mirrors can repair own pages from health secondaries.</li>
</ul>
<h3 id="Notes"><a href="#Notes" class="headerlink" title="Notes"></a>Notes</h3><ul>
<li>SQL Agent setting configured through SQL Server configuration manager.</li>
<li>For multi server job processing Agent service account needs to be in the TargetServerRole in msdb.</li>
<li>Restart agent to apply config changes.</li>
<li>SQL Agent Mail - Right click agent &gt; click alerts &gt; enable mail profile tick &gt; select DB mail &gt; restart agent service.</li>
<li>SQL Agent Alert - Right-click alerts under agent &gt; enter details in general page e.g. alert name, counter, value, condition for alert &gt; Response tab is kicking off job etc &gt; Options - can e-mail, pager or net send message.</li>
<li>You can specify event for specific error number, severity and error contains message text.</li>
<li>You can configure jobs on a schedule, or when sql starts, or when CPU falls below idle threshold.  </li>
<li>Operator - right-click operators under sql agent node &gt; new operator &gt; name and address of operator.</li>
<li>Multi Server jobs - right click agent &gt; choose multi server administration &gt; make this a master &gt; master server operator information &gt; configure target servers &gt; master server login credentials create a new login.</li>
<li>Target servers report to master servers.</li>
</ul>
<ul>
<li>You cannot backup offline data.</li>
<li>Altering a database to add a file during a backup will not complete until after backup completes.</li>
<li>Resource governor could be used to limit CPU during compressed backup operation.</li>
<li>System databases SIMPLE recovery by default.</li>
<li>Backup master and msdb regularly. Model only when change it. Tempdb always regenerated so no need to backup.</li>
<li>Replication - publisher - backup master, msdb and publication databases.</li>
<li>Replication - Distributor - backup master, msdb and distribution databases.</li>
<li>Replication - Subscriber - backup master, msdb and subscription databases.</li>
<li>Can only backup primary with mirroring and cannot use BACKUP LOG WITH NORECOVERY.</li>
<li>AlwaysOn backup options - Prefer Secondary (default, primary still possible), secondary only, primary, any replica (has preference settings).</li>
<li>Can change target recovery (Checkpoint) time at instance in server properties (Database settings) or using sp_configure.</li>
<li>Backups can go to local volumes, network shares, compatible tapes.</li>
<li>Add media set SSMS - Server Objects Node &gt; New Backup Device &gt; Provide device name (or path)</li>
<li>Perform backup - SSMS &gt; right-click Database &gt; Tasks &gt; Back Up &gt; Name backup set &gt; existing backup device or create &gt; backup to new or existing media set &gt; option to checksum &gt; option to compress.</li>
<li><p>You can see backup events in log file history.</p>
</li>
<li><p>Restore - SSMS - perform tail log backup (checkbox in backup options) &gt; Right-click db to restore &gt; if backups were done in SSMS or maintenance plan will auto populate to get to most recent &gt; You can click timeline button to get to a point in time &gt; RECOVERY, NORECOVERY or STANDBY &gt;  </p>
</li>
<li>Remember take tail-log backup before a restore of a restore from full backup.</li>
<li>File Restore - tail-log backup if possible otherwise complete restore &gt; restore most recent backup that includes file &gt; restore differential backups &gt; restore transaction logs in sequence</li>
<li>You can perform online secondary filegroup restores as long as primary is online.  </li>
<li>Page Restores - Right-click db &gt; tasks &gt; restore &gt; check database pages to find corrupt &gt; Ok to restore those that are corrupt.</li>
<li>Can only restore database with TDE when have certificate and private key. Make sure include both of these in backup strategy for TDE databases. Once restored if certificate not present need to restore this too.</li>
<li>When restore databases involved in replication you must restore master and msdb on instance too.</li>
</ul>
<h3 id="Scripts"><a href="#Scripts" class="headerlink" title="Scripts"></a>Scripts</h3><p><strong>SQL Agent Scripts</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sp_add_job <span class="comment">--creates job</span></span><br><span class="line">sp_add_jobstep <span class="comment">--creates job step</span></span><br><span class="line">sp_add_schedule <span class="comment">--creates schedule</span></span><br><span class="line">sp_attach_schedule <span class="comment">--attaches schedule to existing job</span></span><br><span class="line">sp_add_jobserver <span class="comment">--Adds job to server</span></span><br><span class="line">sp_msx_enlist <span class="comment">--execute on target server to enlist target server in master server</span></span><br></pre></td></tr></table></figure></p>
<p><strong>Enable Instance Backup Compression</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">EXEC sys.sp_configure [<span class="keyword">backup</span> compression <span class="keyword">default</span>],<span class="number">1</span>;</span><br><span class="line">GO</span><br><span class="line">RECONFIGURE WITH OVERRIDE;</span><br><span class="line">GO</span><br></pre></td></tr></table></figure></p>
<p><strong>Alter Availability Group Backup Settings</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">AVAILABILITY</span> <span class="keyword">GROUP</span> [AG_NAME] <span class="keyword">SET</span> ( AUTOMATED_BACUP_PREFERENCE = SEONDARY_ONLY);</span><br></pre></td></tr></table></figure></p>
<p><strong>Alter Checkpoint Time at Database Level</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> [DBName] <span class="keyword">SET</span> TARGET_RECOVERY_TIME = <span class="number">1</span>; <span class="comment">--in minutes</span></span><br></pre></td></tr></table></figure></p>
<p><strong>Add Backup Device</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXEC sp_addumpdevice 'disk', 'BackupName','c:\\<span class="keyword">backup</span>\\backupname.bak<span class="string">';</span></span><br></pre></td></tr></table></figure></p>
<p><strong>Full Backup</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BACKUP</span> <span class="keyword">DATABASE</span> [DBName] <span class="keyword">to</span> [BackupName]; <span class="comment">--device already exists</span></span><br></pre></td></tr></table></figure></p>
<p><strong>Differential Backup</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BACKUP</span> <span class="keyword">DATABASE</span> [DBName] <span class="keyword">to</span> [BackupName] <span class="keyword">WITH</span> DIFFERENTIAL; <span class="comment">--device already exists</span></span><br></pre></td></tr></table></figure></p>
<p><strong>Log Backup</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BACKUP</span> <span class="keyword">LOG</span> [DBName] <span class="keyword">to</span> [BackupName] <span class="keyword">WITH</span> DIFFERENTIAL; <span class="comment">--device already exists</span></span><br></pre></td></tr></table></figure></p>
<p><strong>DMV Backup History</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> msdb.dbo.backupset;</span><br></pre></td></tr></table></figure></p>
<p><strong>Restore Database Pages</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RESTORE</span> <span class="keyword">DATABASE</span> [DBNAME] PAGE=<span class="string">'2:42, 2:81'</span> <span class="keyword">FROM</span> FileBackupName <span class="keyword">WITH</span> NORECOVERY; <span class="comment">--restores pages</span></span><br><span class="line"><span class="keyword">RESTORE</span> <span class="keyword">LOG</span> DBName <span class="keyword">FROM</span> log_backup1 <span class="keyword">WITH</span> NORECOVERY; <span class="comment">--restores most recent log</span></span><br><span class="line"><span class="keyword">BACKUP</span> <span class="keyword">LOG</span> DBName <span class="keyword">TO</span> log_backup_new <span class="comment">--takes another log backup</span></span><br><span class="line"><span class="keyword">RESTORE</span> <span class="keyword">LOG</span> <span class="keyword">FROM</span> log_backup_new <span class="keyword">WITH</span> <span class="keyword">RECOVERY</span>; <span class="comment">--restores log backup just taken and back online</span></span><br></pre></td></tr></table></figure></p>
<p><strong>Automatic Page Repair DMVs</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> sys.dm_hadr_auto_page_repair; <span class="comment">--for AlwaysOn Availability Groups</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> sys.dm_db_mirroring_auto_page_repair; <span class="comment">--for mirroring</span></span><br></pre></td></tr></table></figure></p>
<p><strong>Automatic Page Repair DMVs</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> sys.dm_hadr_auto_page_repair; <span class="comment">--for AlwaysOn Availability Groups</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> sys.dm_db_mirroring_auto_page_repair; <span class="comment">--for mirroring</span></span><br></pre></td></tr></table></figure></p>
<p><strong>Restore Master Database</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RESTORE</span> <span class="keyword">DATABASE</span> <span class="keyword">master</span> <span class="keyword">FROM</span> BackupDevice <span class="keyword">WITH</span> <span class="keyword">REPLACE</span>;</span><br></pre></td></tr></table></figure></p>
<p><strong>Rebuild System Databases</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setup /Q /ACTION=REBUILDDATABASE /INSTANCENAME=MSSQLSERVER</span><br></pre></td></tr></table></figure></p>
<p><strong>Check Database Properties</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> databasepropertyex(<span class="string">'databasename'</span>,<span class="string">'Status'</span>); <span class="comment">--Whether ONLINE, OFFLINE, RESTORING, RECOVERING, SUSPECT, EMERGENCY</span></span><br><span class="line"><span class="keyword">SELECT</span> databasepropertyex(<span class="string">'databasename'</span>,<span class="string">'UserAccess'</span>); <span class="comment">--SINGLE_USER, RESTRICTED_USER, MULTI_USER</span></span><br><span class="line"><span class="keyword">SELECT</span> databasepropertyex(<span class="string">'databasename'</span>,<span class="string">'Updateability'</span>); <span class="comment">--READ_WRITE, READ_ONLY</span></span><br></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[SQL 2012 Admin Exam 11 Indexes and Concurrency]]></title>
      <url>www.datagriff.com/2016/11/SQL-2012-Admin-Exam-11-Indexes-and-Concurrency/</url>
      <content type="html"><![CDATA[<h3 id="Key-Terms"><a href="#Key-Terms" class="headerlink" title="Key Terms"></a>Key Terms</h3><ul>
<li><strong>B-Tree Structure</strong> - The balanced tree structure is how SQL indexes are architected made up of a root node, intermediate nodes and leaf nodes (Data pages).</li>
<li><strong>Heap</strong> - Unorganised set of data with no indexes.</li>
<li><strong>Clustered Index</strong> - Leaf pages contain the actual data and physically ordered by the clustered index key (CIK).</li>
<li><strong>Clustered Index Key (CIK)</strong> - Row identifier in clustered index and should be unique, narrow and static.</li>
<li><strong>Uniqueifier</strong> - When clustered key has duplicate rows SQL server adds a 4-byte internal integer to these duplicates.</li>
<li><strong>Non-Clustered Index</strong> - No data, stores indexes columns and clustering key. Less pages to search through.</li>
<li><strong>Covering Index</strong> - Non-clustered index with all information required to cover a query by using included columns.</li>
<li><strong>Filtered Index</strong> - Where clause on the index to filter the rows so B-tree smaller. Can be used in conjunction with sparse columns.</li>
<li><strong>Primary XML Index</strong> - Builds a nodes table with each element in the document has a row in the nodes table.</li>
<li><strong>Secondary XML Index</strong> - Path, property and value index types. Must have primary first.</li>
<li><strong>Spatial Index</strong> - For geography and geometry data types.</li>
<li><strong>Full-text Index</strong> - For efficient searching of text data, one per table.</li>
<li><strong>Columnstore Index</strong> - Does not use B-tree, uses column-orientated storage and good for data warehouse.</li>
<li><strong>Statistics</strong> - Value distribution on SQL objects.</li>
<li><strong>Cardinality</strong> - Number of rows that exist for given value.</li>
<li><strong>FILLFACTOR</strong> - How much free space gets left on leaf nodes of index.</li>
<li><strong>Fragmentation</strong> - Logical ordering based on the key does not match the physical ordering within the data file.</li>
<li><strong>REORGANISE (index)</strong> - Fragmentation 10% to 30%, always online, requires 8KB space, single threaded only.</li>
<li><p><strong>REBUILD (index)</strong> - Fragmentation above 30%, long-term locks, can do with ONLINE clause, requires entire copy of index space-wise, can use parallel.</p>
</li>
<li><p><strong>Transaction</strong> - Batch of processes whereby either all or none of the processes are committed depending on success of failure of the whole transaction.  </p>
</li>
<li><strong>ACID</strong> - Atomic, consistent, isolation and durability. Transactions help ensure this.</li>
<li><strong>Multi-Granular Locking</strong> - SQL server locks the minimum resources to achieve its goal.</li>
<li><strong>Lock Types</strong> - Shared (S), Update (U), Exclusive (X), Intent, Schema, Bulk Update (BU), Key-Range.</li>
<li><strong>Isolation Level Characteristics</strong> - Dirty read, non-repeatable read, phantom read.  </li>
<li><strong>ANSI Standard Isolation Levels</strong> - SERIALIZABLE, REPEATABLE READ, READ COMMITTED (DEFAULT), READ UNCOMMITTED.</li>
<li><strong>Microsoft SQL Server Isolation Level</strong> - READ COMMITTED SNAPSHOT, which requires enabling in database, uses versioning in tempdb. This can limit reader/writer blocking.</li>
<li><strong>Deadlock Types</strong> - Conversion, writer-writer and reader-reader. Also can have cascading deadlocks.</li>
</ul>
<h3 id="Notes"><a href="#Notes" class="headerlink" title="Notes"></a>Notes</h3><ul>
<li>Clustered index good for large % of rows from table, return single row based on clustered index key, or range based data.</li>
<li>Non-Clustered index good for queries return few rows, can be covered by index. Covering index can be more performant than clustered index as less I/O as less pages as B-tree smaller.</li>
<li>Filtered indexes good with sparse column to locate non-null rows or when queries require small subset of rows selected often.  </li>
<li>PATH secondary XML index good for .exit() XQUERY.</li>
<li>PROPERTY secondary XML index good for search nodes with particular values.</li>
<li>VALUE secondary XML index good for search descendant nodes for a given PATH.</li>
<li>AUTO_UPDATE_STATISTICS, AUTO_UPDATE_STATISTICS_ASYNC and AUTO_CREATE_STATISTICS.</li>
<li>SAMPLED, LIMITED and DETAILED can be passed to sys.dm_db_index_physical_stats.</li>
<li>sys.dm_db_index_physical_stats shows fragmentation also.</li>
<li>Fragmentation above 30% rebuild, 10% to 30% reorganise.</li>
<li>You can schedule statistics updates or do in the GUI.</li>
<li>Remember DMVs only store information since last restart, for example you may want to disable indexes first rather than delete.</li>
<li><p>In SQL 2012 only XML and spatial are excluded from online index rebuilds.</p>
</li>
<li><p>SQL can lock   -RID, KEY, PAGE, EXTENT, HEAP or B-TREE, TABLE, FILE, APPLCIATION, METADATA, ALLOCATION UNIT, DATABASE.</p>
</li>
<li>Heaps are bad for concurrency as table locks can occur.</li>
<li>Lock durations change based on lock mode and isolation level.</li>
<li>Can identify blocking with blocking_Session_id of sys.dm_os_waiting_tasks or sys.dm_exec_requests.</li>
<li>Can use the read only version of always on replica using the ApplicationIntent=ReadOnly in the connection string.</li>
<li>Deadlocks raise a 1205 error.</li>
<li>Trace flag 1222 newer version of deadlock trace. Trace has been deprecated.</li>
<li>Use extended events to capture deadlock information.</li>
<li>Use activity monitor to see processes, waiting tasks, data file I/O and recent expensive queries.</li>
<li>sys.dm_os_wait_stats DMV to determine waits.</li>
<li>Remember SQL server has a load of built in reports.</li>
<li>Blocked_process column of system_health extended events also shows where blocking is occuring.</li>
</ul>
<h3 id="Scripts"><a href="#Scripts" class="headerlink" title="Scripts"></a>Scripts</h3><p><strong>Create Columnstore Index</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> NONCLUSTERED COLUMNSTORE <span class="keyword">INDEX</span> IX_CS_TableName</span><br><span class="line">  <span class="keyword">ON</span> [SchemaName].[TableName]</span><br><span class="line">  (Col1, Col2, Col3, Col4);</span><br></pre></td></tr></table></figure></p>
<p><strong>Check to see if Stats are Auto Updated</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> OBJECT_NAME(object_id), <span class="keyword">name</span>, auto_created</span><br><span class="line"><span class="keyword">FROM</span> sys.Stats</span><br><span class="line"><span class="keyword">WHERE</span> auto_created = <span class="number">1</span></span><br></pre></td></tr></table></figure></p>
<p><strong>Create NonClustered Index</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> NONCLUSTERED  <span class="keyword">INDEX</span> IX_TableName</span><br><span class="line">  <span class="keyword">ON</span> [SchemaName].[TableName]</span><br><span class="line">  (Col1, Col2, Col3, Col4);</span><br></pre></td></tr></table></figure></p>
<p><strong>Create Clustered Index (With Compression)</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> CLUSTERED  <span class="keyword">INDEX</span> IX_PartTabCol1</span><br><span class="line">  <span class="keyword">ON</span> [SchemaName].[TableName]</span><br><span class="line">  (Col1)</span><br><span class="line">  <span class="keyword">WITH</span> (DATA_COMPRESSION = PAGE <span class="keyword">ON</span> <span class="keyword">PARTITIONS</span>(<span class="number">1</span>)</span><br><span class="line">, DATA_COMPRESSION = <span class="keyword">ROW</span> <span class="keyword">ON</span> <span class="keyword">PARTITIONS</span>(<span class="number">2</span> <span class="keyword">TO</span> <span class="number">4</span>));</span><br></pre></td></tr></table></figure></p>
<p><strong>ALTER INDEX FILLFACTOR</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">INDEX</span> ALL <span class="keyword">ON</span> [SchemaName].[TableName] <span class="keyword">REBUILD</span></span><br><span class="line"><span class="keyword">WITH</span> (FILLFACTOR = <span class="number">80</span>);</span><br></pre></td></tr></table></figure></p>
<p><strong>Examples of Statistics Updates</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">STATISTICS</span> schemaname.tablename <span class="keyword">WITH</span> FULLSCAN;</span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">STATISTICS</span> schemaname.tablename <span class="keyword">WITH</span> FULLSCAN, <span class="keyword">INDEX</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">STATISTICS</span> schemaname.tablename <span class="keyword">WITH</span> FULLSCAN, <span class="keyword">COLUMNS</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">STATISTICS</span> schemaname.tablename <span class="keyword">WITH</span> <span class="keyword">SAMPLE</span> <span class="number">1000</span> <span class="keyword">ROWS</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">STATISTICS</span> schemaname.tablename <span class="keyword">WITH</span> <span class="number">80</span> <span class="keyword">PERCENT</span>;</span><br></pre></td></tr></table></figure></p>
<p><strong>Index DMVs</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> sys.dm_db_missing_index_columns;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> sys.dm_db_missing_index_details;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> sys.dm_db_missing_index_groups;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> sys.dm_db_missing_index_group_stats;</span><br></pre></td></tr></table></figure></p>
<p><strong>SQL Snapshot Isolation</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> [DatabaseName]</span><br><span class="line"><span class="keyword">GO</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> [DatabaseName] <span class="keyword">SET</span> ALLOW_SNAPSHOT_ISOLATION <span class="keyword">ON</span></span><br><span class="line"><span class="keyword">GO</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">TRANSACTION</span> <span class="keyword">ISOLATION</span> <span class="keyword">LEVEL</span> <span class="keyword">SNAPSHOT</span>;</span><br><span class="line">GO</span><br></pre></td></tr></table></figure></p>
<p><strong>Determine Transaction Isolation Level</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> [DatabaseName]</span><br><span class="line"><span class="keyword">GO</span></span><br><span class="line">DBCC USEROPTIONS;</span><br><span class="line">GO</span><br></pre></td></tr></table></figure></p>
<p><strong>Clear Current Wait Stats</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> [DatabaseName]</span><br><span class="line"><span class="keyword">GO</span></span><br><span class="line">DBCC SQLPERF(<span class="string">'sys.dm_os_Wait_stats'</span>,<span class="keyword">CLEAR</span>);</span><br></pre></td></tr></table></figure></p>
<p><strong>Kill a process using SPID</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">KILL</span> <span class="number">100</span>;</span><br></pre></td></tr></table></figure></p>
<p><strong>Kill a process with Time to End</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">KILL</span> <span class="number">100</span> <span class="keyword">WITH</span> STATUSONLY;</span><br></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[SQL 2012 Admin Exam 10 Troubleshooting SQL Server]]></title>
      <url>www.datagriff.com/2016/11/SQL-2012-Admin-Exam-10-Troubleshooting-SQL-Server/</url>
      <content type="html"><![CDATA[<p>Today I’m going to be looking at troubleshooting SQL server for the exam looking at performance monitor, profiler and data collector.</p>
<h3 id="Video-Exercises"><a href="#Video-Exercises" class="headerlink" title="Video Exercises"></a>Video Exercises</h3><ul>
<li><a href="https://www.youtube.com/watch?v=wKkQYYmC82Q&amp;t=4s&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1&amp;index=56" target="_blank" rel="external">SQL 2012 Performance Monitor</a></li>
<li><a href="https://www.youtube.com/watch?v=wKkQYYmC82Q&amp;t=4s&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1&amp;index=56" target="_blank" rel="external">SQL 2012 Profiler</a></li>
<li><a href="https://www.youtube.com/watch?v=-Uq6S7H9vOc&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1&amp;index=58" target="_blank" rel="external">SQL 2012 Profiler Query Trace File</a></li>
<li><a href="https://www.youtube.com/watch?v=iIFsO0vH6PM&amp;t=3s&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1&amp;index=59" target="_blank" rel="external">SQL 2012 DMVs and Activity Monitor</a></li>
<li><a href="https://www.youtube.com/watch?v=GodD1evwGYQ&amp;t=5s&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1&amp;index=60" target="_blank" rel="external">SQL 2012 Configure Master Data Warehouse</a></li>
</ul>
<h3 id="Key-Terms"><a href="#Key-Terms" class="headerlink" title="Key Terms"></a>Key Terms</h3><ul>
<li><strong>Performance Monitor (PerfMon)</strong> - Captures counters from hardware, operating system and applications. A counter object can be monitored using counters, where there can be multiple counters if multiple resources have the same type of counters, each one being a counter instance.</li>
<li><strong>Data Collector Set</strong> - Reusable sets of data collectors. These can contain performance counters, event trace data and system configuration information like registry key values.</li>
<li><strong>Key SQL Server PerfMon Metrics</strong> - CPU, Memory, File I/O, Locking, blocking, or deadlocking and Networking.</li>
<li><strong>Key System PerfMon Metrics</strong> - System processor queue length, network interface output queue length and physical disk Avg. Queue Length.</li>
<li><p><strong>System Process Queue Length</strong> - Number of system requests waiting for a processor.</p>
</li>
<li><p><strong>SQL Server Profiler</strong> - Provides a GUI for SQL Trace activity going on in SQL database engine, incurs overhead which can be significant.</p>
</li>
<li><strong>SQL Profiler Category</strong> - Related event classes.</li>
<li><strong>SQL Profiler Event</strong> - Action that occurs in SQL server defined by attributes.</li>
<li><strong>SQL Profiler Commonly Used Event Groups</strong> - Locks, performance, security audit, Stored Procedures and TSQL.</li>
<li><strong>SQL Trace</strong> - Uses system stored procedures to creates traces in SQL database engine. More lightweight than profiler.</li>
<li><p><strong>Default Trace</strong> - This runs on SQL server start and has the trace ID of 1. Captures key events and can be disabled using sp_configure. Helps DBAs with key issues.</p>
</li>
<li><p><strong>Dynamic Management Objects (DMO)</strong> - Dynamic management views (DMVs) and dynamic management functions (DMFs) to monitor SQL server.</p>
</li>
<li><strong>Activity Monitor</strong> - Available through SSMS and can identify what is currently happening on the server.</li>
<li><strong>Server Process ID (SPID)</strong> - Unique id for tasks occurring in database engine.</li>
<li><strong>sys.dm_exec Objects</strong> - Connections, sessions, requests and executions.</li>
<li><strong>sys.dm_os Objects</strong> - Operating system info.</li>
<li><strong>sys.dm_tran Objects</strong> - Transaction management.</li>
<li><strong>sys.dm_io Objects</strong> - I/O processes.</li>
<li><p><strong>sys.dm_db Objects</strong> - Database scoped information.</p>
</li>
<li><p><strong>Data Collector</strong> - One central point to collect information about SQL server. Can collect from DMVs, DMFs, or metrics of entire server.</p>
</li>
<li><strong>Management Data Warehouse (MDW)</strong> - Storage area for data collector.</li>
<li><strong>MDW Roles</strong> - mdw_admin, mdw_writer, mdw_reader.</li>
<li><strong>Data Collector Roles</strong> -  dc_admin, dc_operator, dc_proxy.</li>
<li><strong>Server Activity Report</strong> - Waits, locks, latches and memory from DMVs. Collected Every 15 minutes, kept for 14 days.</li>
<li><strong>Disk Usage Report</strong> -  Disk usage. Every 6 hours, kept for 2 years. Good for capacity planning.</li>
<li><p><strong>Query Statistics Report</strong> -   Expensive queries. Collected Every 15 minutes via SSIS as so big, kept for 14 days.</p>
</li>
<li><p><strong>PhysicalDisk: % Disk Time</strong> - Time disk is busy with reading and writing.</p>
</li>
<li><strong>PhysicalDisk: Current Disk Queue Length</strong> - Requests waiting for system access (1.5 to 2 spindles on disk).</li>
<li><strong>PhysicalDisk: Avg. Disk Queue Length</strong> - Average requests waiting for system access.</li>
<li><strong>Memory: Page Faults/sec</strong> - Make sure disk issues not caused by paging.</li>
<li><strong>SQL Server: Buffer Manager: Page read/sec</strong> - Isolate I/O created by SQL Server. Writing pages to disk.</li>
<li><strong>SQL Server: Buffer Manager: Page writes/sec</strong> -  Isolate I/O created by SQL Server. Reading pages from disk.</li>
<li><strong>Memory: Available Bytes</strong> - Bytes available for processes.</li>
<li><strong>Memory: Pages/sec</strong> -</li>
<li><strong>Process: Working Set</strong> - Isolate SQL memory usage. Amount of memory process uses.</li>
<li><strong>SQL Server: Buffer Manager: Buffer Cache Hit Ratio</strong> - Isolate SQL memory usage. Application specific. 90% or more best. Add RAM until there.</li>
<li><strong>SQL Server: Buffer Manager: Total Pages</strong> - Isolate SQL memory usage.</li>
<li><strong>SQL Server: Buffer Manager: Total Server Memory (KB)</strong> - Isolate SQL memory usage. If this consistently higher than server memory, add more RAM.</li>
<li><strong>Processor: % Privileged Time</strong> - CPU time on execution such as processing SQL server I/O requests. If this high may need better disk subsystem.</li>
<li><strong>Processor: % User Time</strong> - Time spent on user processors such as SQL server.</li>
<li><strong>Processor: % Processor Queue Length</strong> - Threads waiting for processor time. May need faster or more processors if this consistently high.</li>
</ul>
<h3 id="Notes"><a href="#Notes" class="headerlink" title="Notes"></a>Notes</h3><ul>
<li>Minimise the number of counters with PerfMon.</li>
<li>Run &gt; PerfMon. To start performance monitor. Then &gt; Add counters.</li>
<li><p>Data collection sets can be scheduled.</p>
</li>
<li><p>SQL profiler being deprecated, use extended events instead.</p>
</li>
<li>With SQL profiler you can filter and create templates.</li>
<li>You can save SQL profiler trace to a file (.trc). You can save trace quick and examine so not to take up resources with profiler.</li>
<li>It is recommended that traces are saved to another server, not the one being monitored.</li>
<li>Common trace events - SQL:BatchComplete, Deadlock Graph, Audit Login.</li>
<li><p>You can import traces into a SQL table to view or view through profiler.</p>
</li>
<li><p>Database DMOs require VIEW DATABASE STATE permissions and server DMOs require VIEW SERVER STATE permissions.</p>
</li>
<li>DMOs get cleared if system is restarted.</li>
<li>Activity monitor has recent expensive queries section.</li>
<li><p>dm_exec_requests view - looks fairly analagous to activity monitor main view and contains spid.</p>
</li>
<li><p>You can report on information collected by data collector, right click data collector, management data warehouse and reports.</p>
</li>
<li>Low volume data sent straight to MDW and high volume is cached first and sent via SSIS.</li>
<li>Configure central management data warehouse &gt; Configure each server to send required data.</li>
<li>Data collector under management node.</li>
<li>300MB per day in typical configuration.</li>
<li>Data collector config and logs written to msdb.</li>
<li><p>Logging can be set by sp_syscollector_update_collection_set system procedure.</p>
</li>
<li><p>I/O - operating system coordinates SQL requests.</p>
</li>
<li>If disk time counters are high consider faster disk drives, move files to another server, add disks to RAID.</li>
<li>Database engine tuning advisor when reads and writes causing issues, better indexes and coverage may be needed.</li>
<li>More RAM if memory issues.</li>
<li>Try and optimise application before spend on new hardware.</li>
</ul>
<h3 id="Scripts"><a href="#Scripts" class="headerlink" title="Scripts"></a>Scripts</h3><p><strong>Import SQL Trace File from Profiler Output</strong><br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">IF OBJECT_ID('tempdb.. ##BaseLine') IS NOT NULL  </span><br><span class="line">DROP TABLE  ##BaseLine;</span><br><span class="line"></span><br><span class="line">SELECT * INTO ##BaseLine</span><br><span class="line">FROM fn_trace_gettable('C:\\temp\\70462.trc',default)</span><br><span class="line"></span><br><span class="line">SELECT * FROM ##BaseLine</span><br><span class="line">ORDER BY Duration DESC;</span><br></pre></td></tr></table></figure></p>
<p><strong>Wait Stats DMV</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> wait_type, wait_time_ms</span><br><span class="line"><span class="keyword">FROM</span> sys.dm_os_wait_stats;</span><br></pre></td></tr></table></figure></p>
<p><strong>“Activity Monitor” DMV</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> sys.dm_exec_requests;</span><br></pre></td></tr></table></figure></p>
<p><strong>DMV Combined to show tasks waiting over certain time</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> s.original_login_name, s.program_name, t.wait_type, t.wait_duration_ms</span><br><span class="line">  <span class="keyword">FROM</span> sys.dm_os_waiting_tasks t</span><br><span class="line">  <span class="keyword">JOIN</span> sys.dm_exec_sessions s</span><br><span class="line">  <span class="keyword">ON</span> t.session_id = s.session_id</span><br><span class="line">    <span class="keyword">WHERE</span> s.is_user_process = <span class="number">1</span></span><br><span class="line">    <span class="keyword">AND</span> t.wait_Duration_ms &gt; <span class="number">1000</span>;</span><br></pre></td></tr></table></figure></p>
<p><strong>DMV Missing Indexes of Recent Executions</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span></span><br><span class="line">(<span class="keyword">SELECT</span></span><br><span class="line">user_seeks * avg_total_user_cost * (avg_user_impact * <span class="number">0.01</span>) <span class="keyword">AS</span> index_advantage, migs.*</span><br><span class="line"><span class="keyword">FROM</span> sys.dm_db_missing_index_group_stats migs) <span class="keyword">AS</span> migs_adv</span><br><span class="line"><span class="keyword">JOIN</span> sys.dm_db_missing_index_groups <span class="keyword">as</span> mig <span class="keyword">ON</span></span><br><span class="line"> mig.index_group_handle = migs_adv.group_handle</span><br><span class="line"><span class="keyword">JOIN</span> sys.dm_db_missing_index_Details <span class="keyword">AS</span> <span class="keyword">mid</span> <span class="keyword">ON</span></span><br><span class="line">mig.index_handle = mid.index_handle</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> migs_adv.index_advantage;</span><br></pre></td></tr></table></figure></p>
<p><strong>Data Collector msdb Objects</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> msdb;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> fn_syscollector_get_execution_details();</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> fn_syscollector_get_execution_stats();</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> fn_syscollector_execution_log;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> fn_syscollector_execution_log_full;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> fn_syscollector_executionstats;</span><br></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[SQL 2012 Admin Exam 09 Clustering and AlwaysOn]]></title>
      <url>www.datagriff.com/2016/11/SQL-2012-Admin-Exam-09-Clustering-and-AlwaysOn/</url>
      <content type="html"><![CDATA[<p>Two more high availability options with clustering and the new super duper AlwaysOn!</p>
<p>Right I’m not going to lie to you.. I failed to get the cluster to work and so my AlwaysOn was scuppered as well as it required windows clustering. Unfortunately my exam deadline was tight so I just had to move on. I caught up with AlwaysOn by watching some cbtNuggets online and also looked at how it was setup in work. The only exercises I have failed on gutted! Still here are some notes on clustering and AlwaysOn, not my strongest subjects!</p>
<h3 id="Video-Exercises"><a href="#Video-Exercises" class="headerlink" title="Video Exercises"></a>Video Exercises</h3><ul>
<li><a href="https://www.youtube.com/watch?v=HXBve36imJg&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1&amp;index=46" target="_blank" rel="external">SQL 2012 Add Cluster User and Logon as a Service Right</a></li>
<li><a href="https://www.youtube.com/watch?v=LOxo6-m7S3k&amp;t=25s&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1&amp;index=47" target="_blank" rel="external">SQL 2012 Advanced Cluster Preparation</a></li>
<li><a href="https://www.youtube.com/watch?v=LOxo6-m7S3k&amp;t=25s&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1&amp;index=47" target="_blank" rel="external">SQL 2012 Create DNS Record for Cluster</a></li>
<li><a href="https://www.youtube.com/watch?v=1TUpu5Az7BM&amp;t=3s&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1&amp;index=49" target="_blank" rel="external">SQL 2012 Create ISCSI Targets and Disks</a></li>
<li><a href="https://www.youtube.com/watch?v=pLZAuKdcIfc&amp;t=4s&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1&amp;index=50" target="_blank" rel="external">SQL 2012 Install ISCSI Target</a></li>
<li><a href="https://www.youtube.com/watch?v=vga9MiV-1fA&amp;t=6s&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1&amp;index=51" target="_blank" rel="external">SQL 2012 Initalise Volumes and Create Simple Volumes</a></li>
<li><a href="https://www.youtube.com/watch?v=79Oq_bGUDe8&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1&amp;index=52" target="_blank" rel="external">SQL 2012 ISCSI Initiator to Target</a></li>
<li><a href="https://www.youtube.com/watch?v=MG9uJVpeWp8&amp;t=3s&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1&amp;index=53" target="_blank" rel="external">SQL 2012 Organisational Unit and Firewall Rules</a></li>
<li><a href="https://www.youtube.com/watch?v=DgZKQ9kRsto&amp;t=5s&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1&amp;index=55" target="_blank" rel="external">SQL 2012 AlwaysOn Firewall Rules</a></li>
</ul>
<h3 id="Key-Terms"><a href="#Key-Terms" class="headerlink" title="Key Terms"></a>Key Terms</h3><ul>
<li><strong>Clustering</strong> - High availability which stores database files on shared  (e.g. SAN) where if one instance fails another takes over.</li>
<li><strong>iSCSI Software</strong> - Required when setting up a virtual machine SAN. Configure in administrative tools.</li>
<li><strong>iSCSI Target</strong> - Computer that will act as the shared storage for virtual machines.</li>
<li><strong>Logical Unit Number (LUN)</strong> - Need a LUN for quorum information and database files.   </li>
<li><strong>Stretch Cluster</strong> - Geographically dispersed cluster.   </li>
<li><strong>Multi-Subnet Failover Clustering</strong> - Each node on different TCP/IP subnet and does not use shared storage.    </li>
<li><p><strong>Quorum Failure</strong> - Caused by communications failure in cluster or issues with the configuration.  </p>
</li>
<li><p><strong>AlwaysOn Availability Group</strong> - Collection of user databases called availability databases. Can have up to four read-write secondary replicas and one or more read-only secondary replicas.</p>
</li>
<li><strong>AlwaysOn Availability Databases</strong> - User databases that can fail over together.  </li>
<li><strong>AlwaysOn Asynchrynous-commit Mode</strong> - Primary does not wait for secondary to commit log. Has minimum transaction latency and good when replicas in geographically dispersed locations.</li>
<li><strong>AlwaysOn Synchrynous-commit Mode</strong> - Primary waits for secondary to commit log. Has higher transaction latency but minimal data loss.</li>
<li><strong>Automatic Failover</strong> - The current primary and one secondary must be configured with failover mode set to AUTOMATIC, the secondary must be SYNCHRYNOUS, and there is not data loss.</li>
<li><strong>Planned Manual Failover</strong> - Initiated by a DBA for example when maintenance needs to occur. One secondary needs to be in SYNCHRONIZED state and primary and replica in Synchrynous-commit mode. Has no data loss.</li>
<li><strong>Forced Manual Failover</strong> - Possible data. Use when no secondary in SYNCHRONIZED state.</li>
<li><strong>Failover Availability Group Wizard</strong> - Right-click availability group on secondary server in SSMS and click failover to start this manual failover.</li>
<li><strong>Readable Secondary Replicas</strong> - Service read-only access. Can be configured Yes, No and read-intent. Yes allows all connections but only for read access but read-intent only allows read connections.</li>
<li><strong>Availability Group Listener</strong> - Network connectivity endpoint for an availability group. Client connects to listener which routes to the primary replica. One listener per availability group.  </li>
</ul>
<h3 id="Notes"><a href="#Notes" class="headerlink" title="Notes"></a>Notes</h3><ul>
<li>Clustering on enterprise supports 16 nodes, BI and standard edition supports 2 nodes.</li>
<li>Windows server failover cluster must work before sql server cluster can.</li>
<li>Configure failover cluster - Connect each node to shared storage &gt; Fail Over Manager Console &gt; Create a Cluster &gt; Add nodes &gt; Name and IP of cluster &gt; Confirm to create.</li>
<li>Install SQL Failover Cluster - .Net Framework 3.5.1 Installed &gt; SQL Setup.exe on first node &gt; Advanced Cluster Preparation &gt; Select features for cluster &gt; Instance Properties &gt; Disk Space &gt; Domain Account for Service Account &gt; Install.. Do this on all nodes.</li>
<li>Complete SQL Cluster - SQL Setup.exe &gt; Advanced Cluster Completion &gt; Instance and SQL Network Name (must be different from any existing instance) &gt; Name cluster resource group &gt; select disk for default drive of databases &gt; IP address for cluster resource &gt; collation &gt; Auth Mode and SA &gt; Install</li>
<li>You only need to complete the SQL cluster on the node that has control of the hardware.</li>
<li>Manual Failover - Administrative Tools &gt; Failover Cluster Manager &gt; SQLRG Node &gt; Move to another node &gt; SQLCRG to SQL-X &gt; Verify SQLCRG on SQL-X Node.</li>
<li>Can use powershell to move from one node to another.</li>
<li>If failed node is irreparable evict it through failover cluster manager. Fix hardware and then re-add to cluster.</li>
<li>When creating a new cluster you must be logged in with a domain account! Won’t work otherwise.</li>
</ul>
<h3 id="Notes-when-creating-windows-cluster…"><a href="#Notes-when-creating-windows-cluster…" class="headerlink" title="Notes when creating windows cluster…"></a>Notes when creating windows cluster…</h3><ul>
<li>I had a lot of difficulty with this.</li>
<li>Ensure get all these <a href="https://technet.microsoft.com/en-us/library/dd573342(v=ws.10" target="_blank" rel="external">firewall rules</a>.aspx) in place. I did them on the DC machine and in the group policy object that goes to all the computers in the network.</li>
<li>Do some gpupdate /force in command prompt. Do some reboots.</li>
<li>Remove and re-add the cluster in DNS if need to.</li>
<li>Don’t forget to reboot machines after Advanced Cluster Preparation!</li>
<li><p>Sacrifice a lamb.  </p>
</li>
<li><p>AlwaysOn only in SQL 2012 enterprise.</p>
</li>
<li>AlwaysOn must be on windows server failover cluster and cannot be domain controller.</li>
<li>Deploying AlwaysOn Availability Groups - Create mirroring endpoint &gt; enable AlwaysOn &gt; Create Availability Group &gt; Create Listener &gt; Create Secondary Replica.</li>
<li>Can only be one mirroring endpoint per instance. (check sys.database_mirroring_endpoints)</li>
<li>Can use mirroring endpoints when using windows authentication but must use certificates if using local account.</li>
<li>Enable AlwaysOn - Configuration Manager &gt; SQL Services node &gt; Go to Instance &gt; Enable AlwaysOn &gt; Restart</li>
<li>Create Availability Group - SSMS of Primary &gt; Expand AlwaysOn Availability Node &gt; Right-Click Availability Groups &gt; Name AG &gt; Select User Databases &gt; Add Replicas &gt; Specify Network Share &gt; all done except configure listener &gt; complete wizard.</li>
<li>Add Listener - SSMS &gt; AlwaysOn Node &gt; Expand AG &gt; Right-Click Create Listener &gt; Specify DNS name and TCP Port &gt; Select DHCP or Static IP.</li>
<li>Max number of replicas is 4, with one primary. So 5 in total.</li>
<li>Failover occurs per replica.  </li>
<li>Can only add replicas if primary online, you can connect to new replica, replica can connect to mirroring endpoint of primary, AlwaysOn enabled on replica.</li>
<li>Only one failover cluster partner can hold replica, failover cluster supports only manual failover</li>
<li>If using AlwaysOn with failover cluster must use backup and restore to prepare secondary database rather than join to availability group.</li>
<li>Listener must have unique DNS name.</li>
</ul>
<h3 id="Scripts"><a href="#Scripts" class="headerlink" title="Scripts"></a>Scripts</h3><p><strong>Configure iSCSI Software Target</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">netsh advfirewall firewall add rule name = Microsoft iSCSI Software Target Service-TCP-3260&quot; dir=in action=allow protocol=TCP localport=3260</span><br><span class="line"></span><br><span class="line">netsh advfirewall firewall add rule name = Microsoft iSCSI Software Target Service-TCP-135&quot; dir=in action=allow protocol=TCP localport=135</span><br><span class="line"></span><br><span class="line">netsh advfirewall firewall add rule name = Microsoft iSCSI Software Target Service-UDP-138&quot; dir=in action=allow protocol=UDP localport=138</span><br><span class="line"></span><br><span class="line">netsh advfirewall firewall add rule name = Microsoft iSCSI Software Target Service-TCP-3260&quot; dir=in action=allow program=&quot;&quot;%SYtemRoot%\System32\WinTarget.exe&quot; TCP &quot;&quot;enable=yes</span><br><span class="line"></span><br><span class="line">netsh advfirewall firewall add rule name = Microsoft iSCSI Software Target Service-TCP-3260&quot; dir=in action=allow program=&quot;&quot;%SYtemRoot%\System32\WTStatusProxy.exe&quot; TCP &quot;&quot;enable=yes</span><br></pre></td></tr></table></figure></p>
<p><strong>Create Windows Failover Cluster</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Add-WindowsFeature Failover-Clustering</span><br></pre></td></tr></table></figure></p>
<p><strong>Move Cluster Nodes</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Move-ClusterGroup SQLCRG SQL-D</span><br></pre></td></tr></table></figure></p>
<p><strong>Set Primary Database to Full Recovery for Mirroring</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> [<span class="keyword">Master</span>];</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> [DatabaseName] <span class="keyword">SET</span> <span class="keyword">RECOVERY</span> <span class="keyword">FULL</span>;</span><br></pre></td></tr></table></figure></p>
<p><strong>Alter Availability Group</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">AVAILABILITY</span> <span class="keyword">GROUP</span> AvailabiltyGroupName MODEIFY REPLICA <span class="keyword">ON</span> <span class="string">'SQLInstanceName\\AlwaysOn'</span></span><br><span class="line">  <span class="keyword">WITH</span> (AVAILABILITY_MODE = SYNCHRYNOUS_COMMIT);</span><br></pre></td></tr></table></figure></p>
<p><strong>Availability Group Manual Failover</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">AVAILABILITY</span> <span class="keyword">GROUP</span> AvailabiltyGroupName <span class="keyword">FAILOVER</span>;</span><br></pre></td></tr></table></figure></p>
<p><strong>Availability Group Manual Failover Powershell</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Switch-SqlAvailabilityGroup - Path SQLSERVER:\SQL\SQLInstanceToFailoverToName\AlwaysOn\AvailabilityGroups\AvailabiltyGroupName</span><br></pre></td></tr></table></figure></p>
<p><strong>Availability Group Manual Failover Forced</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">AVAILABILITY</span> <span class="keyword">GROUP</span> AvailabiltyGroupName FORCE_FAILOVER_ALLOW_DATA_LOSS;</span><br></pre></td></tr></table></figure></p>
<p><strong>Availability Group Manual Failover Forced Powershell</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Switch-SqlAvailabilityGroup - Path SQLSERVER:\SQL\SQLInstanceToFailoverToName\AlwaysOn\AvailabilityGroups\AvailabiltyGroupName - AllowDataLoss</span><br></pre></td></tr></table></figure></p>
<p><strong>Availability Group Read Only</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
<p><strong>Create AlwaysOnEndpoint Powershell</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$endpoint = New-SqlHadrEndpoint AlwaysOnEndpoint -Port 7028 -Path SQLSERVER:\SQL\SQLMACHINENAME\SQLINSTANCENAME</span><br></pre></td></tr></table></figure></p>
<p><strong>Start AlwaysOnEndpoint Powershell</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-SqlHadrEndpoint -InputObject $endpoint -State &quot;Started&quot;</span><br></pre></td></tr></table></figure></p>
<p><strong>Enable AlwaysOn Powershell</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Enable-SqlAlwaysOn - Path SQLSERVER:\SQL\SQLMACHINENAME\SQLINSTANCENAME</span><br></pre></td></tr></table></figure></p>
<p><strong>Create Availability Group</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">AVAILABILITY</span> <span class="keyword">GROUP</span> AvailabiltyGroupName  </span><br><span class="line">  <span class="keyword">FOR</span></span><br><span class="line">      <span class="keyword">DATABASE</span> DatabaseName</span><br><span class="line">      REPLICA <span class="keyword">ON</span></span><br><span class="line">      <span class="string">'SQLMachineName1\\Instancename'</span> <span class="keyword">WITH</span></span><br><span class="line">      (</span><br><span class="line">          ENDPOINT_URL = <span class="string">'TCP://SQLMachineName.DomainName.com:7030'</span>,</span><br><span class="line">          AVAILABILITY_MODE = ASYNSCHRYNOUS_COMMIT,</span><br><span class="line">          FAILOVER_MODE = <span class="keyword">MANUAL</span></span><br><span class="line">      ),</span><br><span class="line">        <span class="string">'SQLMachineName2\\Instancename'</span> <span class="keyword">WITH</span></span><br><span class="line">      (</span><br><span class="line">          ENDPOINT_URL = <span class="string">'TCP://SQLMachineName2.DomainName.com:7030'</span>,</span><br><span class="line">          AVAILABILITY_MODE = ASYNSCHRYNOUS_COMMIT,</span><br><span class="line">          FAILOVER_MODE = <span class="keyword">MANUAL</span></span><br><span class="line">      )    </span><br><span class="line"><span class="keyword">GO</span></span><br></pre></td></tr></table></figure></p>
<p><strong>Availability Group Add Listener</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">AVAILABILITY</span> <span class="keyword">GROUP</span> [AGName]</span><br><span class="line">  <span class="keyword">ADD</span> LISTENER <span class="string">'ListenerName'</span> (<span class="keyword">WITH</span> IP ((<span class="string">'10.0.0.222'</span>,<span class="string">'255.0.0.0'</span>)), PORT=<span class="number">7028</span>);</span><br><span class="line">GO</span><br></pre></td></tr></table></figure></p>
<p><strong>Availability Group Add Listener Powershell</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">New-SqlAvailabillityGroupListener -Name ListenerName -StaticIP &apos;10.0.0.222&apos;/&apos;255.0.0.0&apos; -Port 7030 -Path SQLSERER:\SQL\SQLMachineName\ALWAYSON\AvailabilityGroups\AGName</span><br></pre></td></tr></table></figure></p>
<p><strong>Add Secondary Replica</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">AVAILABILITY</span> <span class="keyword">GROUP</span> [AGName] <span class="keyword">JOIN</span>;</span><br><span class="line">GO</span><br></pre></td></tr></table></figure></p>
<p><strong>Add Secondary Replica Powershell</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Join-SqlAvailabilityGroup = Path SERVER:\SQL\SQLMachineName\AlwaysOn -Name &apos;AGName&apos;</span><br></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[SQL 2012 Admin Exam 08 Mirroring and Replication]]></title>
      <url>www.datagriff.com/2016/11/SQL-2012-Admin-Exam-08-Mirroring-and-Replication/</url>
      <content type="html"><![CDATA[<p>So we’re going to dip into some high availability options with mirroring and replication. High availability refers to making sure that your databases remain available when the primary fails. Rather handy!</p>
<h3 id="Video-Exercises"><a href="#Video-Exercises" class="headerlink" title="Video Exercises"></a>Video Exercises</h3><ul>
<li><a href="https://www.youtube.com/watch?v=xR7dzuI500Q&amp;index=40&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1" target="_blank" rel="external">SQL 2012 Mirroring Firewalls and Certificates</a></li>
<li><a href="https://www.youtube.com/watch?v=14vihg6GL6s&amp;index=44&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1&amp;t=2s" target="_blank" rel="external">SQL 2012 Database Mirroring Preparation</a></li>
<li><a href="https://www.youtube.com/watch?v=umcvUHq5WJY&amp;index=51&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1&amp;t=8s" target="_blank" rel="external">SQL 2012 Initiate Mirroring</a></li>
<li><a href="https://www.youtube.com/watch?v=zxp0OwtVsKk&amp;index=58&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1&amp;t=3s" target="_blank" rel="external">SQL 2012 Replication Preparation</a></li>
<li><a href="https://www.youtube.com/watch?v=qMJcUbAqWTA&amp;index=64&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1&amp;t=2s" target="_blank" rel="external">SQL 2012 Configure Snapshot Replication</a></li>
<li><a href="https://www.youtube.com/watch?v=Ifv0jZx-HCI&amp;index=67&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1&amp;t=2s" target="_blank" rel="external">SQL 2012 Transactional Replication and Monitor</a></li>
</ul>
<h3 id="Key-Terms"><a href="#Key-Terms" class="headerlink" title="Key Terms"></a>Key Terms</h3><ul>
<li><strong>Mirroring</strong> - Principal server has all transactions replicated through transaction logs to a single mirrored database and keeping them in sync.</li>
<li><strong>Mirroring High-Safety Mode</strong> - Failover can occur without data loss but can have higher transaction latency. (SAFETY OPTION = FULL)</li>
<li><strong>Mirroring High-Performance Mode</strong> - Data loss can occur but primary doesn’t wait to confirm secondary has received transaction so lower latency. (SAFETY OPTION = OFF). Only enterprise supports this.</li>
<li><strong>Mirroring Manual Failover</strong> - Often used to perform updates on principal which require a restart.</li>
<li><strong>Mirroring Automatic Failover</strong> - Requires a witness and occurs when principal cannot be contacted.</li>
<li><strong>Mirroring Forced Service</strong> - Possible data loss where DBA forces mirror to become principal when principal cannot be contacted.</li>
<li><strong>sys.database_mirroring</strong> - Catalog view to see operating mode of mirror.</li>
<li><p><strong>Database Mirroring Monitor</strong> - See state of data being transferred between principal and secondary and connection status of witness. This can be launched under tasks of the principal database.</p>
</li>
<li><p><strong>Replication</strong> - Replicates objects and data between databases using a publisher, articles, publications, a distributor, a subscriber and an agent.</p>
</li>
<li><strong>Snapshot Replication</strong> - Complete refreshes of data. Good when infrequent changes, small changes over short period. Requires a snapshot folder that publisher can write to and subscriber can read from.  (max 32,767 articles, 1000 columns).</li>
<li><strong>Snapshot Agent</strong> - Uses bcp to create snapshot.</li>
<li><strong>Transactional Replication</strong> - Incremental updates keeping subscriber and publisher in sync as much as possible. Can actually publish from an Oracle database. Changes must be applied in same order as at publisher.  (max 32,767 articles, 1000 columns).</li>
<li><strong>Peer-to-Peer Replication</strong> - Peer nodes reads and writes to other nodes. Requires partitioning of data and conflicts are not resolved. You cannot filter, each instance requires own distribution database and must be enterprise.</li>
<li><strong>Merge Replication</strong> - Good for applications where conflicts might occur which need resolving like mobile applications. Uses triggers to track changes and publisher and subscriber exchange rows to resolve. Subscriber can be offline then push back. Non-SQL nodes may be involved. Does not have to be transactionally consistent. A conflict resolution priority logic gets configured. (max 256 articles, 246 columns).</li>
<li><strong>Replication Monitor</strong> - Ummm… Enables you to monitor replication! Can add publishers, configure alerts.<ul>
<li><strong>NOT FOR REPLICATION</strong> - Clause allows you to deal with constraints like foreign keys, triggers, identity columns for inserts, updates and deletes in replication.</li>
</ul>
</li>
<li><strong>Heterogenous Data</strong> - Only snapshot and transactional replication for this. Oracle can publish to SQL Server 2012 and SQL Server 2012 to Oracle. Cannot subscribe to IBM DB2 publication butt can publish.</li>
</ul>
<h3 id="Notes"><a href="#Notes" class="headerlink" title="Notes"></a>Notes</h3><ul>
<li>Mirroring to be deprecated.</li>
<li>Automatic failover is possible with mirroring with a witness instance.</li>
<li>Mirroring can’t have FILESTREAM, distributed transactions, system databases, can’t rename.</li>
<li>Mirroring must have FULL recovery and must be started with a restore of database with NO RECOVERY.</li>
<li>Mirroring requires traffic on port 7024.</li>
<li>Mirroring requires an appropriate login on primary, secondary and witness. If it’s a service account from primary then this will be needed on secondary etc.</li>
<li>Mirroring steps - Restore with No Recovery &gt; Necessary Logins &gt; Right-click primary &gt; Task and mirror &gt; Security Wizard &gt; Select and configure Witness &gt; Setup listener port &gt; use login that has CREATE ENDPOINT permissions for a secondary server &gt; Same for witness &gt; Confirm service accounts for each instance of Principal, secondary and witness  </li>
<li>If not configured with  domain account must use certificate authentication for mirroring.</li>
<li>Can only do certificate configured login mirroring using T-SQL not through GUI.  </li>
<li>You can disable automatic failover by changing to high performance (asynchronous) or high safety without failover (asynchronous).</li>
<li>Mirror upgrade - High safety no auto failover &gt; full backup principal &gt; DBCC CHECKDB &gt; Upgrade mirror &gt; Manual failover &gt; upgrade witness &gt; Resume mirror &gt; switch back to high safety with failover &gt; upgrade new mirror instance.</li>
<li><p>Witness and principal service accounts require access to secondary so set these logins up there.</p>
</li>
<li><p>Replication must be installed.</p>
</li>
<li>Snapshot replication - Expand publisher replication node &gt; choose local as distributor &gt; configure SQL agent service &gt; specify network share &gt; choose database to publish &gt; choose snapshot replication &gt; choose articles (tables, procedures etc) &gt; option to filter data &gt; create snapshot immediately &gt; choose snapshot agent account &gt; can choose to script publication &gt; name publication.</li>
<li>Configure subscription - Right click Replication\Local Subscriptions &gt; Select Publisher &gt; Run agent as subscriber &gt; New database as subscriber &gt; Select distributor &gt; Run continuously for schedule &gt; Initialise immediately &gt; Create subscription</li>
<li>Transactional replication - Expand publisher replication node &gt; choose database to publish &gt; choose transactional replication &gt; choose articles (tables, procedures etc) &gt; option to filter data &gt; create snapshot immediately &gt; choose snapshot agent account and log reader agent &gt; can choose to script publication &gt; create publication.</li>
<li>Peer-to-Peer replication - Expand publisher replication node &gt; choose local instance as distributor &gt; sql agent start automatically &gt; configure network share &gt; choose database or objects &gt; choose peer-to-peer replication &gt; choose articles &gt; specify log reader agent &gt; name and create publication.</li>
<li>Merge replication - Expand publisher replication node &gt; choose local instance as distributor &gt; configure network share &gt; choose database &gt; choose merge replication &gt; choose SQL 2008 or later &gt; choose articles &gt; don’t filter rows &gt; specify snapshot agent &gt; provide credentials for agent &gt; name and create publication.</li>
<li>Snapshot replication default every hour for creation schedule.</li>
</ul>
<h3 id="Scripts"><a href="#Scripts" class="headerlink" title="Scripts"></a>Scripts</h3><p><strong>Set Primary Database to Full Recovery for Mirroring</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> [<span class="keyword">Master</span>];</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> [DatabaseName] <span class="keyword">SET</span> <span class="keyword">RECOVERY</span> <span class="keyword">FULL</span>;</span><br></pre></td></tr></table></figure></p>
<p><strong>Initiate Mirroring Backup and Restore Pattern</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--Backup Principal</span></span><br><span class="line"><span class="keyword">BACKUP</span> <span class="keyword">DATABASE</span> [DatabaseName] <span class="keyword">TO</span> DISK N<span class="string">'FilePath\\DatabaseName.bak'</span> <span class="keyword">WITH</span> <span class="keyword">FORMAT</span>;</span><br><span class="line">GO</span><br><span class="line"><span class="comment">--Restore to secondary</span></span><br><span class="line"><span class="keyword">RESTORE</span> <span class="keyword">DATABASE</span> [DatabaseName]</span><br><span class="line">  <span class="keyword">FROM</span> DISK =  <span class="string">'FilePath\\DatabaseName.bak'</span></span><br><span class="line">  <span class="keyword">WITH</span> NORECOVERY</span><br><span class="line"><span class="keyword">GO</span></span><br><span class="line"><span class="comment">--Back On Principal</span></span><br><span class="line"><span class="keyword">BACKUP</span> <span class="keyword">LOG</span> [DatabaseName]</span><br><span class="line">  <span class="keyword">TO</span> DISK<span class="string">'FilePath\\DatabaseName.trn'</span></span><br><span class="line"><span class="keyword">GO</span></span><br><span class="line"><span class="comment">--Restore to secondary</span></span><br><span class="line"><span class="keyword">RESTORE</span> <span class="keyword">LOG</span> [DatabaseName]</span><br><span class="line">  <span class="keyword">FROM</span> DISK<span class="string">'FilePath\\DatabaseName.trn'</span></span><br><span class="line">  <span class="keyword">WITH</span> <span class="keyword">FILE</span>=<span class="number">1</span>, NORECOVERY</span><br><span class="line"><span class="keyword">GO</span></span><br></pre></td></tr></table></figure></p>
<p><strong>Configure Witness Endpoint from Principal</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> [<span class="keyword">Master</span>];</span><br><span class="line"><span class="comment">--On principal</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> [DatabaseName]</span><br><span class="line">  <span class="keyword">SET</span> WITNESS = <span class="string">'CTP//WITNESINSTANCENAME:7024'</span>;</span><br></pre></td></tr></table></figure></p>
<p><strong>Prepare for Mirroring Pattern</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> <span class="keyword">master</span>;</span><br><span class="line">GO</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">MASTER</span> <span class="keyword">KEY</span> ENCRYPTION <span class="keyword">BY</span> <span class="keyword">PASSWORD</span> = <span class="string">'P@$$w0rd'</span>;</span><br><span class="line">GO</span><br><span class="line"></span><br><span class="line"><span class="keyword">USE</span> <span class="keyword">master</span>;</span><br><span class="line">GO</span><br><span class="line"><span class="keyword">CREATE</span> CERTIFICATE SQL_A_CERT <span class="keyword">WITH</span> SUBJECT = <span class="string">'SQL A Certificate'</span>;</span><br><span class="line">GO</span><br><span class="line"></span><br><span class="line"><span class="keyword">USE</span> <span class="keyword">master</span>;</span><br><span class="line">GO</span><br><span class="line"><span class="keyword">CREATE</span> ENDPOINT endpoint_mirroring  </span><br><span class="line">    STATE = STARTED  </span><br><span class="line">    <span class="keyword">AS</span> TCP ( LISTENER_PORT = <span class="number">7024</span>,</span><br><span class="line">	LISTENER_IP=ALL )  </span><br><span class="line">    <span class="keyword">FOR</span> DATABASE_MIRRORING (  </span><br><span class="line">       <span class="keyword">AUTHENTICATION</span> = CERTIFICATE SQL_A_CERT,</span><br><span class="line">	   	<span class="keyword">ROLE</span> = ALL</span><br><span class="line">       );  </span><br><span class="line">GO</span><br><span class="line"></span><br><span class="line"><span class="keyword">BACKUP</span> CERTIFICATE SQL_A_CERT</span><br><span class="line"><span class="keyword">TO</span> <span class="keyword">FILE</span> = <span class="string">'c:\\backup\\SQL_A_CERT.cer'</span></span><br><span class="line"><span class="keyword">WITH</span> <span class="keyword">PRIVATE</span> <span class="keyword">KEY</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">FILE</span>=<span class="string">'SQL_A_CERT'</span>,</span><br><span class="line">    ENCRYPTION <span class="keyword">BY</span> <span class="keyword">PASSWORD</span> = <span class="string">'P@$$w0rd'</span></span><br><span class="line"></span><br><span class="line">);</span><br><span class="line">GO</span><br></pre></td></tr></table></figure></p>
<p><strong>Start Mirroring Pattern</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> <span class="keyword">master</span>;</span><br><span class="line"><span class="keyword">CREATE</span> LOGIN SQL_B_LOGIN <span class="keyword">WITH</span> <span class="keyword">PASSWORD</span> = <span class="string">'P@$$w0rd'</span>;</span><br><span class="line">GO</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> SQL_B_USER <span class="keyword">FOR</span> LOGIN SQL_B_LOGIN;</span><br><span class="line">GO</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> CERTIFICATE SQL_B_CERT</span><br><span class="line">AUTHORIZATION SQL_B_USER</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">FILE</span> = <span class="string">'c:\\backup\\SQL_B_CERT - Copy.cer'</span>;</span><br><span class="line">GO</span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">CONNECT</span> <span class="keyword">ON</span> ENDPOINT:: Endpoint_Mirroring <span class="keyword">TO</span> [SQL_B_Login];</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> AdventureMirror</span><br><span class="line">	<span class="keyword">SET</span> PARTNER = <span class="string">'TCP://sqlb.contoso.com:7024'</span>;</span><br></pre></td></tr></table></figure></p>
<p><strong>Mirror Manual Failover</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> [<span class="keyword">Master</span>];</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> [DatabaseName] <span class="keyword">SET</span> PARTNER <span class="keyword">FAILOVER</span>;</span><br></pre></td></tr></table></figure></p>
<p><strong>Mirror DMVs</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> mirroring_safety_level_desc;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> mirroring_witness_name;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> mirroring_witness_state_desc;</span><br></pre></td></tr></table></figure></p>
<p><strong>Monitor Mirroring Stored Procedures</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sp_dbmmonitoraddmonitoring</span><br><span class="line">sp_dbmmonitordropmonitoring</span><br><span class="line">sp_dbmmonitorchangemonitoring</span><br><span class="line">sp_dbmmonitorresults</span><br></pre></td></tr></table></figure></p>
<p><strong>Change mirroring to Synchrynous (high-safety)</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> [<span class="keyword">master</span>]</span><br><span class="line"><span class="keyword">GO</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> [AdventureMirror] <span class="keyword">SET</span> SAFETY <span class="keyword">FULL</span></span><br><span class="line"><span class="keyword">GO</span></span><br></pre></td></tr></table></figure></p>
<p><strong>Change mirroring to Aynchrynous (high-performance)</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> [<span class="keyword">master</span>]</span><br><span class="line"><span class="keyword">GO</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> [AdventureMirror] <span class="keyword">SET</span> SAFETY <span class="keyword">OFF</span></span><br><span class="line"><span class="keyword">GO</span></span><br></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[SQL 2012 Admin Exam 07 Securing SQL Server]]></title>
      <url>www.datagriff.com/2016/11/SQL-2012-Admin-Exam-07-Securing-SQL-Server/</url>
      <content type="html"><![CDATA[<p>So on to some… err more… exciting security stuff…</p>
<h3 id="Video-Exercises"><a href="#Video-Exercises" class="headerlink" title="Video Exercises"></a>Video Exercises</h3><p>Rmemeber to to do this video!</p>
<ul>
<li><a href="https://youtu.be/DpW1cN_p_FE" target="_blank" rel="external">SQL 2012 Create Schema and Role</a></li>
<li><a href="https://youtu.be/uHgxKNKKtwk" target="_blank" rel="external">SQL 2012 Modifying Privileges</a></li>
<li><a href="https://youtu.be/8ZZtrFJEP7Y" target="_blank" rel="external">SQL 2012 Security DMVs</a></li>
<li><a href="https://youtu.be/HbMpTcKIhbc" target="_blank" rel="external">SQL 2012 Service Account Permissions</a></li>
<li><a href="https://youtu.be/n51BJqCVuxw" target="_blank" rel="external">SQL 2012 Setup Service Account</a></li>
<li><a href="https://youtu.be/n51BJqCVuxw" target="_blank" rel="external">SQL 2012 Create Audit</a></li>
<li><a href="https://youtu.be/MQdiqkMobKc" target="_blank" rel="external">SQL 2012 Create Audit Specification</a></li>
<li><a href="https://youtu.be/4leRkv3qYSQ" target="_blank" rel="external">SQL 2012 Group Policy Management</a></li>
</ul>
<h3 id="Key-Terms"><a href="#Key-Terms" class="headerlink" title="Key Terms"></a>Key Terms</h3><ul>
<li><strong>Securable</strong> - Something in SQL server you can assign permissions for.</li>
<li><strong>Scope</strong> - Securables can be within a hierarchy of securables, where the permissions get assigned in the hierarchy is known as scope.</li>
<li><strong>Permissions</strong> - ALTER, BACKUP, CONTROL, CREATE, DELETE, EXECUTE, IMPERSONATE, INSERT, RECEIVE, REFERENCE, RESTORE, SELECT, TAKE OWNERSHIP, UPDATE, VIEW DEFINITION</li>
<li><strong>Fixed Database Roles</strong> - You cannot modify the permissions of fixed database roles and they are db_owner, db_Securityadmin, db_accessadmin, db_backupoperator, db_ddladmin, db_datawriter, db_datareader, db_denydatawriter and db_denydatareader.</li>
<li><strong>Flexible Database Roles</strong> - Roles with permissions you can define yourself.</li>
<li><strong>Schemas*</strong> - Act as containers for groups of objects.</li>
<li><strong>SQL Server Audit</strong> - Audit at instance and database level outputting to flat file, windows security or application log on host machine.</li>
<li><strong>Server Audit</strong> - Comprises of Audit Name, Queue Delay, On Audit Log Failure and Audit Destination.</li>
<li><strong>Server Audit Specification</strong> - Requires an audit be created first and the specification contains action groups and actions e.g. Database changes, DBCC executions, failed authentications, permission changes for instance level and for database level a lot of the same as instance and also SELECT, UPDATE, DELETE, EXECUTE, INSERT commands.</li>
<li><strong>cr Audit Mode</strong> - records access to objects and statements in default instance data directory which is recycled after 200MB. This feature is deprecated.</li>
<li><strong>Common Criteria Compliance</strong> - Supersedes c2 Audit and enables security options like auditing logins. Can see information in sys.dm_exec_sessions DMV.</li>
<li><strong>Policy Based Management</strong> - Manage multiple instances like blocking certain actions like auto shrink. It is configured by a Facet, a Condition, Policy, Category and Target. Found under management in SSMS.</li>
</ul>
<h3 id="Notes"><a href="#Notes" class="headerlink" title="Notes"></a>Notes</h3><ul>
<li>You can drop columns in read-only Filegroups! Crazy!</li>
<li>You can grant permissions at the schema level.</li>
<li>HAS_PERMS_BY_NAME is a function where you can determine if you have permissions on objects.</li>
<li>DENY take precedence over GRANT.</li>
<li>REVOKE is removing a grant - it is not a DENY.</li>
<li>ALTER on schema permissions required to create tables.</li>
<li>When SQL server authentication is enabled group policy controls Account Lockout duration, Account Lockout Threshold, Reset Account Lockout Counter After.</li>
<li><strong>sys.server_principals</strong> dmv to see if account is disabled.</li>
<li>You can use ALTER LOGIN to unlock a locked out account.</li>
<li>You may also need to ensure SQL browser service is running for users to connect.</li>
<li>When troubleshooting you may want to look certificates, assymetric keys, endpoints, server and database permissions. All of which have DMVs which you can see in code examples below.</li>
<li>Ensure that keys and certificates are regularly backed up as they may expire!</li>
<li>You can use sys.database_principals to determine what authentication a database user is using.</li>
<li>When setup SQL Audit the SQL Service account needs to be added to the Generate Security Audits policy and have read write permissions on file if file output.</li>
<li>Audits can be at database level so don’t do every database.</li>
<li>Database audit also requires a server level audit is in place.</li>
<li>Audits can be created under security folders in SSMS.</li>
<li>There are a selection of DMVs you can see below for looking at audit stuff.</li>
<li><strong>fn_get_audit_file</strong> - allows you to query audit file.</li>
<li>An audit failure can cause a server shutdown.</li>
<li>You can configure Login Auditing under server properties. e.g. failed only, successful, both, none.</li>
<li>Must be member of PolicyAdminstratorRole to use Policy Based Management.</li>
<li>Can transfer policies using import and export functionality.</li>
<li>Can also manage using registered servers on a single server and can then evaluate policies.</li>
<li>Only enterprise supports database audit.</li>
<li>After a server shutdown caused by failed audit you can either restart database engine using -f option or restart in single user mode.</li>
<li>Remember need a server audit before can make server audit specification.</li>
<li>SQL server service account must be added to the Generate Security Audits policy and must enable success and failure audits on audit object access to use local security log.</li>
<li>Remember explcit permissions a schema like SELECT, INSERT or on a database BACKUP and RESTORE, not just built in roles.</li>
<li>sys.certificates view tells you most recent backup of certificate key and its expiration date.</li>
<li>sys.assymetric_keys would give you length of the key.</li>
<li>ALTER ANY DATABASE AUDIT, ALTER (on the database) or CONTROL permissions are required to create a database audit.</li>
<li>You can configure login auditing at instance level.</li>
<li>sys.database_audit_specifications_details tells you all you need to know about audit specifications…</li>
</ul>
<h3 id="Scripts"><a href="#Scripts" class="headerlink" title="Scripts"></a>Scripts</h3><p><strong>Grant Permissions</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> [DBName];</span><br><span class="line">GO</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> [SchemaName].[TableName] <span class="keyword">TO</span> [TestRole];</span><br><span class="line">GO</span><br></pre></td></tr></table></figure></p>
<p><strong>Revoke Permissions</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> [DBName];</span><br><span class="line">GO</span><br><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> [SchemaName].[TableName] <span class="keyword">TO</span> [TestRole];</span><br><span class="line">GO</span><br></pre></td></tr></table></figure></p>
<p><strong>Add member to role using procedure</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXEC sp_addrolemember [db_datawriter],[TestRole];</span><br></pre></td></tr></table></figure></p>
<p><strong>Add member to role using ALTER role</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">ROLE</span> [db_datawriter] <span class="keyword">ADD</span> <span class="keyword">MEMBER</span> [TestRole2];</span><br></pre></td></tr></table></figure></p>
<p><strong>Create role</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">ROLE</span> [TestRole];</span><br></pre></td></tr></table></figure></p>
<p><strong>Deny</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DENY <span class="keyword">SELECT</span> <span class="keyword">ON</span> [SchemaName].[TableName] <span class="keyword">TO</span> [TestRole];</span><br></pre></td></tr></table></figure></p>
<p><strong>Alter Permissions on a Schema</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">VIEW</span> DEFINITION <span class="keyword">ON</span> <span class="keyword">SCHEMA</span>::[SchemaName]  <span class="keyword">TO</span> [RoleName];</span><br></pre></td></tr></table></figure></p>
<p><strong>Move Objects Across Schemas</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">SCHEMA</span> [SchemaName] TRANSFER [SchemaName2].[TableName];</span><br></pre></td></tr></table></figure></p>
<p><strong><a href="https://msdn.microsoft.com/en-us/library/ms189802.aspx" target="_blank" rel="external">HAS_PERMS_BY_NAME</a> Example to Check if have Select Permissions in Database</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> HAS_PERMS_BY_NAME  </span><br><span class="line">(<span class="keyword">QUOTENAME</span>(SCHEMA_NAME(schema_id)) + <span class="string">'.'</span> + <span class="keyword">QUOTENAME</span>(<span class="keyword">name</span>),   </span><br><span class="line">    <span class="string">'OBJECT'</span>, <span class="string">'SELECT'</span>) <span class="keyword">AS</span> have_select, * <span class="keyword">FROM</span> sys.tables</span><br></pre></td></tr></table></figure></p>
<p><strong>Troubleshoot asymmetric keys and certificates</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> sys.asymmetric_keys;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> sys.certificates;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> sys.key_encryptions;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> sys.symmetric_keys ;</span><br></pre></td></tr></table></figure></p>
<p><strong>Troubleshoot Endpoints</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> sys.database_mirroring_endpoints;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> sys.endpoints;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> sys.http_endpoints;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> sys.service_broker_endpoints;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> sys.tcp_endpoints;</span><br></pre></td></tr></table></figure></p>
<p><strong>Troubleshoot Server Permissions</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> sys.server_permissions;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> sys.server_principals;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> sys.server_role_members;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> sys.sql_logins;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> sys.system_components_surface_area_configuration;</span><br></pre></td></tr></table></figure></p>
<p><strong>Troubleshoot Database Permissions</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> sys.database_principals;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> sys.database_permissions;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> sys.database_role_members;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> sys.master_key_passwords;</span><br></pre></td></tr></table></figure></p>
<p><strong>Create a Server Audit</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">SERVER</span> <span class="keyword">AUDIT</span> [AuditName]</span><br><span class="line"><span class="keyword">TO</span> APPLICATION_LOG</span><br><span class="line"><span class="keyword">WITH</span></span><br><span class="line">(</span><br><span class="line">  QUEUE_DELAY = <span class="number">1000</span>,</span><br><span class="line">  ON_FAILURE = <span class="keyword">SHUTDOWN</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p><strong>Create a Server Audit Specification</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">SERVER</span> <span class="keyword">AUDIT</span> SPECIFICATION [AuditSpecificationName]</span><br><span class="line">  <span class="keyword">FOR</span> <span class="keyword">SERVER</span> <span class="keyword">AUDIT</span> [AuditName]</span><br><span class="line">  <span class="keyword">ADD</span> (DATABASE_CHANGE_GROUP)</span><br></pre></td></tr></table></figure></p>
<p><strong>Alter a Server Audit Specification</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">SERVER</span> <span class="keyword">AUDIT</span> SPECIFICATION [AuditSpecificationName]</span><br><span class="line">  <span class="keyword">ADD</span> (DATABASE_LOGOUT_GROUP)</span><br></pre></td></tr></table></figure></p>
<p><strong>Create a Database Audit Specification</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> <span class="keyword">AUDIT</span> SPECIFICATION [AuditSpecificationName]</span><br><span class="line">  <span class="keyword">FOR</span> <span class="keyword">SERVER</span> <span class="keyword">AUDIT</span> [AuditName]</span><br><span class="line">  <span class="keyword">ADD</span> (<span class="keyword">INSERT</span> <span class="keyword">ON</span> <span class="keyword">OBJECT</span>::[dbo].[TableName] <span class="keyword">BY</span> [Exemplar])</span><br></pre></td></tr></table></figure></p>
<p><strong>Create a Database Audit Specification</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> sys.dm_audit_actions;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> sys.server_audits;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> sys.dm_Server_audit_status;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> sys.server_audit_specifications; 	</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> sys.server_audit_specification_details; 	</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> sys.database_audit_specifications; 	</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> sys.database_audit_specifications_details; 	</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> fn_get_audit_file;</span><br></pre></td></tr></table></figure></p>
<p><strong>Enable c2 Audit Mode</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sp_configure '<span class="keyword">show</span> <span class="keyword">advanced</span> options<span class="string">',1;</span><br><span class="line">GO</span><br><span class="line">RECONFIGURE</span><br><span class="line">GO</span><br><span class="line">sp_configure '</span>c2 <span class="keyword">audit</span> <span class="keyword">mode</span><span class="string">',1;</span><br><span class="line">GO</span><br><span class="line">RECONFIGURE</span><br><span class="line">GO</span></span><br></pre></td></tr></table></figure></p>
<p><strong>Enable Common Criteria Compliance</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sp_configure '<span class="keyword">show</span> <span class="keyword">advanced</span> options<span class="string">',1;</span><br><span class="line">GO</span><br><span class="line">RECONFIGURE</span><br><span class="line">GO</span><br><span class="line">sp_configure '</span>common criteria compliance enabled<span class="string">',1;</span><br><span class="line">GO</span><br><span class="line">RECONFIGURE</span><br><span class="line">GO</span></span><br></pre></td></tr></table></figure></p>
<p><strong>Policy Based Management DMVs</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> syspolicy_conditions;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> syspolicy_policies;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> syspolicy_policy_execution_history;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> syspolicy_policy_execution_history_Details;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> syspolicy_policy_group_subscriptions;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> syspolicy_policy_categories;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> syspolicy_system_health_state;</span><br></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[SQL 2012 Admin Exam 06 SQL Server Logins Roles And Users]]></title>
      <url>www.datagriff.com/2016/11/SQL-2012-Admin-Exam-06-SQL-Server-Logins-Roles-And-Users/</url>
      <content type="html"><![CDATA[<p>So on to some exciting security stuff…</p>
<h3 id="Video-Exercises"><a href="#Video-Exercises" class="headerlink" title="Video Exercises"></a>Video Exercises</h3><ul>
<li><a href="https://youtu.be/_uJ6ZaBQvsM" target="_blank" rel="external">SQL 2012 Create Logins</a></li>
<li><a href="https://youtu.be/Bpi1O2AUAeA" target="_blank" rel="external">SQL 2012 Fixed Server Roles</a></li>
<li><a href="https://youtu.be/qbPP7oSMu2U" target="_blank" rel="external">SQL 2012 User Defined Server Roles</a></li>
<li><a href="https://youtu.be/a0lVUsNBb2A" target="_blank" rel="external">SQL 2012 Create Database Users</a></li>
<li><a href="https://youtu.be/ayhosQqyr24" target="_blank" rel="external">SQL 2012 Administer Database Roles</a></li>
<li><a href="https://youtu.be/e6jQ42f4N90" target="_blank" rel="external">SQL 2012 Partially Contained Databases</a></li>
</ul>
<h3 id="Key-Terms"><a href="#Key-Terms" class="headerlink" title="Key Terms"></a>Key Terms</h3><ul>
<li><strong>Windows Authenticated Login</strong> - Inherited from local or domain active directory.</li>
<li><strong>SQL Server Authenticated Login</strong> - Specific to SQL and requires password.</li>
<li><strong>Certificate</strong> - Can create certificate if master key is present and then a login from certificate.</li>
<li><strong>Assymetric Key</strong> - Can create login from asymmetric key and have a public and private key.</li>
<li><strong>Fixed Server Roles</strong> - sysadmin, serveradmin, securityadmin, processadmin, setupadmin, bulkadmin, diskadmin, dbcreator, public.</li>
<li><strong>User Defined Server Roles</strong> - Can create user defined server roles which allow bespoke server level permissions.</li>
<li><strong>Credential</strong> - Stores authentication which can be used for example as a proxy in a SQL agent job.</li>
<li><strong>Database User</strong> - User in a database (mapped to a single login).</li>
<li><strong>Orphaned User</strong> - A database user without a login.</li>
<li><strong>Fixed Database-Level Roles</strong> - db_owner, db_Securityadmin, db_accessadmin, db_backupoperator, db_ddladmin, db_datawriter, db_datareader, db_denydatawriter, db_denydatareader.</li>
<li><strong>Flexible Database-Level Roles</strong> - create roles with custom database permissions.</li>
<li><strong>msdb Roles</strong> - The msdb database has a lot of specific roles that are worth noting.<ul>
<li>db_ssisadmin, db_ssisoperator, db_ssisltduser (SSIS)</li>
<li>dc_admin, dc_operator, dc_proxy (Data Collector)</li>
<li>ServerGroupAdministratorRole, ServerGroupReaderRole</li>
<li>dbm_monitor (mirroring)</li>
<li>PolicyAdministerRole</li>
<li>SQLAgentOperatorRole, SQLAgentReaderRole, SQLAgentUser</li>
</ul>
</li>
<li><strong>Partially Contained Database</strong> - Allows for connections without external dependencies on SQL logins.</li>
<li><strong>Contained User</strong> - Does not have login and applied directly to database.</li>
<li><strong>Principle of Least Privilege</strong> - Grant only access that is required.</li>
<li><strong>Application Role</strong> -  Allows application to access SQL database and not based on user credentials.  </li>
</ul>
<h3 id="Notes"><a href="#Notes" class="headerlink" title="Notes"></a>Notes</h3><ul>
<li>ALTER ANY LOGIN permission required to create logins.</li>
<li>sys.server_principals catalog of logins.</li>
<li>sys.database_principals, sys.database_role_members, sys.database_permissions</li>
<li>ALTER ROLE and sp_addrolemember allow you to add members to roles.</li>
<li>Enabling of contained databases configured at the instance level. </li>
</ul>
<h3 id="Scripts"><a href="#Scripts" class="headerlink" title="Scripts"></a>Scripts</h3><p><strong>Create SQL Login</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> LOGIN [sql_user_c] <span class="keyword">WITH</span> <span class="keyword">PASSWORD</span>=N<span class="string">'P@ssw0rd'</span>;</span><br></pre></td></tr></table></figure></p>
<p><strong>Create Windows Login</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> LOGIN [sqla\local_group_b] <span class="keyword">FROM</span> WINDOWS;</span><br></pre></td></tr></table></figure></p>
<p><strong>Create Certificate</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> CERTIFICATE Richard_Griffiths</span><br><span class="line"><span class="keyword">WITH</span> SUBJECT = <span class="string">'Richard Griffiths certificate in master database'</span>,</span><br><span class="line">EXPIRY_DATE = <span class="string">'01/01/2020'</span>;</span><br></pre></td></tr></table></figure></p>
<p><strong>Create Login from Certificate</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> LOGIN [sqla\local_group_b] <span class="keyword">FROM</span> CERTIFICATE Richard_Griffiths;</span><br></pre></td></tr></table></figure></p>
<p><strong>Create Asymmetric Key</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> ASYMMETRIC <span class="keyword">KEY</span> sql_user_a <span class="keyword">WITH</span> ALGORITHM = RSA_2048;</span><br></pre></td></tr></table></figure></p>
<p><strong>Create Login from Asymmetric Key</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> LOGIN [sqla\local_group_b] <span class="keyword">FROM</span> ASYMMETRIC <span class="keyword">KEY</span> sql_user_a;</span><br></pre></td></tr></table></figure></p>
<p><strong>Alter a Login</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> LOGIN sql_user_a <span class="keyword">DISABLE</span>;</span><br></pre></td></tr></table></figure></p>
<p><strong>Catalog of Logins</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> sys.server_principals;</span><br></pre></td></tr></table></figure></p>
<p><strong>Create Credential</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> CREDENTIAL SSISStage <span class="keyword">WITH</span> <span class="keyword">IDENTITY</span> = <span class="string">'SSISStage'</span>, SECRET = <span class="string">'P@$w0rd'</span>;</span><br></pre></td></tr></table></figure></p>
<p><strong>Add Login to Server Role</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">SERVER</span> <span class="keyword">ROLE</span> bulkadmin <span class="keyword">ADD</span> <span class="keyword">MEMBER</span> [contoso\domain_group_b];</span><br></pre></td></tr></table></figure></p>
<p><strong>Identify Fixed Server Role Members</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sp_helpsrvrolemember;</span><br></pre></td></tr></table></figure></p>
<p><strong>Create User Defined Server Role</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">SERVER</span> <span class="keyword">ROLE</span> Login_Manager;</span><br></pre></td></tr></table></figure></p>
<p><strong>Grant Permissions to User Defined Server Role</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALTER</span> <span class="keyword">ANY</span> LOGIN <span class="keyword">TO</span> Login_Manager;</span><br></pre></td></tr></table></figure></p>
<p><strong>Add Member to User Defined Server Role</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">SERVER</span> <span class="keyword">ROLE</span> Login_Manager <span class="keyword">ADD</span> <span class="keyword">MEMBER</span> [contoso\domain_group_b];</span><br></pre></td></tr></table></figure></p>
<p><strong>Check all Server Role Membership</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> SP1.NAME <span class="keyword">AS</span> <span class="string">'RoleName'</span></span><br><span class="line">,SP2.NAME <span class="keyword">AS</span> <span class="string">'LoginName'</span></span><br><span class="line"><span class="keyword">FROM</span> SYS.SERVER_ROLE_MEMBERS M</span><br><span class="line"></span><br><span class="line"><span class="keyword">JOIN</span> sys.server_principals SP1 <span class="keyword">ON</span></span><br><span class="line">sp1.principal_id = m.role_principal_id</span><br><span class="line"></span><br><span class="line"><span class="keyword">JOIN</span> sys.server_principals SP2 <span class="keyword">ON</span></span><br><span class="line">sp2.principal_id = m.member_principal_id</span><br><span class="line"></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> sp1.name, sp2.name</span><br></pre></td></tr></table></figure></p>
<p><strong>Create Database User</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> [SQLA\local_account_b] <span class="keyword">FOR</span> LOGIN [SQLA\local_account_b];</span><br></pre></td></tr></table></figure></p>
<p><strong>Detect Orphaned Database User</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> DBName;</span><br><span class="line">GO</span><br><span class="line">sp_change_users_login @Action='Report';</span><br><span class="line">GO</span><br></pre></td></tr></table></figure></p>
<p><strong>Create Database Role</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">ROLE</span> TableAdmin;</span><br></pre></td></tr></table></figure></p>
<p><strong>Grant Permission to Database Role</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">CREATE</span> <span class="keyword">SCHEMA</span> <span class="keyword">TO</span> TableAdmin;</span><br></pre></td></tr></table></figure></p>
<p><strong>Add Member to Database Role</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXEC sp_addrolemember 'TableAdmin','sql_user_c';</span><br></pre></td></tr></table></figure></p>
<p><strong>Create Partially Contained Database</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> partialdb</span><br><span class="line">CONTAINMENT = <span class="keyword">PARTIAL</span>;</span><br></pre></td></tr></table></figure></p>
<p><strong>Create Partially Contained Windows User</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> partialdb;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> [contoso\contained_user_b];</span><br></pre></td></tr></table></figure></p>
<p><strong>Create Partially Contained SQL User</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> partialdb;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> [contained_user_c] <span class="keyword">WITH</span> <span class="keyword">PASSWORD</span>=<span class="string">'Pa$$w0rd'</span>;</span><br></pre></td></tr></table></figure></p>
<p><strong>Create Application Role</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> DBNAME;</span><br><span class="line"><span class="keyword">CREATE</span> APPLICATION TOLE app_role_test <span class="keyword">WITH</span> <span class="keyword">PASSWORD</span> <span class="string">'P@$$w0rd'</span>;</span><br></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[SQL 2012 Admin Exam 05 Migrating Importing and Exporting]]></title>
      <url>www.datagriff.com/2016/11/SQL-2012-Admin-Exam-05-Migrating-Importing-and-Exporting/</url>
      <content type="html"><![CDATA[<p>The migrating wasn’t super exciting but the bulk inserts were :)</p>
<h3 id="Video-Exercises"><a href="#Video-Exercises" class="headerlink" title="Video Exercises"></a>Video Exercises</h3><ul>
<li>[SQL 2012 Migrate Using Backup and Restore] (<a href="https://youtu.be/FwKvXygmp48" target="_blank" rel="external">https://youtu.be/FwKvXygmp48</a>)</li>
<li>[SQL 2012 Migrate Using Database Copy Wizard] (<a href="https://youtu.be/DS9wzR9xEpk" target="_blank" rel="external">https://youtu.be/DS9wzR9xEpk</a>)</li>
<li>[SQL 2012 Open Firewall for Database Copy Wizard] (<a href="https://youtu.be/bZgsAVhIzDE" target="_blank" rel="external">https://youtu.be/bZgsAVhIzDE</a>)</li>
<li>[SQL 2012 Detach Attach] (<a href="https://youtu.be/hcB_qxE3CV4" target="_blank" rel="external">https://youtu.be/hcB_qxE3CV4</a>)</li>
<li>[SQL 2012 Migrate Logins Using Scripts] (<a href="https://youtu.be/_Ma-ZCnS_Hc" target="_blank" rel="external">https://youtu.be/_Ma-ZCnS_Hc</a>)</li>
<li>[SQL 2012 Create New Domain User] (<a href="https://youtu.be/IY1-fwU6cJA" target="_blank" rel="external">https://youtu.be/IY1-fwU6cJA</a>)</li>
<li>[SQL 2012 Import Export Wizard] (<a href="https://youtu.be/FMvzlJAJXQw" target="_blank" rel="external">https://youtu.be/FMvzlJAJXQw</a>)</li>
<li>[SQL 2012 BCP and BULK INSERT] (<a href="https://youtu.be/DTXowRhj4kg" target="_blank" rel="external">https://youtu.be/DTXowRhj4kg</a>)</li>
</ul>
<h3 id="Key-Terms"><a href="#Key-Terms" class="headerlink" title="Key Terms"></a>Key Terms</h3><ul>
<li><strong>Upgrade Advisor</strong> - You can run this against SQL 2005, 2008 and 2008 R2 to check if okay to upgrade to 2012.</li>
<li><strong>Distributed Replay Utility</strong> - Can simulate mission-critical work environments before upgrade.</li>
<li><strong>Detach and Attach Database</strong> - Allows you to migrate database across instances. Detached database must have no snapshots, no replication, not mirrored and not be a system database.</li>
<li><strong>Copy Database Wizard</strong> - Copy database across instances, choosing with Move means gets delete from source. Can copy server level objects too like jobs, logins, messages and can also schedule the move. You also create an SSIS package when creating the copy task.</li>
<li><strong>Backup and Restore</strong> - You can copy databases across instances using backup and restore. When copying from a previous version remember to use WITH MOVE.</li>
<li><strong>Generate and Publish Scripts Wizard</strong> - You can publish to a web hosting provider (web service) or produce a script to transfer a database.</li>
<li><strong>Import/Export Wizard</strong> - Useful tool in SSMS to easily transfer data. You can save the transfer as an SSIS package as long as user has appropriate msdb privileges.</li>
<li><strong>BCP Utility</strong> - bcp utility can copy data from database to file or file to database using command line.</li>
<li><strong>BULK INSERT</strong> - Run from database engine and can load data into a table from a file.</li>
<li><strong>OPENROWSET(BULK)</strong> - Connect to OLEDB linked server to bulk import data or insert from file via OLEDB provider.   </li>
</ul>
<h2 id="Tips-on-Bulk-Insert-Operations"><a href="#Tips-on-Bulk-Insert-Operations" class="headerlink" title="Tips on Bulk Insert Operations"></a>Tips on Bulk Insert Operations</h2><ul>
<li>Metadata same in source and destination objects</li>
<li>Use format file if inserting from fixed length fields</li>
<li>Can use a csv as data file</li>
<li>Requires select and insert permissions</li>
<li>Disable constraints</li>
<li>ADMINISTER BULK OPERATIONS permissions</li>
<li>Read permissions on file server</li>
<li>Cannot bulk insert into a partitioned view</li>
<li>Can bulk insert in parallel using multiple tools</li>
<li>Disable triggers</li>
<li>Order by from source on destination clustered index column.</li>
</ul>
<h3 id="Notes"><a href="#Notes" class="headerlink" title="Notes"></a>Notes</h3><ul>
<li>You cannot upgrade from 32-bit to 64-bit and vice versa.</li>
<li>SQL 2012 requires windows server 2008 or later.</li>
<li>Pre-upgrade steps - DBCC commands to ensure consistent state, configured with AutoGrow enabled, disable startup procedures and replication, ensure enough disk space present.</li>
<li>When using copy database wizard attach detach method is faster but database goes offline, object method is slower but database stays online.</li>
<li>You can migrate SQL logins by scripting and source and executing on destination.</li>
<li>Cannot create partitioned table using SELECT INTO.</li>
</ul>
<h3 id="Scripts"><a href="#Scripts" class="headerlink" title="Scripts"></a>Scripts</h3><p><strong>Detach a Database</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> <span class="keyword">master</span>;</span><br><span class="line">GO</span><br><span class="line">EXEC sp_detach_db @dbname = [DBName];</span><br><span class="line">GO</span><br></pre></td></tr></table></figure></p>
<p><strong>Attach a Database</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> <span class="keyword">master</span>;</span><br><span class="line">GO</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> DBName <span class="keyword">ON</span> (FileName=<span class="string">'C:\FilePath\FileName.mdf'</span>),</span><br><span class="line">(FileName=<span class="string">'C:\FilePath\FileName_log.ldf'</span>) <span class="keyword">FOR</span> ATTACH;</span><br><span class="line">GO</span><br></pre></td></tr></table></figure></p>
<p><strong>BCP From SQL into File</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bcp &quot;SELECT FirstName, LastName FROM AdventureWorks2012.Person.Person ORDER BY LastName, FirstName;&quot; queryout file.txt -c -T</span><br></pre></td></tr></table></figure></p>
<p><strong>BCP From File into SQL</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bcp DBName.SchemaName.TableName in C:\Data\file.txt -T -c</span><br></pre></td></tr></table></figure></p>
<p><strong>BULK INSERT into SQL</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BULK <span class="keyword">INSERT</span> DBName.SchemaName.TableName <span class="keyword">FROM</span> <span class="string">'C:\Data\file.txt'</span>;</span><br></pre></td></tr></table></figure></p>
<p><strong>OPENROWSET Bulk from File</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> T(XmlCol)  </span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> OPENROWSET(  </span><br><span class="line">   <span class="keyword">BULK</span> <span class="string">'c:\Folder\FileName.txt'</span>,  </span><br><span class="line">   SINGLE_BLOB) <span class="keyword">AS</span> x;</span><br></pre></td></tr></table></figure></p>
<p> <strong>OPENROWSET from OLEDB</strong><br> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> a.*  </span><br><span class="line"><span class="keyword">FROM</span> OPENROWSET(<span class="string">'SQLNCLI'</span>, <span class="string">'Server=Seattle1;Trusted_Connection=yes;'</span>,  </span><br><span class="line">     <span class="string">'SELECT GroupName, Name, DepartmentID  </span><br><span class="line">      FROM AdventureWorks2012.HumanResources.Department  </span><br><span class="line">      ORDER BY GroupName, Name'</span>) <span class="keyword">AS</span> a;</span><br></pre></td></tr></table></figure></p>
<p>  <strong>OPENDATASOURCE from Excel INTO</strong><br>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">INTO</span> TableExcel <span class="keyword">FROM</span> OPENDATASOURCE(<span class="string">'Microsoft.Jet.OLEDB.4.0'</span>,  </span><br><span class="line"><span class="string">'Data Source=C:\DataFolder\Documents\TestExcel.xls;Extended Properties=EXCEL 5.0'</span>)...[Sheet1$] ;</span><br></pre></td></tr></table></figure></p>
<p>   <strong>OPENQUERY</strong><br>   <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OPENQUERY ( linked_server ,'query' )</span><br></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[SQL 2012 Admin Exam 04 Configuring Additional SQL Server Components]]></title>
      <url>www.datagriff.com/2016/10/SQL-2012-Admin-Exam-04-Configuring-Additional-SQL-Server-Components/</url>
      <content type="html"><![CDATA[<p>So on to the third chapter in 2 days! My brain may be slightly frazzled…</p>
<h3 id="Video-Exercises"><a href="#Video-Exercises" class="headerlink" title="Video Exercises"></a>Video Exercises</h3><ul>
<li><a href="https://youtu.be/tUWm6qNte20" target="_blank" rel="external">SQL 2012 Configure FILESTREAM</a></li>
<li><a href="https://youtu.be/h2615ZtaZXk" target="_blank" rel="external">SQL 2012 Create a FileTable</a></li>
<li><a href="https://youtu.be/B0XF02sHKeM" target="_blank" rel="external">SQL 2012 Create Full Text Index</a></li>
<li><a href="https://youtu.be/36D9HColDeY" target="_blank" rel="external">SQL 2012 Create Partitioned Table</a></li>
<li><a href="https://youtu.be/ugrzwf8ZPzw" target="_blank" rel="external">SQL 2012 Transparent Data Encryption</a></li>
<li><a href="https://youtu.be/PLfL7FZbnWs" target="_blank" rel="external">SQL 2012 Data Compression</a></li>
<li><a href="https://youtu.be/DJ_LFyEylIU" target="_blank" rel="external">SQL 2012 Managing Transaction Logs</a></li>
</ul>
<h3 id="Key-Terms"><a href="#Key-Terms" class="headerlink" title="Key Terms"></a>Key Terms</h3><ul>
<li><strong>Full-Text Indexing</strong> - Stores significant words and their location. There can be only one per table or indexed view and can contain up to 1024 columns. This can then be used in querying used commands like CONTAINSTABLE and FREETEXTTABLE.</li>
<li><strong>FileStream</strong> - Allows SQL Server to store unstructured data like files and documents (BLOBs, Binary Large Objects).</li>
<li><strong>FileTables</strong> - Allows you to store files and documents in SQL server and can be accessed via applications as if they were stored in file system.</li>
<li><strong>Contained Database</strong> - All settings and properties within database and can connect without authentication at server level.</li>
<li><strong>Row-Level Compression</strong> - Less CPU than page but not as efficient and useful for fixed length data types.</li>
<li><strong>Page-Level Compression</strong> - More CPU that row and compresses repeating data.</li>
<li><strong>Unicode Compression</strong>- - Good for NVARCHAR and NCHAR types.</li>
<li><strong>Transparent Data Encryption (TDE)</strong> - Encrypts database that requires no extra effort in application layer.</li>
<li><strong>Partition Function</strong> - Defines how rows of index map to partitions based on values of Partitioning column.</li>
<li><strong>Partition Scheme</strong> - Maps partition function to filegroups.</li>
<li><strong>Partitioning Column</strong> -Column or index that partition function uses.</li>
<li><strong>Aligned Index</strong> - Index that uses same partition scheme as the table to which it belongs.</li>
<li><strong>NonAligned Index</strong> - Index independently partition from table to which it belongs.</li>
<li><strong>Partition Elimination</strong> - Optimiser can access only partitions it needs for query.</li>
</ul>
<p><strong>There are a shedload of <a href="">DBCC Commands..</a></strong></p>
<ul>
<li><strong>Maintenance</strong> - DBCC CLEANTABLE, DBCC DBREINDEX, DBCC DROPCLEANBUFFERS, DBCC FREEPROCCACHE, DBCC INDEXDEFRAG, DBCC SHRINKDATABSE, DBCC SHRINKFILE, DBCC UPDATEUSAGE</li>
<li><strong>Informational</strong> -  DBCC INPUTBUFFER, DBCC OPENTRAN, DBCC OUTPUTBUFFER, DBCC PROCACHE, DBCC SHOW_STATISICS, DBCC SHOWCONTIG, DBCC SQLPERF, DBCC TRACESTATUS, DBCC USEROPTIONS</li>
<li><strong>Validation</strong> -  DBCC CHECKALLOC, DBCC CHECKCATALOG, DBCC CHECKCONSTRAINTS, DBCC CHECKDB, DBCC CHECKFILEGROUP, DBCC CHECKIDENT, DBCC CHECKTABLE</li>
<li><strong>Miscellaenous</strong> -  DBCC dllname (FREE), DBCC FREESESSIONCACHE, DBCC HELP, DBCC TRACEOFF</li>
</ul>
<h3 id="Notes"><a href="#Notes" class="headerlink" title="Notes"></a>Notes</h3><ul>
<li>DComconfg.exe is a tool to give non-admin users access to IS.</li>
<li>Reporting Services Configuration manager is how you would changed the RS execution account.</li>
<li>To enable FILESTREAM you must edit properties of SQL server Service in SQL Server Configuration manager.</li>
<li>FILESTREAM steps: SQL Server Config Manager &gt; Properties &gt; FILESTREAM enable &gt; sp_configure &gt; Restart &gt; FILESTREAM Filegroup &gt; FILESTREAM Filegroup</li>
<li>FileTable steps: Enable FILESTREAM &gt; NON_TRANSACTED_ACCESS = FULL on Database &gt; Create table as FileTable</li>
<li>TDE Steps: Create master encryption key &gt; Certificate &gt; Database Encryption Key &gt; Encrypt database</li>
</ul>
<h3 id="Scripts"><a href="#Scripts" class="headerlink" title="Scripts"></a>Scripts</h3><p><strong>Install AS from Command-Line in MultiDimensional Mode</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Setup.exe /q /IAcceptSQLServerLicenseTerms /Action=install /Features=AS /ASSERVERMODE=MULTIDIMENSIONAL /INSTANCENAME=ASMulti /ASSVCACCOUNT=contoso\kim_akers /ASSYSADMINACCOUNTS=contoso\kim_akers</span><br></pre></td></tr></table></figure></p>
<p><strong>Install AS from Command-Line in Tabular Mode</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Setup.exe /q /IAcceptSQLServerLicenseTerms /Action=install /Features=AS /ASSERVERMODE=TABULAR /INSTANCENAME=ASTabular /ASSVCACCOUNT=contoso\kim_akers /ASSYSADMINACCOUNTS=contoso\kim_akers</span><br></pre></td></tr></table></figure></p>
<p><strong>Install AS from Command-Line in PowerPivot Mode</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Setup.exe /q /IAcceptSQLServerLicenseTerms /Action=install /Features=AS /ASSERVERMODE=POWERPIVOT /INSTANCENAME=ASPower /ASSVCACCOUNT=contoso\kim_akers /ASSYSADMINACCOUNTS=contoso\kim_akers</span><br></pre></td></tr></table></figure></p>
<p><strong>Powershell RS Prerequisite 01</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Import-module ServerManager</span><br></pre></td></tr></table></figure></p>
<p><strong>Powershell RS Prerequisite 02</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Add-WindowsFeature Web-Server -IncludeAllSubfeature</span><br></pre></td></tr></table></figure></p>
<p><strong>Install RS from Command-Line</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setup.exe /q /IAcceptSQLServerLicenseTerms /Action=instal/ Features=SQL,RS,TOOLS /INSTANCENAME=RPTSVR /SQLSYSADMINACCOUNTS=&quot;BUILTIN\ADMINISTRATORS&quot; /RSSVCACCOUNT=NetworkService /SQLSVCACCOUNT=NetworkService /AGTSVCACCOUNT=NetworkService /RSSVCSTARTUPTYPE=&quot;Manual&quot; /RSINSTALLMODE=&quot;DefaultNativeMode&quot;</span><br></pre></td></tr></table></figure></p>
<p><strong>Create Full Text Catalog</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> DbName;</span><br><span class="line">GO</span><br><span class="line"><span class="keyword">CREATE</span> FULLTEXT <span class="keyword">CATALOG</span> CatalogName;</span><br><span class="line">GO</span><br><span class="line"><span class="keyword">CREATE</span> FULLTEXT <span class="keyword">INDEX</span> <span class="keyword">ON</span> SchemaName.TableName</span><br><span class="line">(</span><br><span class="line">Column1, Column2, Column3</span><br><span class="line">)</span><br><span class="line"><span class="keyword">KEY</span> <span class="keyword">INDEX</span> PK_SchemaName_TabName_Column1</span><br><span class="line"><span class="keyword">ON</span> CatalogName;</span><br><span class="line">GO</span><br></pre></td></tr></table></figure></p>
<p><strong>Drop Full Text Catalog</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> FULLTEXT <span class="keyword">INDEX</span> <span class="keyword">ON</span> SchemaName.TableName;</span><br></pre></td></tr></table></figure></p>
<p><strong>Configure FILESTREAM to allow T-SQL and Win32 Streaming</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EXEC sp_configure filestream_access_level, 2</span><br><span class="line">RECONFIGURE</span><br></pre></td></tr></table></figure></p>
<p><strong>Create a FILESTREAM FileGroup</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> DBName <span class="keyword">ADD</span></span><br><span class="line">FILEGROUP FileStreamFG CONTAINS FILESTREAM;</span><br></pre></td></tr></table></figure></p>
<p><strong>Create a FILESTREAM File</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> <span class="keyword">master</span>;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> DBName <span class="keyword">ADD</span> <span class="keyword">FILE</span></span><br><span class="line">( <span class="keyword">NAME</span> = FileStrmFile</span><br><span class="line">, FILENAME = N<span class="string">'C:\FSTRM'</span>)</span><br><span class="line"><span class="keyword">TO</span> FILEGROUP FileStreamFG;</span><br></pre></td></tr></table></figure></p>
<p><strong>Enable FILESTREAM NON_TRANSACTED_ACCESS</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> <span class="keyword">master</span>;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> DBName</span><br><span class="line"><span class="keyword">SET</span> FILESTREAM (NON_TRANSACTED_ACCESS = <span class="keyword">FULL</span>, DIRECTORY_NAME = N<span class="string">'directory'</span>)</span><br></pre></td></tr></table></figure></p>
<p><strong>Create FileTable</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> DocStore <span class="keyword">AS</span> FileTable;</span><br></pre></td></tr></table></figure></p>
<p><strong>Row-Level Compression</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> TabName <span class="keyword">REBUILD</span> <span class="keyword">WITH</span> (DATA_COMPRESSION=<span class="keyword">ROW</span>);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">INDEX</span> idx_Name <span class="keyword">ON</span> TabName <span class="keyword">REBUILD</span> <span class="keyword">WITH</span> (DATA_COMPRESSION=<span class="keyword">ROW</span>);</span><br></pre></td></tr></table></figure></p>
<p><strong>Page-Level Compression</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> TabName <span class="keyword">REBUILD</span> <span class="keyword">WITH</span> (DATA_COMPRESSION=PAGE);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">INDEX</span> idx_Name <span class="keyword">ON</span> TabName <span class="keyword">REBUILD</span> <span class="keyword">WITH</span> (DATA_COMPRESSION=PAGE);</span><br></pre></td></tr></table></figure></p>
<p><strong>Create Partition Function</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PARTITION</span> <span class="keyword">FUNCTION</span> PartFun ( <span class="built_in">INT</span> )</span><br><span class="line"><span class="keyword">AS</span> <span class="keyword">RANGE</span> <span class="keyword">LEFT</span> <span class="keyword">FOR</span> <span class="keyword">VALUES</span> (<span class="number">100</span>,<span class="number">200</span>);</span><br></pre></td></tr></table></figure></p>
<p><strong>Create Partition Scheme</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PARTITION</span> SCHEME PartScheme</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line">	<span class="keyword">PARTITION</span> PartFun</span><br><span class="line">	<span class="keyword">TO</span> (FG1, FG2, FG3)</span><br><span class="line"><span class="keyword">GO</span></span><br></pre></td></tr></table></figure></p>
<p><strong>Create Partitioned Table</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">Test</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">int</span>,</span><br><span class="line"><span class="keyword">value</span> <span class="built_in">char</span>(<span class="number">30</span>)</span><br><span class="line">) <span class="keyword">on</span> PartScheme(<span class="keyword">id</span>)</span><br></pre></td></tr></table></figure></p>
<p><strong>Transparent Data Encryption (TDE) Part 1 - Create Master Key</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> <span class="keyword">master</span>;</span><br><span class="line">GO</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">MASTER</span> <span class="keyword">KEY</span> ENCRYPTION <span class="keyword">BY</span> <span class="keyword">PASSWORD</span> = <span class="string">'Password'</span>;</span><br><span class="line">GO</span><br></pre></td></tr></table></figure></p>
<p><strong>TDE Part 2 - Create Certificate</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> <span class="keyword">master</span>;</span><br><span class="line">GO</span><br><span class="line"><span class="keyword">CREATE</span> CERTIFICATE ServerCert <span class="keyword">WITH</span> SUBJECT = <span class="string">'Server Cert'</span>;</span><br><span class="line">GO</span><br></pre></td></tr></table></figure></p>
<p><strong>TDE Part 3 - Create Database Encryption Key (DEK)</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> DBName;</span><br><span class="line">GO</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> ENCRYPTION <span class="keyword">KEY</span></span><br><span class="line"><span class="keyword">WITH</span> ALGORITHM = AES_128</span><br><span class="line">ENCRYPTION <span class="keyword">BY</span> <span class="keyword">SERVER</span> CERTIFICATE ServerCert;</span><br><span class="line">GO</span><br></pre></td></tr></table></figure></p>
<p><strong>TDE Part 4 - Enable Encryption</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> <span class="keyword">master</span>;</span><br><span class="line">GO</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> DBName</span><br><span class="line"><span class="keyword">SET</span> ENCRYPTION <span class="keyword">ON</span>;</span><br><span class="line">GO</span><br></pre></td></tr></table></figure></p>
<p><strong>TDE Backup Certificate</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BACKUP</span> CERTIFICATE ServerCert</span><br><span class="line"><span class="keyword">TO</span> <span class="keyword">FILE</span> = <span class="string">'ServerCertExport'</span></span><br><span class="line"><span class="keyword">WITH</span> <span class="keyword">PRIVATE</span> <span class="keyword">KEY</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">FILE</span>=<span class="string">'PrivateKeyFile'</span>,</span><br><span class="line">    ENCRYPTION <span class="keyword">BY</span> <span class="keyword">PASSWORD</span> = <span class="string">'Password'</span></span><br><span class="line">);</span><br><span class="line">GO</span><br></pre></td></tr></table></figure></p>
<p><strong>Add a Log File</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> [<span class="keyword">master</span>]</span><br><span class="line"><span class="keyword">GO</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> [DBName] <span class="keyword">ADD</span> <span class="keyword">LOG</span> <span class="keyword">FILE</span></span><br><span class="line">( <span class="keyword">NAME</span> = N<span class="string">'LogFile2'</span></span><br><span class="line">, FILENAME = N<span class="string">'FilePath'</span></span><br><span class="line">, <span class="keyword">SIZE</span> = <span class="number">1024</span>KB , FILEGROWTH = <span class="number">10</span>%)</span><br><span class="line"><span class="keyword">GO</span></span><br></pre></td></tr></table></figure></p>
<p><strong>Trigger a Log CheckPoint</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CHECKPOINT;</span><br></pre></td></tr></table></figure></p>
<p><strong>Check to see Log Space Used</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DBCC SQLPERF(LOGSPACE);</span><br></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[SQL 2012 Admin Exam 03 Configuring and Managing Instances]]></title>
      <url>www.datagriff.com/2016/10/SQL-2012-Admin-Exam-03-Configuring-and-Managing-Instances/</url>
      <content type="html"><![CDATA[<p>So on to the second chapter in 2 days, having to smash it on the weekend when I can!</p>
<h3 id="Video-Exercises"><a href="#Video-Exercises" class="headerlink" title="Video Exercises"></a>Video Exercises</h3><ul>
<li><a href="https://www.youtube.com/watch?v=cEaCRPlMUr8&amp;index=14&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1" target="_blank" rel="external">SQL 2012 Configure Min Memory and Fill Factor</a></li>
<li><a href="https://www.youtube.com/watch?v=HV_0K9Gjwso&amp;index=15&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1" target="_blank" rel="external">SQL 2012 Configuring Resource Governor</a></li>
<li><a href="https://www.youtube.com/watch?v=TLzhw3Z-hSA&amp;index=8&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1" target="_blank" rel="external">SQL 2012 Configure Database Mail</a></li>
<li><a href="https://www.youtube.com/watch?v=J_2Es-3Euq0&amp;index=9&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1" target="_blank" rel="external">SQL 2012 Modeldb to Standardise Databases</a></li>
<li><a href="https://www.youtube.com/watch?v=0V0Y6qyakRo&amp;index=10&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1" target="_blank" rel="external">SQL 2012 Install Extra Instance</a></li>
<li><a href="https://www.youtube.com/watch?v=CzIKDKzFV30&amp;index=11&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1" target="_blank" rel="external">SQL 2012 Connect Extra Instance</a></li>
<li><a href="https://www.youtube.com/watch?v=4XXAMHL1Reg&amp;index=12&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1" target="_blank" rel="external">SQL 2012 Firewall Extra Instance</a></li>
<li><a href="https://www.youtube.com/watch?v=WudFEC14Noc&amp;index=13&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1" target="_blank" rel="external">SQL 2012 Cycle Error Log</a></li>
</ul>
<h3 id="Key-Terms"><a href="#Key-Terms" class="headerlink" title="Key Terms"></a>Key Terms</h3><ul>
<li><strong>Fill Factor</strong> - This is the percentage of disk space taken up in an indexes leaf node.</li>
<li><strong>Process Affinity</strong> - Assigns worker threads to specific server processors (CPUs).</li>
<li><strong>I/O Affinity</strong> - Binds instance disk I/O operations to specific set of CPUs.</li>
<li><strong>Model Database</strong> - The model database allows for standardisation of databases being created. For example if you set the model database recovery mode to SIMPLE and create a new database on that instance, the new database will have SIMPLE recover mode also.</li>
<li><strong>Distributed Transaction Coordinator (MSDTC)</strong> - Needed for when installing integration services and have transactions across servers (not needed across instances on same server).  </li>
<li><strong>Resource Governor</strong> - Allows only certain amount of resource to be used in a <strong>resource pool</strong> that you assign <strong>workload groups</strong> to. Found under management node and only available for database engine. Works on a per instance basis.</li>
<li><strong>Windows System Resource Manager (WSRM)</strong> - Allocate system resources to specific processes such as different database engine instances. Therfore this configures resource across instances unlike resource governor which is within instance. You can configure CPU equal per process, equal per user or equal per session.</li>
</ul>
<h3 id="Notes"><a href="#Notes" class="headerlink" title="Notes"></a>Notes</h3><ul>
<li>Instance level settings include general, memory, processors, security, connections, database settings, advanced and permissions.</li>
<li>Use memory settings to balance memory across instances.</li>
<li>Database mail configured under management and you create a profile then accounts within the profile. You can have public profiles that can be accessed by any DBMail users and private where must be an msdb user.</li>
<li>Remember to run Reconfigure after sp_configure.</li>
<li>You can create classifier functions for resource governor that allow for dynamic allocation of resources that can be sourced from a configuration table. e.g. for Day and Night working.</li>
<li>You can cycle the SQL error and SQL agent error log and also configure maximum number of error log files.</li>
<li>You can deploy 50 instances of SQL server on a non-clustered server running windows server 2008 R2 enterprise.</li>
</ul>
<h3 id="Scripts"><a href="#Scripts" class="headerlink" title="Scripts"></a>Scripts</h3><p><strong>Configure a Server (Min and Max Memory)</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">EXEC sys.sp_configure '<span class="keyword">show</span> <span class="keyword">advanced</span> options<span class="string">', 1</span><br><span class="line">GO</span><br><span class="line">RECONFIGURE</span><br><span class="line">EXEC sys.sp_configure '</span><span class="keyword">min</span> <span class="keyword">server</span> <span class="keyword">memory</span><span class="string">', 1024</span><br><span class="line">GO</span><br><span class="line">EXEC sys.sp_configure '</span><span class="keyword">max</span> <span class="keyword">server</span> <span class="keyword">memory</span><span class="string">', 8096</span><br><span class="line">GO</span><br><span class="line">RECONFIGURE</span><br><span class="line">GO</span></span><br></pre></td></tr></table></figure></p>
<p><strong>Configure a Server (Fill Factor)</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">EXEC sys.sp_configure '<span class="keyword">show</span> <span class="keyword">advanced</span> options<span class="string">', 1</span><br><span class="line">GO</span><br><span class="line">RECONFIGURE</span><br><span class="line">EXEC sys.sp_configure '</span>fill factor<span class="string">', 90</span><br><span class="line">GO</span><br><span class="line">RECONFIGURE</span><br><span class="line">GO</span></span><br></pre></td></tr></table></figure></p>
<p><strong>Configure Affinity (sql workload across CPUs 2 and 3)</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">SERVER</span> CONFIGURATION <span class="keyword">SET</span> PROCESS AFINITIY CPE = <span class="number">2</span>,<span class="number">3</span></span><br></pre></td></tr></table></figure></p>
<p><strong>Configure Affinity (sql workload across all CPUs)</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">SERVER</span> CONFIGURATION <span class="keyword">SET</span> PROCESS AFINITIY CPE = <span class="keyword">AUTO</span></span><br></pre></td></tr></table></figure></p>
<p><strong>Set Model Database Recovery Mode to Simple</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> [<span class="keyword">master</span>]</span><br><span class="line"><span class="keyword">GO</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> [<span class="keyword">model</span>] <span class="keyword">SET</span> <span class="keyword">RECOVERY</span> <span class="keyword">FULL</span> <span class="keyword">WITH</span> NO_WAIT</span><br><span class="line"><span class="keyword">GO</span></span><br></pre></td></tr></table></figure></p>
<p><strong>Enable Database Mail</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">EXEC sys.sp_configure '<span class="keyword">show</span> <span class="keyword">advanced</span> options<span class="string">', 1</span><br><span class="line">GO</span><br><span class="line">RECONFIGURE</span><br><span class="line">EXEC sys.sp_configure '</span><span class="keyword">Database</span> Mail XPs<span class="string">', 1</span><br><span class="line">GO</span><br><span class="line">RECONFIGURE</span><br><span class="line">GO</span></span><br></pre></td></tr></table></figure></p>
<p><strong>Create Database Mail Account</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">EXEC msdb.dbo.sysmail_add_account_sp</span><br><span class="line">@account_name = 'Griff'</span><br><span class="line">,@email_Address = 'griff@datagriff.com'</span><br><span class="line">,@mailserver_name = 'smtp.datagriff.com'</span><br></pre></td></tr></table></figure></p>
<p><strong>Configure Database Mail</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EXEC msdb.dbo.sysmail_configure_sp</span><br><span class="line">'AccounttretryAttempts',15;</span><br></pre></td></tr></table></figure></p>
<p><strong>Install Non-Default Instance on SQL Core</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Setup.exe /qs /Action=Install /Features=SQLEngine /INstanceName=Alternate /SQLSYSADMINACCOUNTS=&quot;Contoso\Kim_Akers&quot; /IACCEPTSQLSERVERLICENSETERMS</span><br></pre></td></tr></table></figure></p>
<p><strong>Update Patch on Core</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Package_name&gt;.exe /qs /IACCEPTSQLSERVERLICENSETERMS /Action=Patch /InstanceName=ALTERNATE</span><br></pre></td></tr></table></figure></p>
<p><strong>Remove Patch on Core</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Package_name&gt;.exe /qs /IACCEPTSQLSERVERLICENSETERMS /Action=RemovePatch /InstanceName=ALTERNATE</span><br></pre></td></tr></table></figure></p>
<p><strong>Enable Resource Governor</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">RESOURCE</span> GOVERNOR RECONFIGURE;</span><br></pre></td></tr></table></figure></p>
<p><strong>Disable Resource Governor</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">RESOURCE</span> GOVERNOR <span class="keyword">DISABLE</span>;</span><br></pre></td></tr></table></figure></p>
<p><strong>Create Resource Pool</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">RESOURCE</span> POOL poolTest</span><br><span class="line"><span class="keyword">WITH</span> (MIN_CPU_PERCENT=<span class="number">25</span>);</span><br><span class="line">GO</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">RESOURCE</span> GOVERNOR RECONFIGURE;</span><br><span class="line">GO</span><br></pre></td></tr></table></figure></p>
<p><strong>Create Workload Group</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> WORKLOAD <span class="keyword">GROUP</span> groupTest</span><br><span class="line"><span class="keyword">USING</span> poolTest;</span><br><span class="line">GO</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">RESOURCE</span> GOVERNOR RECONFIGURE;</span><br><span class="line">GO</span><br></pre></td></tr></table></figure></p>
<p><strong>Use Resource Governor Classifier Function (user created)</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">RESOURCE</span> GOVERNOR <span class="keyword">WITH</span> (CLASSIFIER_FUNCTION=dbo.DayNightClassifier)</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">RESOURCE</span> GOVERNOR RECONFIGURE</span><br><span class="line"><span class="keyword">GO</span></span><br></pre></td></tr></table></figure></p>
<p><strong>Cycle SQL Error Log</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EXEC sp_cycle_errorlog;</span><br><span class="line">GO</span><br></pre></td></tr></table></figure></p>
<p><strong>Cycle SQL Agent Error Log</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> msdb;</span><br><span class="line">EXEC sp_cycle_agent_errorlog;</span><br><span class="line">GO</span><br></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[SQL 2012 Admin Exam 02 Planning And Installing]]></title>
      <url>www.datagriff.com/2016/10/SQL2012AdminExam02PlanningAndInstalling/</url>
      <content type="html"><![CDATA[<p>So I’m on to the actual first chapter of the Administration book! Still a long way to go but here’s what I learned…</p>
<h3 id="Video-Exercises"><a href="#Video-Exercises" class="headerlink" title="Video Exercises"></a>Video Exercises</h3><ul>
<li><a href="https://www.youtube.com/watch?v=I22ATtPU6QI&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1&amp;index=1" target="_blank" rel="external">SQL 2012 Configuration Checker</a></li>
<li><a href="https://www.youtube.com/watch?v=C--Spuldyps&amp;t=1s&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1&amp;index=2" target="_blank" rel="external">SQL 2012 Configure Firewall Rule</a></li>
<li><a href="https://www.youtube.com/watch?v=8PQ7hfeqdiw&amp;t=1s&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1&amp;index=3" target="_blank" rel="external">SQL 2012 Configure Firewall Rule Properly</a></li>
<li><a href="https://www.youtube.com/watch?v=7IbOerftR9o&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1&amp;index=4" target="_blank" rel="external">SQL 2012 Install</a></li>
<li><a href="https://www.youtube.com/watch?v=QKEiweNexD4&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1&amp;index=5" target="_blank" rel="external">SQL 2012 Add Features to an Installation</a></li>
<li><a href="https://www.youtube.com/watch?v=1v_ukk--kBw&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1&amp;index=6" target="_blank" rel="external">SQL 2012 Core Install</a></li>
<li><a href="https://www.youtube.com/watch?v=UUnGAg6bPAM&amp;list=PLA5YLvtN7pNP2t5SXqdyVfxvtla7oUwC1&amp;index=7" target="_blank" rel="external">SQL 2012 Attach a Database</a></li>
</ul>
<h3 id="Key-Terms"><a href="#Key-Terms" class="headerlink" title="Key Terms"></a>Key Terms</h3><ul>
<li><strong>Scaling up</strong> - Increasing system resources on current server. e.g. adding more RAM.</li>
<li><strong>Scaling out</strong> - Increase capacity across servers. e.g. AlwaysOn with readable secondaries.  </li>
<li><strong><a href="https://www.microsoft.com/en-gb/download/details.aspx?id=20163" target="_blank" rel="external">SQLIO</a></strong> - Checks I/O capacity before SQL server deployed. Tests IOPS (I/Os per second), throughput (MB/s) and latency.    </li>
<li><strong><a href="https://support.microsoft.com/en-gb/kb/231619" target="_blank" rel="external">SQLIOSIM</a></strong> - Simulate read, write, checkpoint, backup, sort and read0ahead activities for SQL server.     </li>
<li><strong><a href="https://en.wikipedia.org/wiki/CHKDSK" target="_blank" rel="external">Chkdsk</a></strong> - Tool that checks for disk errors.</li>
<li><strong>Port 1433</strong> - Database engine default instance.</li>
<li><strong>Port 1434</strong> - Dedicated admin connection.</li>
<li><strong>ConfigurationFile.ini</strong> - Stores installation settings and can reuse to ensure that same installation carried out for multiple servers. This is an example path C:\Program Files\Microsoft SQL Server\110\Setup Bootstrap\Log\20161030_014418\ConfigurationFile.ini.</li>
</ul>
<h3 id="Notes"><a href="#Notes" class="headerlink" title="Notes"></a>Notes</h3><ul>
<li>Consider operating system, processor, RAM, hard disk, software and virtualization requirements.</li>
<li>In general think newer OS for more high spec SQL.</li>
<li>64-bit version of most SQL editions require 1.4Ghz minimum or recommended 2.0Ghz processor.</li>
<li>Minimum RAM is 1GB with recommend 4GB.</li>
<li>Express can do 512MB minimum ram with 1GB recommended.</li>
<li>You can’t install reporting services on Windows Server 2008 R2 SP1 Enterprise Edition in Server Core Configuration.</li>
<li>Can’t install 64-bit Enterprise SQL 2012 on Windows 7 or Windows Server 2003.</li>
<li>SSIS can only run on servers.</li>
<li>Be careful when implementing the firewall allow program rule through, should use the % path and not direct drive letter e.g.<br><strong>%ProgramFiles%\Microsoft SQL Server\MSSQL11.MSSQLSERVER\MSSQL\Binn\sqlservr.exe</strong> Where MSSQLSERVER is the instance name!</li>
<li>You can see what features are installed on SQL Server instance using a <a href="https://blogs.msdn.microsoft.com/samlester/2013/06/13/sql-server-2012-discovery-report-determining-what-sql-server-components-are-installed/" target="_blank" rel="external">HTML summary report</a> which is dont via installation centre.</li>
<li>You can run SSIS in 32-bit mode on 64-bit machine if have SSDT installed.</li>
<li>Use Add/Remove programs to remove a feature.</li>
<li>Developer edition is good for developers as license is okay and same features as Enterprise.</li>
<li>Make sure 4GB of space on operating system before installing SQL 2012.</li>
<li>Remember to add current user as admin when installing, though you will be prompted anyway.</li>
</ul>
<h3 id="Scripts"><a href="#Scripts" class="headerlink" title="Scripts"></a>Scripts</h3><p><strong>Grow a database</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> <span class="keyword">master</span>;</span><br><span class="line">    <span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> [DBName] <span class="keyword">MODIFY</span> <span class="keyword">FILE</span></span><br><span class="line">      (<span class="keyword">Name</span>=N<span class="string">'DBName_Data'</span>), <span class="keyword">SIZE</span>=<span class="number">256000</span>KB;</span><br><span class="line">GO</span><br></pre></td></tr></table></figure></p>
<p><strong>Shrink a database</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> DBName;</span><br><span class="line">GO</span><br><span class="line">DBCC SHRINKDATABASE(N'DBName')</span><br><span class="line">GO</span><br></pre></td></tr></table></figure></p>
<p><strong>Add a File</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> DBName</span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">FILE</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">NAME</span> = DBName1,</span><br><span class="line">    FILENAME = <span class="string">'C:\Program Files\Microsoft SQL Server\MSSQL10_50.MSSQLSERVER\MSSQL\DATA\DBName1.ndf'</span>,</span><br><span class="line">    <span class="keyword">SIZE</span> = <span class="number">100</span>MB,</span><br><span class="line">    <span class="keyword">MAXSIZE</span> = <span class="number">1000</span>MB,</span><br><span class="line">    FILEGROWTH = <span class="number">5</span>MB</span><br><span class="line">)</span><br><span class="line"><span class="keyword">TO</span> FILEGROUP PRIMARY;</span><br></pre></td></tr></table></figure></p>
<p><strong>Add a FileGroup</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> DBName</span><br><span class="line">  <span class="keyword">ADD</span> FILEGROUP DBName_2;</span><br></pre></td></tr></table></figure></p>
<p><strong>Example Core Command-Line Installing SQL</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Setup.exe /qs /ACTION=Install /FEATURES=SQLEngine,Replication /INSTANCENAME=MSSQLSERVER /SQLSVCACCOUNT=&quot;&lt;DomainName\UserName&gt;&quot; /SQLSVCPASSWORD=&quot;&lt;StrongPassword&gt;&quot; /SQLSYSADMINACCOUNTS=&quot;&lt;DomainName\UserName&gt;&quot; /AGTSVCACCOUNT=&quot;NT AUTHORITY\Network Service&quot; /TCPENABLED=1 /IACCEPTSQLSERVERLICENSETERMS</span><br></pre></td></tr></table></figure></p>
<p><strong>Command-Line Connect to Another Server</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Sqlcmd.exe -S ServerName</span><br></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[SQL 2012 Admin Exam 01 Prepare Environment]]></title>
      <url>www.datagriff.com/2016/10/SQL-2012-Admin-Exam-01-Prepare-Environment/</url>
      <content type="html"><![CDATA[<p><strong>Introduction</strong></p>
<p>So I’ve decided to take the <a href="https://www.microsoft.com/en-us/learning/exam-70-462.aspx" target="_blank" rel="external">SQL 2012 DBA 70-462 Exam</a>, it’s my last of the three for the MCSA and probably my weakest skill. I’ve given myself about 40 days from yesterday to get up to speed so this should be fun.</p>
<p><strong>What this is about</strong></p>
<ul>
<li>Resources</li>
<li>Environment Setup: How fun this turned out to be!</li>
<li>Command-Line: What I learned from above.</li>
</ul>
<h3 id="Resources"><a href="#Resources" class="headerlink" title="Resources"></a>Resources</h3><p>Okay so I’m pretty much going to stick to my tried and tested - get the <a href="https://www.amazon.co.uk/Training-Kit-Exam-70-462-Administering-ebook/dp/B00IG2OS3Y/ref=sr_1_1?ie=UTF8&amp;qid=1477226838&amp;sr=8-1&amp;keywords=sql+70-462" target="_blank" rel="external">certification book</a>, <a href="https://www.microsoft.com/en-gb/learning/certification-exams.aspx" target="_blank" rel="external">book the exam</a> and get to work.<br>I’ll also watch the <a href="https://mva.microsoft.com/en-US/training-courses/administering-microsoft-sql-server-2012-jump-start-8259?l=70lJ0hKy_7704984382" target="_blank" rel="external">Microsoft Virtual Academy</a> stuff and anything else I find of interest on youtube (e.g. <a href="https://www.youtube.com/watch?v=rWwGPihzgOg" target="_blank" rel="external">Passing 70462</a>) as I go along.<br>Based on the book you’re also going to need the following downloads:</p>
<ul>
<li><a href="https://www.microsoft.com/en-GB/evalcenter/evaluate-windows-server-2012" target="_blank" rel="external">Windows Server 2012 Evaluation</a></li>
<li><a href="https://www.microsoft.com/en-gb/download/details.aspx?id=29066" target="_blank" rel="external">SQL Server 2012 Evaluation</a></li>
<li><a href="https://msftdbprodsamples.codeplex.com/releases/view/55330" target="_blank" rel="external">Adventureworks Database</a></li>
</ul>
<h3 id="Environment-Setup"><a href="#Environment-Setup" class="headerlink" title="Environment Setup"></a>Environment Setup</h3><p>Based on the book instructions to setup the lab environment to be able to carry out the exercises… I think they expect you to be some kind of infrastructure architect off the bat. I can tell you this, I am most certainly not. This became quite painful for me and I though “Christ I haven’t even started the book and this has taken me forever!”.<br>So after failed attempts of creating the environment in <a href="http://www.sqlservercentral.com/articles/certification/128503/" target="_blank" rel="external">Azure</a> (Costs and Speed) and failed attempts at doing it myself - I found this wonderful <a href="https://toddkleinhans.wordpress.com/" target="_blank" rel="external">page</a> by, who is now a god in my mind, Todd Kleinhans. Thank you so much.</p>
<p><strong>Just in case you missed it above, here again is the <a href="https://toddkleinhans.wordpress.com/" target="_blank" rel="external">page</a> with all the wonderful instructions.</strong></p>
<p>So if you follow the instructions in the word document attached to the page above you’ll be fine.<br>Highlights from it include:</p>
<ul>
<li>Download the trial version of <a href="http://www.vmware.com/uk/products/workstation/workstation-evaluation.html" target="_blank" rel="external">VMWare Pro</a>, the free version doesn’t include snapshots. (yet another time constraint for me to get this done in 30 days!)</li>
<li>Use <a href="https://www.microsoft.com/en-GB/evalcenter/evaluate-windows-server-2012" target="_blank" rel="external">Windows Server 2012</a> instead of 2008 - make sure change from default “update” to custom install during the installation or you’ll get stuck in an idiot loop like me.</li>
<li>As soon as you’ve installed Windows create shortcuts for administrative tools and command prompt, I found the operating system layout a bit windows 8 and a bugger to navigate through.</li>
<li>Make sure you tick DNS when installing the Domain Controller - this was a stupid mistake I made as I excitedly rushed through the instructions.</li>
<li>Make sure click the “new forest” option in Active Directory Domain Services Configuration Wizard when configuring the domain controller.</li>
<li>Be careful when copying and pasting the instructions for SQLA (yes it says this but I still managed to go on autopilot and mess it up)</li>
<li>Basically… <strong>READ THE INSTRUCTIONS AND FOLLOW THEM ALL - THEY ARE GOOD.</strong>  </li>
<li>Although I did have an issue with the SQLCORE installation and had to run the sysprep thing just like the other servers, this wasn’t explicitly mentioned in the instructions.</li>
<li>Share your network drives for resources from your actual machine in the VM to make life easier.</li>
</ul>
<h3 id="Command-Line-I-learned-from-above"><a href="#Command-Line-I-learned-from-above" class="headerlink" title="Command-Line I learned from above"></a>Command-Line I learned from above</h3><p>Getting the name of the local area connection - this is not always Ethernet so check!<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh int ip show int</span><br></pre></td></tr></table></figure></p>
<p>Change an IP address.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh interface ipv4 set address &quot;Local Area connection&quot; static 10.10.10.10 #Change IP Address</span><br></pre></td></tr></table></figure></p>
<p>Okay I knew this one - getting the IP details for the machine you’re on.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipconfig</span><br></pre></td></tr></table></figure></p>
<p>Getting the name of the computer.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hostname</span><br></pre></td></tr></table></figure></p>
<p>Renaming a machine.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netdom renamecomputer %computername% /newname:DC</span><br></pre></td></tr></table></figure></p>
<p>Join a machine to a network<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netdom join ComputerName /domain:domainname.com</span><br></pre></td></tr></table></figure></p>
<p>Reboot a machine.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shutdown /r /t 0</span><br></pre></td></tr></table></figure></p>
<p>I don’t think this did anything but may need it if get failed to configure DHCP error…<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh int ip reset</span><br></pre></td></tr></table></figure></p>
<p>Force group policy update.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpupdate /force</span><br></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[SQL Relay 2016 - Build a Database for free with Team Services Online, SSDT and Azure]]></title>
      <url>www.datagriff.com/2016/10/SQLRelay2016DIYDBFromHome/</url>
      <content type="html"><![CDATA[<p>I am speaking again at SQL Relay this year and I decided to cover some of the basics. It was only about 18 months ago I had never used source control, never used any cloud services and it all seemed quite beyond me… But it’s not!<br>The aim of my talk this year is to hopefully speed up this process for people who find themselves in a similar situation that I was in and show all the free tools and resources that are available to you.</p>
<a href="/2016/10/SQLRelay2016DIYDBFromHome/zSQLRelay2016DIYDBFromHomeSlideShow.html" title="SQL Relay 2016 Presentation">SQL Relay 2016 Presentation</a>
<p>The presentation covers the basics of the following:</p>
<ul>
<li>Database design</li>
<li>Work management</li>
<li>Source control</li>
<li>Infrastructure locally and in the cloud</li>
<li>Database Development</li>
<li>Deployment</li>
</ul>
<h2 id="PreRequisites"><a href="#PreRequisites" class="headerlink" title="PreRequisites"></a>PreRequisites</h2><p>The demonstrations in the talk require the following:</p>
<ul>
<li><a href="https://git-scm.com/" target="_blank" rel="external">Git</a> &amp; <a href="https://github.com/" target="_blank" rel="external">Github Account</a> - For source control</li>
<li><a href="https://www.visualstudio.com/team-services/" target="_blank" rel="external">Team Services Online Account</a> - For source control and Work Management</li>
<li><a href="https://www.visualstudio.com/vs/community/" target="_blank" rel="external">Visual Studio Community Edition</a> - For code development and infrastructure</li>
<li><a href="https://www.microsoft.com/en-gb/download/details.aspx?id=52679" target="_blank" rel="external">SQL Server Express</a> - For code development and infrastructure</li>
<li><a href="https://azure.microsoft.com/en-gb/" target="_blank" rel="external">Azure Account</a> - For infrastructure</li>
<li><a href="https://notepad-plus-plus.org/download/v6.9.2.html" target="_blank" rel="external">Notepad++</a>, <a href="https://atom.io/" target="_blank" rel="external">Atom</a> - These are both useful text editors</li>
</ul>
<h2 id="Accompanying-Youtube-Videos"><a href="#Accompanying-Youtube-Videos" class="headerlink" title="Accompanying Youtube Videos"></a>Accompanying Youtube Videos</h2><p>I’ve pushed the boat out with this years talk and decided to make myself a youtube channel and playlist to demonstrate the tools used.<br><a href="https://www.youtube.com/playlist?list=PLA5YLvtN7pNPqa77xX-g0K5roN93BOAS2" target="_blank" rel="external">SQL Relay 2016 Demos</a></p>
<h2 id="Accompanying-Github-Repository"><a href="#Accompanying-Github-Repository" class="headerlink" title="Accompanying Github Repository"></a>Accompanying Github Repository</h2><p>I’ve also created a more detail github code respository of the MyGymDB project which I hope to add to over time.<br>This includes a ReadMe file with further details and instructions to implement the database yourself.<br><a href="https://github.com/griff182uk/MyGymDB" target="_blank" rel="external">MyGymDB GitHub Repository</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Github IO Page 404 Error Hexo CNAME]]></title>
      <url>www.datagriff.com/2016/09/Github404ErrorCNAME/</url>
      <content type="html"><![CDATA[<h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>Unless you ensure your CNAME file with the name of your domain is in your github io repository root folder, you’ll get a 404 error on the domain of your github io page.<br>When deploying in Hexo this file gets overwritten unless you place it in the source folder of your raw Hexo files.</p>
<p><strong>What we’re going to do:</strong></p>
<ul>
<li>Ensure the CNAME file is in the Hexo source folder with domain name</li>
<li>Ensure this CNAME file is the root folder of the Hexo output</li>
<li>Ensure this CNAME file is in the root of your github io repository</li>
</ul>
<h3 id="CNAME-in-hexo-source-folder"><a href="#CNAME-in-hexo-source-folder" class="headerlink" title="CNAME in hexo source folder"></a>CNAME in hexo source folder</h3><p>First ensure that you place a CNAME file in the source folder of your raw hexo folder with the name of your domain contained in the file. <strong>Note</strong> there is no file extension for the CNAME file.</p>
<img src="/2016/09/Github404ErrorCNAME/CNAMESourceFolder.PNG" alt="CNAME in Hexo Source Folder" title="CNAME in Hexo Source Folder">
<h3 id="CNAME-in-hexo-output-root-folder"><a href="#CNAME-in-hexo-output-root-folder" class="headerlink" title="CNAME in hexo output root folder"></a>CNAME in hexo output root folder</h3><p>Then after you have done the Hexo generate command, ensure that you can see the CNAME file in the root of your  output folder.</p>
<img src="/2016/09/Github404ErrorCNAME/CNAMEOutputFolder.PNG" alt="CNAME in root of Hexo Output Folder" title="CNAME in root of Hexo Output Folder">
<h3 id="CNAME-in-root-folder-of-Github-IO-Repository"><a href="#CNAME-in-root-folder-of-Github-IO-Repository" class="headerlink" title="CNAME in root folder of Github IO Repository"></a>CNAME in root folder of Github IO Repository</h3><p>Then after you have done the Hexo deploy command (using git) to your github IO repository, ensure the CNAME file is there.</p>
<img src="/2016/09/Github404ErrorCNAME/CNAMEGitHubIO.PNG" alt="CNAME in root folder of Github IO repo" title="CNAME in root folder of Github IO repo">
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Azure Create SQL Database]]></title>
      <url>www.datagriff.com/2016/09/AzureSQLPaaS/</url>
      <content type="html"><![CDATA[<h2 id="Azure-Create-SQL-Database"><a href="#Azure-Create-SQL-Database" class="headerlink" title="Azure Create SQL Database"></a>Azure Create SQL Database</h2><p>Please note if you want to go straight to the official azure documentation, please go <a href="https://azure.microsoft.com/en-gb/documentation/articles/sql-database-get-started/" target="_blank" rel="external">here</a>. It’s probably more up to date than this already! :)</p>
<p>In this quick example we’re going to see how to create a SQL database in Azure using the PaaS offering. This stands for platform as a service and is a complete service provided by Microsoft. It does have it’s limitations but is a great way to spin up a database to play with no concerns over infrastructure or software administration. This is any idea for any new applications you may have or just to have some fun!</p>
<p><strong>What we’re going to do:</strong></p>
<ul>
<li>We’re going to make sure you have an <a href="https://azure.microsoft.com/en-gb/" target="_blank" rel="external">azure</a> account</li>
<li>Create a SQL Database in Azure</li>
<li>Connect to the SQL Database via SSMS</li>
</ul>
<h3 id="Get-yourself-an-Azure-Account"><a href="#Get-yourself-an-Azure-Account" class="headerlink" title="Get yourself an Azure Account"></a>Get yourself an Azure Account</h3><p>Don’t fear the Azure! Get yourself over to <a href="https://azure.microsoft.com/en-gb/" target="_blank" rel="external">azure</a> and set yourself up an account. It will ask for bank details but you get a load of credit free at the start and if you have an MSDN license you have even more. You can also cap your spending limit. See the screenshot below to allay your fears… We’ll revisit this at the end as I would guess this would be the biggest sticking point for most people when approaching Azure. It’s all good…</p>
<h3 id="Create-a-SQL-Database-in-Azure"><a href="#Create-a-SQL-Database-in-Azure" class="headerlink" title="Create a SQL Database in Azure"></a>Create a SQL Database in Azure</h3><p>When logged in to your Azure portal use search tool and type in SQL Database.</p>
<img src="/2016/09/AzureSQLPaaS/01_Search.png" alt="Search SQL Database Azure Portal" title="Search SQL Database Azure Portal">
<p>Pick SQL Database</p>
<img src="/2016/09/AzureSQLPaaS/PickSQLDatabase.PNG" alt="Pick SQL Database" title="Pick SQL Database">
<p>then click Create</p>
<img src="/2016/09/AzureSQLPaaS/02_Create.PNG" alt="Create SQL Database Azure" title="Create SQL Database Azure">
<p>Enter in the  database details. This includes the database name, setting up a new resource group (if don’t already have one), setting your collation and selecting your developer pricing benefit package. Remember to select the basic pricing tier to save your credits. You’ll also need to configure a logical server for this database to live which you will see in the next section.<br>P.s in the Select source section you can choose a sample database rather than a blank one if you want some ready made data!</p>
<img src="/2016/09/AzureSQLPaaS/03_ConfigureDatabase.PNG" alt="Configure SQL Database Azure" title="Configure SQL Database Azure">
<p>Click the Configure Server settings and create a new server (if don’t already have one).</p>
<img src="/2016/09/AzureSQLPaaS/04_ConfigureServerSettings.PNG" alt="Click Configure Server Settings Azure" title="Click Configure Server Settings Azure">
<img src="/2016/09/AzureSQLPaaS/05_CreateNewServer.PNG" alt="Create Logical Server Azure" title="Create Logical Server Azure">
<p>Set the name of your logical server. Create a server admin login and a password, <strong>you’ll need these later to logon to your database so remember this!</strong> Leave the rest as default then just to get along…</p>
<img src="/2016/09/AzureSQLPaaS/06_ServerDetails.PNG" alt="Configure Logical Server Details" title="Configure Logical Server Details">
<p>Now that you are back to your configure database page after configuring your server, click create! Have a look in your notifications and you will see it deploying.</p>
<img src="/2016/09/AzureSQLPaaS/07_DeployStartedUnderNotifications.PNG" alt="Validating Deployment" title="Validating Deployment">
<p>Once this is done, we can look at connecting in the next step!</p>
<h3 id="Connect-to-the-SQL-Database-via-SSMS"><a href="#Connect-to-the-SQL-Database-via-SSMS" class="headerlink" title="Connect to the SQL Database via SSMS"></a>Connect to the SQL Database via SSMS</h3><p>In Azure go back to your homepage and pick SQL databases. You will see the list of your SQL databases. Pick the one you want to create a connection to (the one you just made).</p>
<img src="/2016/09/AzureSQLPaaS/YourSQLDatabases.PNG" alt="Go to your SQL Databases" title="Go to your SQL Databases">
<p>Now you need to ensure that your local PC is going to be able to connect to your database so click the Set Server Firewall tab at the top in the database settings.</p>
<img src="/2016/09/AzureSQLPaaS/SetServerFirewall.PNG" alt="Set Firewall" title="Set Firewall">
<p>Click add client IP.</p>
<img src="/2016/09/AzureSQLPaaS/AddClientIP.PNG" alt="Add Client IP" title="Add Client IP">
<p>This will then save your IP address to allow connection.</p>

<p>And finally you will get a success…</p>
<img src="/2016/09/AzureSQLPaaS/FirewallSuccess.PNG" alt="Firewall Success" title="Firewall Success">
<p>Now you have set the firewall rules, go back to your database settings and get the full name of your database. This is the one that ends with database.windows.net and you can hover over the end of it and just click copy.</p>
<img src="/2016/09/AzureSQLPaaS/CopyServerName.PNG" alt="Copy full path of database" title="Copy full path of database">
<p>Open SSMS and paste in the full path, ensure SQL authentication is chosen and use the admin account and password you created earlier.</p>
<img src="/2016/09/AzureSQLPaaS/SSMSConnect.PNG" alt="SSMS Connect Dialog" title="SSMS Connect Dialog">
<p>Hey presto! There’s your database in the cloud!</p>
<img src="/2016/09/AzureSQLPaaS/SSMSConnected.PNG" alt="SSMS Connected to database in the Cloud" title="SSMS Connected to database in the Cloud">
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Add Visual Studio Project to Online Visual Studio Team Services]]></title>
      <url>www.datagriff.com/2016/08/AddVisualStudioProjectTeamServices/</url>
      <content type="html"><![CDATA[<p>The following shows you how to add an existing Visual Studio project to your visual studio team services online account.</p>
<p>First open your solution in Visual Studio, right click the solution and select “Add to Source Control.”</p>
<img src="/2016/08/AddVisualStudioProjectTeamServices/VSAddToSourceControl.png" alt="Visual Studio Add to Source Control" title="Visual Studio Add to Source Control">
<p>You will then see that the project has green lock icons next to its files.</p>
<img src="/2016/08/AddVisualStudioProjectTeamServices/VSSolutionAddedToSourceControl.png" alt="Visual Studio Added to Source Control" title="Visual Studio Added to Source Control">
<p>And the file architecture folder will have git files.</p>
<img src="/2016/08/AddVisualStudioProjectTeamServices/GitAddedToSolution.png" alt="Solution Folder Git Files" title="Solution Folder Git Files">
<p>Both showing that you have added the solution to a local Git repo for source control.</p>
<p>Open the team explorer window and select Sync.</p>
<img src="/2016/08/AddVisualStudioProjectTeamServices/VSSync.png" alt="Visual Studio Sync" title="Visual Studio Sync">
<p>With the options that you get presented with, choose Publish to Visual Studio Team Service by clicking Publish Git Repo.</p>
<img src="/2016/08/AddVisualStudioProjectTeamServices/ChoosePublishVSOnline.png" alt="Choose Publish Visual Studio Team Services" title="Choose Publish Visual Studio Team Services">
<p>Publish the project to your online visual studio account (you may need to sign in again here), by entering an appropriate name for your new repository and select then Publish Repository.</p>
<img src="/2016/08/AddVisualStudioProjectTeamServices/PublishProject.png" alt="Visual Studio Publish Project" title="Visual Studio Publish Project">
<p>Open a browser and navigate to your Visual Studio team services homepage. You may not see the project in your list so you might have to choose browse and find your new project there.</p>
<img src="/2016/08/AddVisualStudioProjectTeamServices/BrowseToNewProject.png" alt="Browse to Visual Studio Team Service Project" title="Browse to Visual Studio Team Service Project">
<p>There you will see the code from your Visual Studio solution online in your team services source control.</p>
<img src="/2016/08/AddVisualStudioProjectTeamServices/VSOnlineCodeAdded.png" alt="Visual Studio Team Service Project Code" title="Visual Studio Team Service Project Code">
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Visual Studio Team Services New Project]]></title>
      <url>www.datagriff.com/2016/07/VisualStudioOnlineNewProject/</url>
      <content type="html"><![CDATA[<p><a href="https://www.visualstudio.com/en-us/products/visual-studio-team-services-vs.aspx" target="_blank" rel="external">Visual studio team services</a> is an online tool for managing your visual studio code. It is a free tool for individuals that provides source control, project management, Kanban boards, automated builds, testing and much more. I’ve found it a useful way of managing my visual studio work and also a way of practicing for team foundation server in the workplace when I don’t actually have it!</p>
<p>The following explains how to simply setup a visual studio team services project, clone it in visual studio and then keep your code in the source control provided by team services. I will be choosing the Git style rather than the TFS version of source control, just because I’m now used to Git and I think it’s more flexible. Also you get the added bonus of a local git repository if you can’t get online for any reason.</p>
<h2 id="Setup-a-visual-studio-team-services-account"><a href="#Setup-a-visual-studio-team-services-account" class="headerlink" title="Setup a visual studio team services account"></a>Setup a visual studio team services account</h2><p>If you haven’t already got one - set yourself up a visual studio account. At the time of writing the link for this could be found at <a href="https://www.visualstudio.com/en-us/products/visual-studio-team-services-vs.aspx" target="_blank" rel="external">Visual studio team services</a>, if it’s moved just google visual studio team services or visual studio online and follow the relevant paths and instructions.</p>
<p>Another prerequisite for the following is obviosuly having <a href="https://www.visualstudio.com/" target="_blank" rel="external">visual studio</a> installed on your local machine… Nearly forgot that one!</p>
<h2 id="Setup-a-new-online-project"><a href="#Setup-a-new-online-project" class="headerlink" title="Setup a new online project"></a>Setup a new online project</h2><p>Select new under Recent Projects &amp; Teams of you visual studio team services account.</p>
<img src="/2016/07/VisualStudioOnlineNewProject/VSOnlineNewProject.png" alt="Team Services New Project" title="Team Services New Project">
<p>Give the project a name, a description, pick a process template (<strong>Agile</strong> is fine for me and provides a Kanban board but you may want to choose a different one if you wish) and your version control (as I mentioned in the beginning I use <strong>Git</strong> as I believe it’s more flexible), then click create project.</p>
<img src="/2016/07/VisualStudioOnlineNewProject/VSOnlineCreateProject.png" alt="Team Services Create Project" title="Team Services Create Project">
<p>Once your project is created click navigate to project.</p>
<img src="/2016/07/VisualStudioOnlineNewProject/VSOnlineProjectCreated.png" alt="Team Services Project Created" title="Team Services Project Created">
<p>You can start managing your work or add your code. In this example we’re just going to focus on getting code in and syncing this with your visual studio project, so we’ll choose add code.</p>
<img src="/2016/07/VisualStudioOnlineNewProject/VSOnlineProjectChooseCode.png" alt="Team Services Add Code" title="Team Services Add Code">
<h2 id="Link-your-online-project-to-visual-studio-code"><a href="#Link-your-online-project-to-visual-studio-code" class="headerlink" title="Link your online project to visual studio code"></a>Link your online project to visual studio code</h2><p>After choosing add code Select “Clone in Visual Studio”.</p>
<img src="/2016/07/VisualStudioOnlineNewProject/VSOnlineClone.png" alt="Team Services Clone" title="Team Services Clone">
<p>In any external protocol request that pops up just click accept. Visual studio will now open with an empty project, but in the <strong>team explorer</strong> window on the right you will see the option to clone from your online project, click clone.</p>
<img src="/2016/07/VisualStudioOnlineNewProject/VSClone.png" alt="Visual Studio Clone" title="Visual Studio Clone">
<p>You will see a message for the new repository being cloned successfully.</p>
<img src="/2016/07/VisualStudioOnlineNewProject/VSSuccesfulClone.png" alt="Visual Studio Successful Clone" title="Visual Studio Successful Clone">
<p>Then start a new solution for whatever project it is you’re going to do. In my example I’m just going to create a windows form project.<br>Back in the team explorer window click changes and you will see a load of changes as a result of creating the project. Click the + icon to stage these changes.</p>
<img src="/2016/07/VisualStudioOnlineNewProject/VSStageChanges.png" alt="Visual Studio Stage Changes" title="Visual Studio Stage Changes">
<p>Then type a commit message in the box at the top to describe your changes and click commit staged.</p>
<img src="/2016/07/VisualStudioOnlineNewProject/VSCommit.png" alt="Visual Studio Commit Changes" title="Visual Studio Commit Changes">
<p>Then click sync to share with your server.</p>
<img src="/2016/07/VisualStudioOnlineNewProject/VSSync.png" alt="Visual Studio Sync" title="Visual Studio Sync">
<p>Finally in the synchronisation menu that appears select push.</p>
<img src="/2016/07/VisualStudioOnlineNewProject/VSPush.png" alt="Visual Studio Push" title="Visual Studio Push">
<p>You should then see this successfully pushing to your origin which is your visual studio team services project.</p>
<img src="/2016/07/VisualStudioOnlineNewProject/VSSuccessfulPush.png" alt="Visual Studio Push Success" title="Visual Studio Push Success">
<p>Lets go back online and see if we can see it, refresh the page and… Hey presto your code is added to your online project.</p>
<img src="/2016/07/VisualStudioOnlineNewProject/VSOnlineInitialCommit.png" alt="Visual Studio Online Initial Commit" title="Visual Studio Online Initial Commit">
<h2 id="Quick-Reference-for-Working-with-your-Visual-Studio-Team-Services"><a href="#Quick-Reference-for-Working-with-your-Visual-Studio-Team-Services" class="headerlink" title="Quick Reference for Working with your Visual Studio Team Services"></a>Quick Reference for Working with your Visual Studio Team Services</h2><p>Just to quickly go through the process of adding code, committing, syncing and pushing to your team services project. Make a change to your project e.g. adding a form button.</p>
<ol>
<li>Make a change to your code in Visual Studio</li>
<li>Save the changes</li>
<li>In <strong>team explorer</strong> go to changes menu</li>
<li>Add your staged changes</li>
<li>Commit your stage changes with a message</li>
<li>Sync your changes</li>
<li>Push your changes</li>
</ol>
<img src="/2016/07/VisualStudioOnlineNewProject/VSOnlineCommitedExample.png" alt="Visual Studio Online Committed Example" title="Visual Studio Online Committed Example">
<p>This will keep your visual studio code in the visual studio team services online source control, available for you to work from wherever you are with internet access! Sweet.<br>There’s a hell of a lot more you can do with visual studio online but this should give you the basics to use the tool as a system source control.   </p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Get by with Git]]></title>
      <url>www.datagriff.com/2016/07/GetByWithGit/</url>
      <content type="html"><![CDATA[<p>Source control allows you to keep version history of your code all in one place. It also allows multiple teams to work on the same code using the concepts of branching and merging… I’m not going to talk about that though - this is just a brief post on how you can easily set up source control for free for your own code, using it locally (on your machine), with the option of pushing it to a distributed <a href="https://github.com/" target="_blank" rel="external">github repository</a> as well, along with the key commands to get by for most of what you’re going to do.</p>
<h2 id="Quick-Reference"><a href="#Quick-Reference" class="headerlink" title="Quick Reference"></a>Quick Reference</h2><p>This is what you’re going to be doing most of the time! (once setup).</p>
<ul>
<li>Add your local files</li>
<li>Commit your local files</li>
<li>Push those changes to your distributed github repo.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m &quot;message&quot;</span><br><span class="line">git push origin master</span><br></pre></td></tr></table></figure>
<p>For detail see sections below.</p>
<h2 id="Step-1-Setting-Git-up-Locally"><a href="#Step-1-Setting-Git-up-Locally" class="headerlink" title="Step 1: Setting Git up Locally"></a>Step 1: Setting Git up Locally</h2><p>First download <a href="https://git-for-windows.github.io/" target="_blank" rel="external">git bash</a>. This allows you to locally set up source control on a folder on your local machine (hooray!).<br>To start git bash on a folder after you have installed git, just right-click the folder and select “Git Bash Here”.</p>
<p><img src="/images/GitBashStart.png" alt="Git Bash Start"></p>
<p>Git bash just looks like a command prompt.<br>Below is an example of some git bash code.</p>
<p><img src="/images/GitAdd.png" alt="Git Add Example"></p>
<h2 id="Step-2-Commands-to-Get-By-Locally"><a href="#Step-2-Commands-to-Get-By-Locally" class="headerlink" title="Step 2: Commands to Get By Locally"></a>Step 2: Commands to Get By Locally</h2><p>The following command initialises git on the folder you started git bash in. That’s all you need to start a local git repository! You’re only going to execute this once, when you’re setting up your new repo locally.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br></pre></td></tr></table></figure></p>
<p>The following command tells you the status of the local git folder. What has changed, what hasn’t been committed etc. It’s always handy to check…<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git status</span><br></pre></td></tr></table></figure></p>
<p>I pretty much run this as standard every time before I perform a commit just to make sure everything is added to the git source control. The status will changed as you amend files.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br></pre></td></tr></table></figure></p>
<p>You can though add a specific file name if you only want to perform that commit right now. I rarely do this though as I just want everything chucked in so I perform the command above. <strong>Remember you can only commit files to your git source control once you’ve added them!</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git add &quot;filename&quot;</span><br></pre></td></tr></table></figure></p>
<p>Once you’ve added or amended your files commit them to the git source control with an appropriate message using the following.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit -m &quot;My Message&quot;</span><br></pre></td></tr></table></figure></p>
<h2 id="Step-3-Commands-to-Get-by-with-Distributed-Git"><a href="#Step-3-Commands-to-Get-by-with-Distributed-Git" class="headerlink" title="Step 3: Commands to Get by with Distributed Git"></a>Step 3: Commands to Get by with Distributed Git</h2><p>First you need to set up your repository on your <a href="https://github.com/" target="_blank" rel="external">github</a> and then copy the link in your repo where it says clone or download.</p>
<p><img src="/images/GitHubCopyURL.png" alt="Github Copy URL"></p>
<p>When in git bash on your local folder run the following command to add the github repository link, pasting in your repo where it says “add origin”.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin &quot;http://github.com/foo&quot;</span><br></pre></td></tr></table></figure></p>
<p>At the start it is likely you will have a readme file in the github repo, so you will need to first pull from the Distributed repo to make sure everything is in sync, otherwise it just throws a wobbly. So run this.<br>P.S when you run this you’ll probably get a text editor pop up asking for a commit message - I just close this.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull &quot;http://github.com/foo&quot; master</span><br></pre></td></tr></table></figure></p>
<p>Then this is the command you will be running all the time from your local folder to keep your distributed repo up to date. It’s pretty much git add ., git commit -m “message”, then the following command for most of your source control needs.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin master</span><br></pre></td></tr></table></figure></p>
<p>You can see when you execute the above command the local changes get pushed to the distributed system. In the screenshot below the test.txt file had been pushed to the distributed repo from the local folder.</p>
<p><img src="/images/GitRepoPushed.png" alt="Github Repo Pushed"></p>
<p>If you have made changes to the distributed repo and want to bring them in to your local git repo, you can just run this.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull</span><br></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Hexo Quick New Post and Deploy]]></title>
      <url>www.datagriff.com/2016/06/HexoQuickNewPostAndDeploy/</url>
      <content type="html"><![CDATA[<p>Below shows the quick process of creating and deploying a new post, while keeping everything under source control. This post assumes you already have the source folder initialised with git and linked to a standard repository, and the output folder initialised with git, linked to your io repository.  </p>
<p>Navigate to your hexo source folder in node.js command prompt.<br>In my case this is E:\Documents\Projects\DataGriff\Raw.</p>
<p><img src="\images\HexoSourceFolder.png" alt="Hexo Source Folder in Node.js Command Prompt"></p>
<p>Enter the command:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new post test</span><br></pre></td></tr></table></figure></p>
<p><img src="\images\HexoNewPost.png" alt="Hexo New Post Command in Node.js Command Prompt"></p>
<p>This will create a new post file called test.md. Don’t close the node.js command prompt as you use it again at the end to deploy.</p>
<p>Start Git bash on your source folder and check the status by using:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git status</span><br></pre></td></tr></table></figure></p>
<p><img src="\images\GitStatusChange.png" alt="Git Status New Post Added"><br>This will show a new file called test.md has been added.</p>
<p>Use the command below to add all the changed or new files.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br></pre></td></tr></table></figure></p>
<p><img src="\images\GitAddAll.png" alt="Git Add All Files Using Git Bash"><br>Use the command below to commit the changes with a message.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit -m &quot;new post added&quot;</span><br></pre></td></tr></table></figure></p>
<p><img src="\images\GitCommit.png" alt="Git Commit with Message  Using Git Bash"><br>Check the status again and you will see there are no changes now as you have committed them.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git status</span><br></pre></td></tr></table></figure></p>
<p><img src="\images\GitStatusClean.png" alt="Git Status Clean  Using Git Bash"><br>To keep your remote repository up to date, use the command below.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin master</span><br></pre></td></tr></table></figure></p>
<p><img src="\images\GitPushOriginMaster.png" alt="Git Sync with Remote Using Git Bash"><br>Revert back to the node.js command prompt and use the following command to generate the output files<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo generate</span><br></pre></td></tr></table></figure></p>
<p><img src="\images\HexoGenerate.png" alt="Hexo Generate Command in Node.js"><br>Still in the node.js command prompt use the following command to deploy the output files to your github io repo and so your website.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo deploy</span><br></pre></td></tr></table></figure></p>
<p><img src="\images\HexoDeploy.png" alt="Hexo Deploy Command in Node.js"><br>You should then be able to see the new post if you refresh the page.<br><img src="\images\HexoTestPost.png" alt="Hexo New Post"></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[SQL Aggregate Across Columns]]></title>
      <url>www.datagriff.com/2016/06/SQLAggregateAcrossColumns/</url>
      <content type="html"><![CDATA[<p>In order to aggregate across columns in SQL you can use the following syntax.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">  (<span class="keyword">SELECT</span> <span class="keyword">Aggregate</span>(v) <span class="keyword">FROM</span> (<span class="keyword">VALUES</span> (ColA), (ColB), (ColC),...) <span class="keyword">AS</span> <span class="keyword">value</span>(v)) <span class="keyword">as</span> [AggregateCol]</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">Object</span>;</span><br></pre></td></tr></table></figure>
<h2 id="Aggregate-Dates-Across-Columns-Example"><a href="#Aggregate-Dates-Across-Columns-Example" class="headerlink" title="Aggregate Dates Across Columns Example"></a>Aggregate Dates Across Columns Example</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--Example 1: Dates Min and Max Across Columns</span></span><br><span class="line">WITH CTE AS (</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CAST</span>(<span class="string">'01-Jan-2016'</span> <span class="keyword">AS</span> <span class="built_in">DATE</span>) <span class="keyword">AS</span> DateA, <span class="keyword">CAST</span>(<span class="string">'10-Jan-2016'</span> <span class="keyword">AS</span> <span class="built_in">DATE</span>) <span class="keyword">AS</span> DateB, <span class="keyword">CAST</span>(<span class="string">'15-Jan-2016'</span> <span class="keyword">AS</span> <span class="built_in">DATE</span>) <span class="keyword">AS</span> DateC</span><br><span class="line"><span class="keyword">UNION</span> ALL <span class="keyword">SELECT</span> <span class="string">'05-Jan-2016'</span> <span class="keyword">AS</span> DateA, <span class="string">'04-Jan-2016'</span> <span class="keyword">AS</span> DateB, <span class="string">'16-Jan-2016'</span> <span class="keyword">AS</span> DateC</span><br><span class="line"><span class="keyword">UNION</span> ALL <span class="keyword">SELECT</span> <span class="string">'08-Jan-2016'</span> <span class="keyword">AS</span> DateA, <span class="string">'31-Dec-2015'</span> <span class="keyword">AS</span> DateB, <span class="string">'10-Jan-2016'</span> <span class="keyword">AS</span> DateC</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">  (<span class="keyword">SELECT</span> <span class="keyword">MAX</span>(v) <span class="keyword">FROM</span> (<span class="keyword">VALUES</span> (DateA), (DateB), (DateC)) <span class="keyword">AS</span> <span class="keyword">value</span>(v)) <span class="keyword">as</span> [MaxDate]</span><br><span class="line">  ,  (<span class="keyword">SELECT</span> <span class="keyword">MIN</span>(v) <span class="keyword">FROM</span> (<span class="keyword">VALUES</span> (DateA), (DateB), (DateC)) <span class="keyword">AS</span> <span class="keyword">value</span>(v)) <span class="keyword">as</span> [MinDate]</span><br><span class="line"><span class="keyword">FROM</span> CTE;</span><br></pre></td></tr></table></figure>
<p><strong>Outputs</strong></p>
<table>
<thead>
<tr>
<th>MaxDate</th>
<th>MinDate</th>
</tr>
</thead>
<tbody>
<tr>
<td>2016-01-15</td>
<td>2016-01-01</td>
</tr>
<tr>
<td>2016-01-16</td>
<td>2016-01-04</td>
</tr>
<tr>
<td>2016-01-10</td>
<td>2015-12-31</td>
</tr>
</tbody>
</table>
<h2 id="Aggregate-Numeric-Across-Columns-Example"><a href="#Aggregate-Numeric-Across-Columns-Example" class="headerlink" title="Aggregate Numeric Across Columns Example"></a>Aggregate Numeric Across Columns Example</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--Example 2: Sum and Average Numbers Across Columns</span></span><br><span class="line">WITH CTE AS (</span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">5</span> <span class="keyword">AS</span> NumA, <span class="number">10</span> <span class="keyword">AS</span> <span class="keyword">NumB</span>, <span class="number">15</span> <span class="keyword">AS</span> NumC</span><br><span class="line"><span class="keyword">UNION</span> ALL <span class="keyword">SELECT</span> <span class="number">20</span> <span class="keyword">AS</span> NumA, <span class="number">40</span> <span class="keyword">AS</span> <span class="keyword">NumB</span>, <span class="number">60</span> <span class="keyword">AS</span> NumC</span><br><span class="line"><span class="keyword">UNION</span> ALL <span class="keyword">SELECT</span> <span class="number">25</span> <span class="keyword">AS</span> NumA, <span class="number">50</span> <span class="keyword">AS</span> <span class="keyword">NumB</span>, <span class="number">75</span> <span class="keyword">AS</span> NumC</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">  (<span class="keyword">SELECT</span> <span class="keyword">SUM</span>(v) <span class="keyword">FROM</span> (<span class="keyword">VALUES</span> (NumA), (<span class="keyword">NumB</span>), (NumC)) <span class="keyword">AS</span> <span class="keyword">value</span>(v)) <span class="keyword">as</span> [SumNum]</span><br><span class="line">  ,  (<span class="keyword">SELECT</span> <span class="keyword">AVG</span>(v) <span class="keyword">FROM</span> (<span class="keyword">VALUES</span> (NumA), (<span class="keyword">NumB</span>), (NumC)) <span class="keyword">AS</span> <span class="keyword">value</span>(v)) <span class="keyword">as</span> [AvgNum]</span><br><span class="line"> <span class="keyword">FROM</span> CTE;</span><br></pre></td></tr></table></figure>
<p><strong>Outputs</strong></p>
<table>
<thead>
<tr>
<th>SumNum</th>
<th>AvgNum</th>
</tr>
</thead>
<tbody>
<tr>
<td>30</td>
<td>10</td>
</tr>
<tr>
<td>120</td>
<td>40</td>
</tr>
<tr>
<td>150</td>
<td>50</td>
</tr>
</tbody>
</table>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Configure Hexo]]></title>
      <url>www.datagriff.com/2016/06/ConfigureHexo/</url>
      <content type="html"><![CDATA[<h2 id="Configuring-Hexo-using-the-config-yml-file"><a href="#Configuring-Hexo-using-the-config-yml-file" class="headerlink" title="Configuring Hexo using the _config.yml file"></a>Configuring Hexo using the _config.yml file</h2><p>In the directory where you initalised hexo, you should see a file called _config.yml file. This is the file you edit to configure your hexo environment. At a bare minimum I did the following to get up and running quickly and efficiently.</p>
<p>I amended the site section at the top of the file to contain my and my site details.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Site</span><br><span class="line">title: dataGriff</span><br><span class="line">subtitle: A blog about data from a guy named Griff</span><br><span class="line">description: A blog with content on SQL, data warehousing, business intelligence and all the rest!</span><br><span class="line">author: Richard Griffiths</span><br><span class="line">language: default</span><br><span class="line">timezone: GMT</span><br></pre></td></tr></table></figure>
<p><strong>Important Note:</strong> It is important to change the language to default as leaving it as “en” was causing the language to be random everytime I generated the site. This was a bug in hexo at the time of writing.</p>
<p>In the URL section I changed the URL to be my custom domain (“www.datagriff.com”) and amended the permalink of each post to be just down to the month level and not down to day.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># URL</span><br><span class="line">## If your site is put in a subdirectory, set url as &apos;http://yoursite.com/child&apos; and root as &apos;/child/&apos;</span><br><span class="line">url: www.datagriff.com</span><br><span class="line">root: /</span><br><span class="line">permalink: :year/:month/:title/</span><br><span class="line">permalink_defaults:</span><br></pre></td></tr></table></figure></p>
<p>In the directory section I just changed the output path to <strong>../Output</strong>, from the default of public, which means the HTML files that get outputted go into a folder in the directory above the source path called Output, as I didn’t want the deployment to generate in the same folder as the source. This would cause all sorts of headaches with source control and with the number of git files. I preferred to keep the source code and ouput files separate.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># Directory</span><br><span class="line">source_dir: source</span><br><span class="line">public_dir: ../Output</span><br><span class="line">tag_dir: tags</span><br><span class="line">archive_dir: archives</span><br><span class="line">category_dir: categories</span><br><span class="line">code_dir: downloads/code</span><br><span class="line">i18n_dir: :lang</span><br><span class="line">skip_render:</span><br></pre></td></tr></table></figure>
<p>The only other thing I changed at this point was the deployment details, where I used the git type and entered in my github io repository where I’d be deploying my output.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Deployment</span><br><span class="line">## Docs: https://hexo.io/docs/deployment.html</span><br><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repo: https://github.com/griff182uk/griff182uk.github.io</span><br></pre></td></tr></table></figure>
<p>There are a number of other configuration items that I’m sure could be messed around with found at <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">https://hexo.io/docs/deployment.html</a>, but I found the above was enough to get me going.</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Deploying Hexo]]></title>
      <url>www.datagriff.com/2016/06/DeployingHexo/</url>
      <content type="html"><![CDATA[<h2 id="Generating-the-Files"><a href="#Generating-the-Files" class="headerlink" title="Generating the Files"></a>Generating the Files</h2><p>When in node.js command prompt, navigate to your source folder where you initialised hexo, and type<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo generate</span><br></pre></td></tr></table></figure></p>
<p>This will deploy all the html files to the output path you designated in the _config.yml file.</p>
<p><img src="/images/HexoGenerate.png" alt="Hexo Generate Output"></p>
<p>In my case I’d configured the files to generate in a folder above the source folder called outputs (../Output was what I had in the _config.yml file). The output folder should look something to below.</p>
<p><img src="/images/HexoOutputFiles.png" alt="Hexo Output Files"></p>
<h2 id="Deploying-Hexo"><a href="#Deploying-Hexo" class="headerlink" title="Deploying Hexo"></a>Deploying Hexo</h2><p>I chose to use git for my hexo deployment so before you can use the hexo deploy command below, you first need to install this. To install git deployment, while in the hexo initalised folder, type the following command and press return.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure></p>
<p>You also need to ensure that in your _config.yml file that you have git specified as the deploy method and the name of your github io repository specified.<br>To deploy then, when in node.js command prompt, navigate to your source folder where you initialised hexo, and type<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo deploy</span><br></pre></td></tr></table></figure></p>
<p>This will deploy and push the files to the github repo you specified in the _config.yml file.</p>
<p><img src="/images/HexoDeploy.png" alt="Hexo Deploy Output"></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Using Git Hub for Web Hosting]]></title>
      <url>www.datagriff.com/2016/06/UsingGitHubForWebHosting/</url>
      <content type="html"><![CDATA[<h2 id="Creating-a-Git-Hub-io-Repo"><a href="#Creating-a-Git-Hub-io-Repo" class="headerlink" title="Creating a Git Hub io Repo"></a>Creating a Git Hub io Repo</h2><p><strong><a href="https://github.com/" title="GitHub" target="_blank" rel="external">GitHub</a></strong> allows you each user to host one website as part of their service using a <a href="https://pages.github.com/" title="Github pages" target="_blank" rel="external">github “io” repoistory</a>.</p>
<p>To do this create a new github repository called [YourUserName]/[YourUserName].github.io.</p>
<p><img src="/images/GitHubIORepo.png" alt="My IO GitHub Repo"></p>
<p><strong>Note:</strong> I used this for my blog and so the URL for the github repository above was what I used in my Hexo _config.yml file in the deployment section.</p>
<p>Once you have deployed to the github repository you can view the site using the URL [YourUserName].github.io.</p>
<p>If you have a custom domain you want to use then you need to go to settings of your repo and where it says “Custom Domain” - add your custom domain name and save. This will add a CNAME file to your repository with the name of your custom domain in there.</p>
<p><strong>Important Note:</strong> In order for this CNAME file to persist, you should create it in your local output folder (with no file name extension), with the name of your custom domain. I found that if I didn’t do this everytime I pushed from my local folder the CNAME file would disappear and the connection from my github URL to my custom domain would disappear and I’d get a 404 error, so be aware of this!</p>
<p><img src="/images/CNAMEFolder.png" alt="CNAME File in Source Folder"></p>
<p><img src="/images/CNAMEContent.png" alt="CNAME Content"></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Install and Initialise Hexo]]></title>
      <url>www.datagriff.com/2016/06/InstallAndInitaliseHexo/</url>
      <content type="html"><![CDATA[<p>Inspired by the awesome <strong><a href="https://www.pluralsight.com/" title="Pluralsight" target="_blank" rel="external">Pluralsight</a></strong> and it’s course on <a href="http://www.staticgen.com/" title="Title" target="_blank" rel="external">static site generators</a>, I decided to implement a blog using hexo.</p>
<p>The steps shown below are what you need to install and initalise Hexo locally.</p>
<h2 id="Required-Applications-and-Installations"><a href="#Required-Applications-and-Installations" class="headerlink" title="Required Applications and Installations"></a>Required Applications and Installations</h2><p>The following items were required to create my blog, which I either already had or required to install.</p>
<ul>
<li><strong><a href="https://git-scm.com/downloads" title="Git" target="_blank" rel="external">Git</a></strong>  - Of course I already had it installed! Git will provide the methods of source control and also in my case, provide the host for my blog web page.</li>
<li><strong><a href="https://nodejs.org/en/" title="Node.js" target="_blank" rel="external">Node.js</a></strong> - Downloaded this for windows X64, as I have a 64 bit machine, chose all the defaults and so “Next Next Nexted” until Finish.</li>
<li><strong>NPM</strong> - This installed with the latest version of Node.js above anyway so I didn’t need to do anything here.</li>
<li><strong><a href="https://atom.io/" title="Atom" target="_blank" rel="external">Atom</a></strong>  - Even though I’d used notepad++ as my text editor up until this point, it didn’t have any native markdown features so I got converted to atom. It has appropriate syntax highlighting for markdown and has a useful live HTML preview feature (CTRL+Shift+M). Therefore my first blog post (this one) was written with atom and I’m likely to stick with it…</li>
<li><strong><a href="https://hexo.io/" title="Hexo" target="_blank" rel="external">Hexo</a></strong> - Is a static site generator application and the main application I have used to implement my blog. The home page of Hexo gives you the command to install, so I opened up my command prompt and typed it in. At the time of my implementation of my blog this was…<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-cli -g</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>Note:</strong> I actually used the node.js command prompt when performing these tasks, not windows command prompt, in case windows command prompt doesn’t work!</p>
<p>Then type in hexo into the command prompt and if the installation was a success you’ll get a load of hexo details back in the command window. Tidy!</p>
<h2 id="Using-Hexo-to-Initiate-my-Folders-and-Files"><a href="#Using-Hexo-to-Initiate-my-Folders-and-Files" class="headerlink" title="Using Hexo to Initiate my Folders and Files"></a>Using Hexo to Initiate my Folders and Files</h2><p>I created a folder in the desired location for my dataGriff blog by typing in the command (replace [My Path] with your folder path)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mrkdir //[My Path]/dataGriff</span><br></pre></td></tr></table></figure></p>
<p>Then I changed directory to this folder using<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd //[My Path]/dataGriff</span><br></pre></td></tr></table></figure></p>
<p>Finally I initialised hexo on the folder using<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo init</span><br></pre></td></tr></table></figure></p>
<p>There was a little message at the end of the command prompt output that stated<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INFO Start blogging with hexo</span><br></pre></td></tr></table></figure></p>
<p>So I thought I must be on the right track!</p>
<p><img src="/images/HexoStartBlogging.png" alt="Hexo Start Blogging"></p>
<h2 id="Viewing-Hexos-Startup-Template"><a href="#Viewing-Hexos-Startup-Template" class="headerlink" title="Viewing Hexos Startup Template"></a>Viewing Hexos Startup Template</h2><p>In command prompt, in my dataGriff directory, I typed<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo server</span><br></pre></td></tr></table></figure></p>
<p>Again I got the satisfying message of<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INFO hexo is running at http://localhost:4000/.</span><br></pre></td></tr></table></figure></p>
<p>So with trepidation I went to the <a href="http://localhost:4000/" target="_blank" rel="external">http://localhost:4000/</a> link in a browser and…<br>Hey presto! I could see hexos startup template! Success!<br>To stop the page running you can just press CTRL+C in the command prompt and confirm the termination.</p>
<p><img src="/images/HexoDefault.png" alt="Hexo Default Startup Page"></p>
<p>Using the hexo server command is a good way of testing your site locally before deployment.</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[YAML And Markdown Example]]></title>
      <url>www.datagriff.com/2016/06/YAMLAndMarkdown/</url>
      <content type="html"><![CDATA[<p>Markdown (.md) files offer the ability to use shorthand methods to generate HTML. Simply create a text file in your<br>favourite text editor and save it as FileName.md. Then you have yourself a markdown file.<br>This is particularly useful for bloggers where markdown is easier to quickly type and potentially easier to read as<br>raw code than HTML. Github already supports markdown files and a number of static site generators use markdown as their<br>raw source files to generate HTML. Where markdown caters for the content, YAML, which stands for “YAML ain’t markup language”, handles the metadata for the markdown document.</p>
<h2 id="YAML"><a href="#YAML" class="headerlink" title="YAML"></a>YAML</h2><p><strong>YAML</strong> stands for “YAML aint markup language” and is the metadata component of the page which can contain title, date and tags among others.<br>So at the top of my markdown document I could contain some metadata in YAML that would look something like the following.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: &apos;YAML And Markdown Example&apos;</span><br><span class="line">date: 2016-06-23</span><br><span class="line">categories: Markdown</span><br><span class="line">tags: [&apos;Learning&apos;,&apos;YAML&apos;,&apos;Markdown&apos;]</span><br><span class="line">---</span><br></pre></td></tr></table></figure></p>
<h2 id="Markdown"><a href="#Markdown" class="headerlink" title="Markdown"></a>Markdown</h2><p><strong>Markdown</strong> is an easy way to write content with shorthand methods instead of using something with tags (like HTML) so prose is easier to write and read when coded.<br>You can get more information on markdown at the creators of markdown <a href="https://daringfireball.net/" title="Daring Fireball" target="_blank" rel="external">Daring Fireball</a> or this nice cheatsheet from <a href="https://enterprise.github.com/downloads/en/markdown-cheatsheet.pdf&quot;" title="Github Markdown Cheatsheet" target="_blank" rel="external">github</a>.<br>The Markdown that generated the HTML above looks like this.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">## Markdown</span><br><span class="line">**Markdown** is an easy way to write content with shorthand methods instead of using something with tags (like HTML) so prose is easier to write and read when coded.</span><br><span class="line">You can get more information on markdown at the creators of markdown [Daring Fireball](https://daringfireball.net/ &quot;Daring Fireball&quot;) or this nice cheatsheet from [github](https://enterprise.github.com/downloads/en/markdown-cheatsheet.pdf&quot; &quot;Github Markdown Cheatsheet&quot;).</span><br><span class="line">The Markdown that generated the HTML above looks like this.</span><br></pre></td></tr></table></figure>
<p>Where the ## translates to a header h1 tag in HTML and the asterisks wrapped around a word translate to bold. Links are represented as [Name to Display](URL “Title”).</p>
<h3 id="Markdown-Lists"><a href="#Markdown-Lists" class="headerlink" title="Markdown Lists"></a>Markdown Lists</h3><p>You can use asterisks (*) to create unordered lists in your markdown</p>
<ul>
<li>I</li>
<li>am</li>
<li>unordered</li>
</ul>
<p>Where the markdown that generates this HTML looks like the following.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">### Markdown Lists</span><br><span class="line">You can use asterisks (\*) to create unordered lists in your markdown</span><br><span class="line">* I</span><br><span class="line">* am</span><br><span class="line">* unordered</span><br></pre></td></tr></table></figure>
<p>You can see that ### creates a h3, the backslash is an escape character (for the asterisk) and asterisks generate the unordered bullets.</p>
<p>or the number 1 and a full stop (1.) to create ordered lists</p>
<ol>
<li>I</li>
<li>am</li>
<li>ordered</li>
</ol>
<p>Where the markdown that generates this HTML looks the following.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">or the number 1 and a full stop (1.) to create ordered lists</span><br><span class="line">1. I</span><br><span class="line">1. am</span><br><span class="line">1. ordered</span><br></pre></td></tr></table></figure>
<p>You can see that 1. creates an ordered list.</p>
<h3 id="Markdown-Code-blocks"><a href="#Markdown-Code-blocks" class="headerlink" title="Markdown Code blocks"></a>Markdown Code blocks</h3><p>You can also create code snippets using markdown by using three backticks above and below your markdown code.<br>Where is backtick on your keyboard?? It’s the Windows key and the backtick key (top left on a Qwerty keyboard)..</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Message(&quot;Hello World&quot;);</span><br></pre></td></tr></table></figure>
<p>I can display the code specifically (ish) as SQL by adding the keyword sql after the top three backticks if I like too…</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> dbo.TestTable</span><br><span class="line">(RowNo <span class="built_in">INT</span>, RowValue <span class="built_in">CHAR</span>(<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> dbo.TestTable</span><br><span class="line"><span class="keyword">WHERE</span> RowNo = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<h3 id="Markdown-Editors"><a href="#Markdown-Editors" class="headerlink" title="Markdown Editors"></a>Markdown Editors</h3><p>I currently use <a href="https://atom.io/" title="Atom" target="_blank" rel="external">Atom</a>   as my local markdown editor but there are also plenty of online markdown editors if you want to just try it out, such as <a href="https://stackedit.io/" title="stackedit" target="_blank" rel="external">stackedit</a> or <a href="http://dillinger.io/ [dillinger]" title="dillinger" target="_blank" rel="external">dillinger</a>. Also remember any github files saved as markdown (.md) will also display accordingly as HTML when viewed.</p>
]]></content>
    </entry>
    
  
  
</search>
